<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PT Differential Diagnosis</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f12;
    --surface: #141720;
    --surface2: #1a1e28;
    --border: #252a36;
    --border-light: #2e3446;
    --text: #e8ecf4;
    --muted: #5a6380;
    --muted2: #7c8aaa;
    --accent: #4a8fff;
    --accent-dim: rgba(74,143,255,0.12);
    --accent-border: rgba(74,143,255,0.3);
    --positive: #2ecc71;
    --negative: #e74c3c;
    --warn: #f39c12;
    --positive-dim: rgba(46,204,113,0.1);
    --negative-dim: rgba(231,76,60,0.1);
    --chip-active: #4a8fff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'IBM Plex Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* ── HEADER ── */
  header {
    width: 100%;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 40px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-left {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .header-logo {
    width: 28px;
    height: 28px;
    border: 1.5px solid var(--accent);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .header-logo svg { display: block; }
  header h1 {
    font-family: 'Syne', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text);
  }
  .header-tag {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.04em;
    border: 1px solid var(--border-light);
    padding: 3px 8px;
    border-radius: 3px;
    background: var(--bg);
  }

  /* ── LAYOUT ── */
  .container {
    width: 100%;
    max-width: 800px;
    padding: 40px 24px 80px;
  }

  /* ── PROGRESS ── */
  .progress-bar {
    display: flex;
    align-items: center;
    gap: 0;
    margin-bottom: 40px;
  }
  .step-dot {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    flex: 1;
    position: relative;
    cursor: pointer;
  }
  .step-dot:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 12px;
    width: 100%;
    height: 1px;
    background: var(--border-light);
    z-index: 0;
  }
  .step-dot.done:not(:last-child)::after { background: var(--accent); opacity: 0.4; }
  .dot-circle {
    width: 24px; height: 24px;
    border-radius: 50%;
    background: var(--surface2);
    border: 1px solid var(--border-light);
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem;
    font-weight: 500;
    display: flex; align-items: center; justify-content: center;
    z-index: 1;
    transition: all 0.2s;
  }
  .step-dot.active .dot-circle {
    background: var(--accent);
    border-color: var(--accent);
    color: #0d0f12;
    font-weight: 700;
    box-shadow: 0 0 12px rgba(74,143,255,0.4);
  }
  .step-dot.done .dot-circle {
    background: transparent;
    border-color: var(--accent);
    color: var(--accent);
  }
  .dot-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.58rem;
    color: var(--muted);
    text-align: center;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .step-dot.active .dot-label { color: var(--accent); }

  /* ── CARDS ── */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 36px;
    margin-bottom: 16px;
  }
  .card-header {
    border-bottom: 1px solid var(--border);
    padding-bottom: 20px;
    margin-bottom: 28px;
  }
  .card h2 {
    font-family: 'Syne', sans-serif;
    font-size: 1.35rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    color: var(--text);
    margin-bottom: 6px;
  }
  .card .subtitle {
    color: var(--muted2);
    font-size: 0.83rem;
    font-weight: 300;
    line-height: 1.6;
  }

  /* ── AREA GRID ── */
  .area-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 8px;
  }
  .area-btn {
    border: 1px solid var(--border-light);
    border-radius: 6px;
    padding: 20px 14px 16px;
    text-align: left;
    cursor: pointer;
    transition: all 0.15s;
    background: var(--surface2);
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .area-btn .icon { display: none; }
  .area-btn .area-label {
    font-family: 'Syne', sans-serif;
    font-size: 0.88rem;
    font-weight: 600;
    letter-spacing: 0.02em;
  }
  .area-btn .area-abbr {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.62rem;
    color: var(--muted);
    letter-spacing: 0.06em;
    text-transform: uppercase;
  }
  .area-btn::before {
    content: '';
    display: block;
    width: 20px;
    height: 2px;
    background: var(--border-light);
    transition: all 0.15s;
    border-radius: 1px;
  }
  .area-btn:hover {
    border-color: var(--accent-border);
    background: var(--accent-dim);
  }
  .area-btn:hover::before { background: var(--accent); width: 32px; }
  .area-btn.selected {
    border-color: var(--accent);
    background: var(--accent-dim);
  }
  .area-btn.selected::before { background: var(--accent); width: 32px; }
  .area-btn.selected .area-label { color: var(--accent); }
  .area-btn.selected .area-abbr { color: var(--accent); opacity: 0.6; }

  /* ── CHIPS ── */
  .chip-group { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }
  .chip {
    border: 1px solid var(--border-light);
    border-radius: 3px;
    padding: 5px 12px;
    font-size: 0.78rem;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 400;
    cursor: pointer;
    transition: all 0.12s;
    background: var(--surface2);
    color: var(--muted2);
    letter-spacing: 0.01em;
  }
  .chip:hover { border-color: var(--accent-border); color: var(--text); background: var(--accent-dim); }
  .chip.selected {
    background: var(--accent);
    color: #0d0f12;
    border-color: var(--accent);
    font-weight: 500;
  }

  /* ── INPUTS ── */
  textarea, input[type="text"], input[type="number"] {
    width: 100%;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    padding: 11px 14px;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.85rem;
    color: var(--text);
    background: var(--bg);
    resize: vertical;
    transition: border 0.15s;
    outline: none;
  }
  textarea::placeholder, input::placeholder { color: var(--muted); }
  textarea:focus, input:focus { border-color: var(--accent); }

  /* ── SECTION LABEL ── */
  .section-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    margin: 24px 0 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* ── OBJECTIVE FIELDS ── */
  .objective-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .field-group label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.7rem;
    font-weight: 500;
    color: var(--muted2);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .norm-badge {
    display: inline-block;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.6rem;
    font-weight: 400;
    color: var(--accent);
    background: var(--accent-dim);
    border: 1px solid var(--accent-border);
    border-radius: 2px;
    padding: 1px 6px;
    text-transform: none;
    letter-spacing: 0;
    white-space: nowrap;
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .field-group input {
    width: 100%;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    padding: 9px 12px;
    font-size: 0.85rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--text);
    background: var(--bg);
    outline: none;
    transition: border 0.15s;
  }
  .field-group input:focus { border-color: var(--accent); }

  /* ── SPECIAL TESTS ── */
  .test-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px;
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 6px;
    background: var(--surface2);
    transition: border-color 0.15s;
    gap: 16px;
  }
  .test-item:hover { border-color: var(--border-light); }
  .test-info { flex: 1; min-width: 0; }
  .test-name {
    font-weight: 500;
    font-size: 0.87rem;
    color: var(--text);
    margin-bottom: 2px;
  }
  .test-purpose {
    font-size: 0.73rem;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .toggle-group {
    display: flex;
    border-radius: 3px;
    overflow: hidden;
    border: 1px solid var(--border-light);
    flex-shrink: 0;
  }
  .toggle-btn {
    padding: 6px 14px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.72rem;
    font-weight: 500;
    cursor: pointer;
    border: none;
    background: var(--surface);
    color: var(--muted);
    transition: all 0.12s;
    letter-spacing: 0.04em;
  }
  .toggle-btn + .toggle-btn { border-left: 1px solid var(--border-light); }
  .toggle-btn.pos.active { background: var(--negative-dim); color: var(--negative); }
  .toggle-btn.neg.active { background: var(--positive-dim); color: var(--positive); }
  .toggle-btn:not(.active):hover { background: var(--surface2); color: var(--text); }

  /* ── RESULTS ── */
  .ddx-card {
    border-left: 2px solid var(--accent);
    background: var(--surface);
    border-radius: 0 6px 6px 0;
    padding: 18px 22px;
    margin-bottom: 8px;
    border-top: 1px solid var(--border);
    border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    transition: border-left-color 0.2s;
  }
  .ddx-card.rank-1 { border-left-color: var(--accent); }
  .ddx-card.rank-2 { border-left-color: rgba(74,143,255,0.5); }
  .ddx-card.rank-other { border-left-color: var(--border-light); }
  .ddx-card-top {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 8px;
  }
  .ddx-card h3 {
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    font-size: 0.97rem;
    letter-spacing: 0.02em;
    color: var(--text);
  }
  .likelihood {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem;
    font-weight: 500;
    padding: 3px 10px;
    border-radius: 2px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .lk-high { background: var(--negative-dim); color: var(--negative); border: 1px solid rgba(231,76,60,0.2); }
  .lk-med { background: rgba(243,156,18,0.1); color: var(--warn); border: 1px solid rgba(243,156,18,0.2); }
  .lk-low { background: var(--positive-dim); color: var(--positive); border: 1px solid rgba(46,204,113,0.2); }
  .ddx-card .age-note {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.67rem;
    color: var(--muted);
    margin-bottom: 8px;
    letter-spacing: 0.02em;
  }
  .ddx-card p { font-size: 0.83rem; color: var(--muted2); line-height: 1.65; }

  /* ── RECOMMENDATION BOX ── */
  .rec-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-top: 2px solid var(--accent);
    border-radius: 0 0 6px 6px;
    padding: 28px;
    margin-bottom: 16px;
  }
  .rec-box-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.62rem;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 10px;
  }
  .rec-box h3 {
    font-family: 'Syne', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 10px;
    color: var(--text);
    letter-spacing: 0.02em;
  }
  .rec-box p { font-size: 0.86rem; line-height: 1.7; color: var(--muted2); }

  /* ── EDU ITEMS ── */
  .edu-section { margin-bottom: 16px; }
  .edu-section-title {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.62rem;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    padding: 16px 0 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .edu-section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .edu-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 2px solid var(--border-light);
    border-radius: 0 4px 4px 0;
    padding: 16px 18px;
    margin-bottom: 6px;
    font-size: 0.84rem;
    line-height: 1.65;
    color: var(--muted2);
  }
  .edu-item strong {
    display: block;
    margin-bottom: 6px;
    font-size: 0.87rem;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    color: var(--text);
    letter-spacing: 0.02em;
  }

  /* ── EXERCISE CARDS ── */
  .exercise-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .ex-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 16px 18px;
    transition: border-color 0.15s;
  }
  .ex-card:hover { border-color: var(--border-light); }
  .ex-icon { display: none; }
  .ex-number {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.6rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    margin-bottom: 8px;
  }
  .ex-card strong {
    display: block;
    font-family: 'Syne', sans-serif;
    font-size: 0.87rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    margin-bottom: 4px;
    color: var(--text);
  }
  .ex-card p { font-size: 0.77rem; color: var(--muted2); line-height: 1.5; }
  .ex-card .sets {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.68rem;
    font-weight: 500;
    color: var(--accent);
    margin-top: 8px;
    letter-spacing: 0.03em;
  }

  /* ── BUTTONS ── */
  .btn-row { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
  .btn {
    padding: 11px 26px;
    border-radius: 4px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.78rem;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .btn-primary { background: var(--accent); color: #0d0f12; }
  .btn-primary:hover { background: #6aabff; }
  .btn-secondary {
    background: transparent;
    color: var(--muted2);
    border: 1px solid var(--border-light);
  }
  .btn-secondary:hover { border-color: var(--muted2); color: var(--text); }
  .btn-print {
    background: transparent;
    color: var(--muted2);
    border: 1px solid var(--border-light);
  }
  .btn-print:hover { border-color: var(--text); color: var(--text); }

  /* ── PAGE TRANSITIONS ── */
  .page { display: none; }
  .page.active { display: block; animation: fadeUp 0.2s ease; }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: none; }
  }

  /* ── DISCLAIMER ── */
  .disclaimer {
    background: rgba(243,156,18,0.06);
    border: 1px solid rgba(243,156,18,0.2);
    border-left: 2px solid var(--warn);
    border-radius: 0 4px 4px 0;
    padding: 12px 16px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.72rem;
    color: rgba(243,156,18,0.8);
    margin-top: 16px;
    line-height: 1.6;
    letter-spacing: 0.01em;
  }
  .disclaimer strong { color: var(--warn); }

  /* ── SLR SECTION ── */
  .slr-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
  }

  /* ── SCORE BAR ── */
  .score-bar-wrap { margin-top: 10px; }
  .score-bar-bg {
    height: 2px;
    background: var(--border);
    border-radius: 1px;
    overflow: hidden;
  }
  .score-bar-fill {
    height: 100%;
    border-radius: 1px;
    background: var(--accent);
    transition: width 0.4s ease;
  }

  @media (max-width: 520px) {
    .objective-grid { grid-template-columns: 1fr; }
    .exercise-grid { grid-template-columns: 1fr; }
    .card { padding: 22px 18px; }
    .area-grid { grid-template-columns: repeat(2, 1fr); }
    header { padding: 0 18px; }
    header h1 { font-size: 0.82rem; }
    .header-tag { display: none; }
  }

  @media print {
    body { background: white; color: black; }
    header, .progress-bar, .btn-row { display: none; }
    .card, .ddx-card, .rec-box, .edu-item, .ex-card {
      background: white !important;
      border-color: #ddd !important;
      color: black !important;
      box-shadow: none !important;
    }
    .page { display: block !important; }
    .page:not(#page8) { display: none !important; }
  }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div class="header-logo">
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
        <path d="M7 1v12M2 7h10M4 4l6 6M10 4L4 10" stroke="#4a8fff" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </div>
    <h1>PT Differential Diagnosis</h1>
  </div>
  <span class="header-tag">Clinical Decision Support v2</span>
</header>

<div class="container">
  <!-- Progress -->
  <div class="progress-bar" id="progressBar">
    <div class="step-dot active" data-step="1"><div class="dot-circle">1</div><span class="dot-label">Region</span></div>
    <div class="step-dot" data-step="2"><div class="dot-circle">2</div><span class="dot-label">Patient</span></div>
    <div class="step-dot" data-step="3"><div class="dot-circle">3</div><span class="dot-label">Symptoms</span></div>
    <div class="step-dot" data-step="4"><div class="dot-circle">4</div><span class="dot-label">Aggravating</span></div>
    <div class="step-dot" data-step="5"><div class="dot-circle">5</div><span class="dot-label">Alleviating</span></div>
    <div class="step-dot" data-step="6"><div class="dot-circle">6</div><span class="dot-label">Objective</span></div>
    <div class="step-dot" data-step="7"><div class="dot-circle">7</div><span class="dot-label">Spec. Tests</span></div>
    <div class="step-dot" data-step="8"><div class="dot-circle">8</div><span class="dot-label">Results</span></div>
  </div>

  <!-- Page 1: Region -->
  <div class="page active" id="page1">
    <div class="card">
      <div class="card-header">
        <h2>Select Region</h2>
        <p class="subtitle">Which body region is being evaluated?</p>
      </div>
      <div class="area-grid" id="areaGrid">
        <button class="area-btn" data-area="lumbar"><span class="area-label">Lumbar Spine</span><span class="area-abbr">L1 – S1</span></button>
        <button class="area-btn" data-area="thoracic"><span class="area-label">Thoracic Spine</span><span class="area-abbr">T1 – T12</span></button>
        <button class="area-btn" data-area="cervical"><span class="area-label">Cervical Spine</span><span class="area-abbr">C1 – C8</span></button>
        <button class="area-btn" data-area="shoulder"><span class="area-label">Shoulder</span><span class="area-abbr">GH / AC / SC</span></button>
        <button class="area-btn" data-area="elbow"><span class="area-label">Elbow</span><span class="area-abbr">Humeroulnar</span></button>
        <button class="area-btn" data-area="pelvis"><span class="area-label">Pelvis / Hip</span><span class="area-abbr">SI / Acetabular</span></button>
        <button class="area-btn" data-area="knee"><span class="area-label">Knee</span><span class="area-abbr">Tibiofemoral</span></button>
        <button class="area-btn" data-area="ankle"><span class="area-label">Foot & Ankle</span><span class="area-abbr">Talocrural</span></button>
      </div>
    </div>
    <div class="btn-row"><button class="btn btn-primary" onclick="goTo(2)">Next →</button></div>
  </div>

  <!-- Page 2: Patient Info -->
  <div class="page" id="page2">
    <div class="card">
      <div class="card-header">
        <h2>Patient Information</h2>
        <p class="subtitle">Age and biological sex weight differential diagnosis likelihood based on population epidemiology.</p>
      </div>

      <div class="section-label">Demographics</div>
      <div class="objective-grid">
        <div class="field-group">
          <label>Patient Age (years)</label>
          <input type="number" id="patientAge" placeholder="e.g. 42" min="5" max="110" />
        </div>
        <div class="field-group">
          <label>Biological Sex</label>
          <div class="chip-group" style="margin-top:6px;" id="sexChips">
            <button class="chip" data-sex="male" onclick="selectSex(this)">Male</button>
            <button class="chip" data-sex="female" onclick="selectSex(this)">Female</button>
            <button class="chip" data-sex="other" onclick="selectSex(this)">Other / Not specified</button>
          </div>
        </div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(1)">← Back</button>
      <button class="btn btn-primary" onclick="goTo(3)">Next →</button>
    </div>
  </div>

  <!-- Page 3: Symptoms -->
  <div class="page" id="page3">
    <div class="card">
      <div class="card-header">
        <h2>Symptom Profile</h2>
        <p class="subtitle">Select all symptoms the patient reports, or type additional ones below.</p>
      </div>
      <div class="chip-group" id="symptomChips"></div>
      <textarea id="symptomText" rows="3" placeholder="Additional symptoms..."></textarea>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(2)">← Back</button>
      <button class="btn btn-primary" onclick="goTo(4)">Next →</button>
    </div>
  </div>

  <!-- Page 4: Aggravating -->
  <div class="page" id="page4">
    <div class="card">
      <div class="card-header">
        <h2>Aggravating Factors</h2>
        <p class="subtitle">What activities or positions worsen the patient's symptoms?</p>
      </div>
      <div class="chip-group" id="aggChips"></div>
      <textarea id="aggText" rows="2" placeholder="Additional aggravating factors..."></textarea>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(3)">← Back</button>
      <button class="btn btn-primary" onclick="goTo(5)">Next →</button>
    </div>
  </div>

  <!-- Page 5: Alleviating -->
  <div class="page" id="page5">
    <div class="card">
      <div class="card-header">
        <h2>Alleviating Factors</h2>
        <p class="subtitle">What provides the patient relief?</p>
      </div>
      <div class="chip-group" id="alleChips"></div>
      <textarea id="alleText" rows="2" placeholder="Additional alleviating factors..."></textarea>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(4)">← Back</button>
      <button class="btn btn-primary" onclick="goTo(6)">Next →</button>
    </div>
  </div>

  <!-- Page 6: Objective -->
  <div class="page" id="page6">
    <div class="card">
      <div class="card-header">
        <h2>Objective Findings</h2>
        <p class="subtitle">MMT grades (0–5) and ROM values in degrees. Leave blank if not tested.</p>
      </div>
      <div id="objectiveFields"></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(5)">← Back</button>
      <button class="btn btn-primary" onclick="buildSpecialTests(); goTo(7)">Next →</button>
    </div>
  </div>

  <!-- Page 7: Special Tests -->
  <div class="page" id="page7">
    <div class="card">
      <div class="card-header">
        <h2>Special Tests</h2>
        <p class="subtitle">Perform each test and record the result.</p>
      </div>
      <div id="specialTestsList"></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(6)">← Back</button>
      <button class="btn btn-primary" onclick="buildResults(); goTo(8)">Generate Report →</button>
    </div>
  </div>

  <!-- Page 8: Results -->
  <div class="page" id="page8">
    <div class="card">
      <h2>Clinical Impression</h2>
      <p class="subtitle">Based on the subjective and objective data collected.</p>
      <div class="disclaimer"><strong>Clinical Decision Support Only —</strong> This tool is not a diagnostic instrument. Results are intended to support clinical reasoning by a licensed physical therapist and do not constitute a medical diagnosis.</div>
    </div>
    <div id="ddxResults"></div>
    <div id="recSection"></div>
    <div id="eduSection"></div>
    <div id="exSection"></div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goTo(1); resetAll()">Start Over</button>
      <button class="btn btn-print" onclick="window.print()">Print Report</button>
    </div>
  </div>
</div>

<script>
// ========= DATA =========
const state = {
  area: null,
  age: null,
  sex: null,
  slrRight: null,
  slrLeft: null,
  slrFlag: null,
  symptoms: new Set(),
  symptomText: '',
  agg: new Set(),
  aggText: '',
  alle: new Set(),
  alleText: '',
  objective: {},
  specialTests: {}
};

const SYMPTOM_CHIPS = {
  lumbar: ['Diffuse axial low back pain','Deep ache','Sharp pain','Radiating pain (leg)','Leg pain greater than back pain','Numbness','Tingling','Burning','Paresthesias (dermatomal)','Stiffness','Muscle spasm / guarding','Weakness (lower extremity)','Night pain','Morning stiffness (<30 min)','Bilateral leg symptoms','Unilateral buttock pain','Posterior pelvic pain','Neurogenic claudication','Giving way / instability','Pain with transitional movements'],
  pelvis: ['Deep groin pain','Anterior hip / groin pain','Lateral hip pain','Posterior hip pain / buttock','Mid-buttock pain','Deep ache','Sharp pain','Clicking / snapping (hip)','Audible snap with hip motion','Groin tightness','Referred pain to thigh','Referred pain to knee','Sciatica / burning pain down leg','Lower abdominal pain','Stiffness','Weakness','Night pain','Pain at rest','Morning stiffness (<30 min)','Morning stiffness (>30 min)','Locking / catching sensation','Giving way','Swelling','Numbness / tingling (thigh)','Pain with weight-bearing','Antalgic gait','Leg length discrepancy','Ecchymosis (acute)','Pain with sitting >30 min'],
  thoracic: ['Deep ache','Sharp pain','Mid-back pain','Upper back pain','Interscapular pain','Band-like pain','Chest wall pain','Radiating pain','Stiffness','Muscle spasm','Rib pain','Sharp pain with breathing','Fatigue / postural fatigue','Numbness','Tingling','Weakness (upper extremity)','Night pain','Pain with coughing/sneezing','Postural complaints','Arm fatigue'],
  cervical: ['Unilateral arm pain','Bilateral arm pain','Neck pain','Radiating pain (arm)','Paresthesias','Numbness (dermatomal)','Tingling','Deep ache','Sharp pain','Headache (unilateral)','Headache (bilateral)','Neck stiffness','Muscle spasm','Weakness (arm/hand)','Dizziness','Visual changes','Nausea','Photophobia','Phonophobia','Night pain','Autonomic symptoms'],
  shoulder: ['Anterolateral shoulder pain','Deep shoulder pain','Superior shoulder pain','Pain at AC joint','Sharp pain','Deep ache','Night pain / sleep disturbance','Clicking / popping / catching','Weakness with lifting','Weakness with overhead','Stiffness','Progressive loss of motion','Giving way / instability','Apprehension','Pain radiating down arm / biceps','Paresthesias (C8/T1 distribution)','Arm fatigue','Difficulty reaching behind back','Difficulty dressing / toileting','Painful arc (60–120°)'],
  elbow: ['Lateral elbow pain','Medial elbow pain','Anterior elbow pain','Proximal lateral forearm pain','Volar forearm aching','Deep ache','Sharp pain','Burning','Weakness of grip','Weakness with supination','Weakness of finger extension','Numbness','Tingling','Paresthesias (ring / little fingers)','Paresthesias (thumb / index / middle fingers)','Intrinsic muscle atrophy','Clicking / popping','Stiffness','Night pain','Audible pop (acute)','Ecchymosis (acute)','Decline in throwing performance'],
  knee: ['Deep ache','Sharp pain','Anterior knee pain','Medial knee pain','Lateral knee pain','Posterior knee pain','Clicking/popping','Crepitus','Swelling/effusion','Morning stiffness (<30 min)','Morning stiffness (>30 min)','Stiffness after sitting','Giving way/instability','Locking','Catching sensation','Numbness','Tingling','Night pain','Buckling','Tenderness at patellar tendon','Bony enlargement'],
  ankle: ['Lateral ankle pain','Medial ankle pain','Anterior ankle pain','Posterior ankle pain','Plantar heel pain','Arch pain / medial foot pain','Forefoot / metatarsal head pain','Burning pain','Numbness','Tingling / electrical sensations','Deep ache','Sharp pain','Swelling / effusion','Stiffness','Instability / giving way','Clicking / popping','Bruising / ecchymosis','Night pain','Morning pain (first steps)','Pain improves with activity then worsens','Weakness','Antalgic gait','Progressive flatfoot deformity','Cramping (medial arch)','Pain out of proportion to injury'],
};

const AGG_CHIPS = {
  lumbar: ['Prolonged sitting','Prolonged standing','Bending forward (flexion)','Bending backward (extension)','Rotation / twisting','Lifting','Repetitive movements','Prolonged walking','Sneezing / coughing (Valsalva)','Standing on one leg','Stair climbing','Transitional movements (sit-to-stand)','Weight-bearing activities','Activities requiring dynamic spinal control'],
  pelvis: ['Walking / ambulation','Running / sprinting','Ascending stairs','Descending stairs','Prolonged sitting (>30 min)','Prolonged standing','Hip flexion activities','Deep squatting','Pivoting / rotation','Kicking','Cutting / lateral movements','Transitional movements (sit-to-stand)','Turning in bed','Standing on one leg','End-range hip movements','Impact activities','Hill running','Sitting on hard surfaces','Increased training load','Coughing / sneezing'],
  thoracic: ['Prolonged sitting','Prolonged standing','End-range movements','Trunk rotation','Extension','Reaching overhead','Repetitive arm movements','Weight-bearing activities','Activities requiring upright posture','Deep breathing','Coughing / sneezing','Direct pressure on rib/chest','Sports participation','Carrying objects','Sustained arm positions'],
  cervical: ['Neck movement (any)','Looking down (flexion)','Looking up (extension)','Rotation','Lateral flexion','Sustained neck positions','Prolonged sitting','Driving','Reading','Overhead activities','Valsalva / sneezing / coughing','Weight-bearing on upper extremities','External pressure on posterior neck'],
  shoulder: ['Overhead activities (60–120° arc)','Arm elevation','Repetitive overhead motion','Reaching behind back','Cross-body / horizontal adduction','Lifting above shoulder level','Side lying on affected shoulder','Throwing / sport activities','Carrying objects','Sustained arm positions','Reaching forward','Abduction + external rotation','Dressing / toileting'],
  elbow: ['Gripping','Lifting (even light objects)','Wrist extension activities','Wrist flexion activities','Forearm pronation','Forearm supination','Forearm rotation >4 hrs/day','Throwing (late cocking / acceleration)','Elbow flexion (prolonged)','Leaning on elbow','Typing / keyboard use','Carrying','Overhead activities','Valgus stress activities','Elbow flexion during sleep'],
  knee: ['Squatting','Descending stairs','Ascending stairs','Prolonged sitting','Prolonged walking','Running','Kneeling','Pivoting/cutting','Jumping/landing','Weight-bearing activities','Getting up from chair','Twisting movements','Deep knee flexion','Repetitive knee flexion/extension'],
  ankle: ['Inversion injury','Weight-bearing activities','Prolonged standing','First steps in morning','Prolonged walking','Running','Push-off / toe-off','Ascending stairs','Descending stairs','Uneven terrain','Impact activities','Tight / constrictive footwear','High-heeled shoes','Walking barefoot','Dorsiflexion activities','External rotation of foot','Eversion activities','Increased training load'],
};

const ALLE_CHIPS = {
  lumbar: ['Lying down','Rest','Walking','Bending forward','Extension / back bend','Sitting','Bending forward over shopping cart','Position changes','Activity modification','Heat','Ice','Lumbar support / brace','Core stabilization','Avoiding asymmetric loading'],
  pelvis: ['Rest','Ice','Heat','Lying down','Non-weight-bearing','Complete activity cessation (stress fracture)','Activity modification','Avoiding deep hip flexion','Avoiding pivoting','Avoiding side-lying on affected hip','Avoiding asymmetric loading','Pelvic support belt','Hip abductor strengthening','Anti-inflammatory medication'],
  thoracic: ['Rest','Heat','Ice','Lying down / supine','Gentle movement','Activity modification','Supported posture','Scapular stabilization exercises','Avoiding provocative movements','Splinting (rib)','Shoulder abduction (hand on head)'],
  cervical: ['Rest','Heat','Ice','Lying down','Cervical support / collar','Traction','Manual therapy','Shoulder abduction (hand on head)','Activity modification','Gentle movement','Changing positions'],
  shoulder: ['Rest','Ice','Heat','Arm supported / sling','Avoiding overhead activities','Avoiding end-range movements','Avoiding provocative positions','Shoulder abduction (hand on head)','Activity modification','Immobilization (acute instability)'],
  elbow: ['Rest','Ice','Heat','Activity modification','Avoiding gripping','Avoiding throwing','Elbow extension','Counterforce brace','Elbow sleeve','Arm elevated','Stretching','Avoiding elbow flexion','Immobilization (acute rupture)'],
  knee: ['Rest','Ice','Heat','Elevation','Compression','Bracing/support','Activity modification','Non-weight-bearing','Avoiding pivoting','Avoiding deep flexion'],
  ankle: ['Rest','Ice','Elevation','Compression','Immobilization / boot','Bracing / ankle support','Orthotics / arch support','Cushioned footwear','Wide-toed shoes','Removing shoes','Reduced weight-bearing','Stretching calf','Activity modification','Taping','Loose footwear'],
};

// ROM entries: { label, norm } — norm shown as reference badge next to input
const OBJECTIVE_FIELDS = {
  lumbar: {
    mmt: [
      // Myotomal testing by nerve root level
      'L2/L3 — Hip flexion (iliopsoas)',
      'L3/L4 — Knee extension (quadriceps)',
      'L4 — Dorsiflexion (tibialis anterior)',
      'L4/L5 — Hip extension (gluteus maximus)',
      'L4/L5 — Hip abduction (gluteus medius)',
      'L5 — Great toe extension (EHL)',
      'L5/S1 — Hip abduction (gluteus medius)',
      'S1 — Plantar flexion (gastroc/soleus)',
      'S1 — Ankle eversion (peroneals)',
      // Reflexes
      'DTR — Patellar (L3/L4)',
      'DTR — Achilles (S1)',
    ],
    rom: [
      {label:'Lumbar Flexion (°)',         norm:'40–60°'},
      {label:'Lumbar Extension (°)',       norm:'20–35°'},
      {label:'Lateral Flexion R (°)',      norm:'15–25°'},
      {label:'Lateral Flexion L (°)',      norm:'15–25°'},
      {label:'Rotation R (°)',             norm:'3–18°'},
      {label:'Rotation L (°)',             norm:'3–18°'},
      {label:'Finger-to-floor distance (cm)', norm:'0 cm (fingers reach floor)'},
      {label:'Hip Flexion R (°)',          norm:'110–120°'},
      {label:'Hip Flexion L (°)',          norm:'110–120°'},
      {label:'Hip Extension R (°)',        norm:'10–20°'},
      {label:'Hip Extension L (°)',        norm:'10–20°'},
    ]
  },
  pelvis: {
    mmt: [
      'Hip flexors (iliopsoas) — R',
      'Hip flexors (iliopsoas) — L',
      'Hip extensors (gluteus maximus) — R',
      'Hip extensors (gluteus maximus) — L',
      'Hip abductors (gluteus medius) — R',
      'Hip abductors (gluteus medius) — L',
      'Hip adductors — R',
      'Hip adductors — L',
      'Hip ER (piriformis / deep 6) — R',
      'Hip ER (piriformis / deep 6) — L',
      'Hip IR — R',
      'Hip IR — L',
      'Quadriceps (L3/L4)',
      'Hamstrings (L5/S1)',
    ],
    rom: [
      {label:'Hip Flexion R (°)',              norm:'110–120°'},
      {label:'Hip Flexion L (°)',              norm:'110–120°'},
      {label:'Hip Extension R (°)',            norm:'10–20°'},
      {label:'Hip Extension L (°)',            norm:'10–20°'},
      {label:'Hip Abduction R (°)',            norm:'40–50°'},
      {label:'Hip Abduction L (°)',            norm:'40–50°'},
      {label:'Hip Adduction R (°)',            norm:'20–30°'},
      {label:'Hip Adduction L (°)',            norm:'20–30°'},
      {label:'Hip ER (hip flexed 90°) R (°)',  norm:'40–60°'},
      {label:'Hip ER (hip flexed 90°) L (°)',  norm:'40–60°'},
      {label:'Hip IR (hip flexed 90°) R (°)',  norm:'30–40°'},
      {label:'Hip IR (hip flexed 90°) L (°)',  norm:'30–40°'},
      {label:'FABER distance R (cm)',          norm:'~15–20 cm; compare bilaterally'},
      {label:'FABER distance L (cm)',          norm:'~15–20 cm; compare bilaterally'},
      {label:'Leg Length — True (cm)',         norm:'Difference <1 cm'},
      {label:'Leg Length — Apparent (cm)',     norm:'Compare bilaterally'},
    ]
  },
  thoracic: {
    mmt: [
      'Back extensor strength / endurance (Biering-Sørensen)',
      'Scapular retraction (mid-trap)',
      'Scapular depression (lower trap)',
      'Serratus anterior',
      'Trunk rotation R',
      'Trunk rotation L',
      'Core activation (transversus abdominis)',
    ],
    rom: [
      {label:'Thoracic Flexion (°)',       norm:'21° (↓~5°/decade with age)'},
      {label:'Thoracic Extension (°)',     norm:'13° (↓~5°/decade with age)'},
      {label:'Rotation R (°)',             norm:'40° (↓~5°/decade with age)'},
      {label:'Rotation L (°)',             norm:'40° (↓~5°/decade with age)'},
      {label:'Lateral Flex R (°)',         norm:'26° (↓~5°/decade with age)'},
      {label:'Lateral Flex L (°)',         norm:'26° (↓~5°/decade with age)'},
      {label:'Thoracic Kyphosis (°)',      norm:'34–40° standing T1–T12'},
      {label:'Rib expansion (cm)',         norm:'≥3 cm'},
      {label:'Finger-to-floor distance (cm)', norm:'0 cm (fingers reach floor)'},
    ]
  },
  cervical: {
    mmt: [
      // Deep cervical stabilizers
      'Deep neck flexors (CCFT)',
      'Neck flexor endurance (sec)',
      'SCM',
      'Upper trapezius',
      // Myotomal testing by level
      'C4 — Shoulder elevation / shrug',
      'C5 — Shoulder abduction (deltoid)',
      'C5/C6 — Elbow flexion (biceps)',
      'C6 — Wrist extension (ECRB)',
      'C7 — Elbow extension (triceps)',
      'C7 — Wrist flexion',
      'C8 — Finger flexion (FDP)',
      'T1 — Finger abduction (interossei)',
    ],
    rom: [
      // Cervical ROM
      {label:'Cervical Flexion (°)',        norm:'45–50°'},
      {label:'Cervical Extension (°)',      norm:'60–75°'},
      {label:'Rotation R (°)',              norm:'60–80°'},
      {label:'Rotation L (°)',              norm:'60–80°'},
      {label:'Lateral Flex R (°)',          norm:'40–45°'},
      {label:'Lateral Flex L (°)',          norm:'40–45°'},
      // Shoulder ROM — relevant for differentiating cervical vs shoulder pathology
      {label:'Shoulder Flexion R (°)',      norm:'150–180°'},
      {label:'Shoulder Flexion L (°)',      norm:'150–180°'},
      {label:'Shoulder Abduction R (°)',    norm:'150–180°'},
      {label:'Shoulder Abduction L (°)',    norm:'150–180°'},
      {label:'Shoulder ER R (°)',           norm:'60–90°'},
      {label:'Shoulder ER L (°)',           norm:'60–90°'},
      {label:'Shoulder IR R (°)',           norm:'60–90°'},
      {label:'Shoulder IR L (°)',           norm:'60–90°'},
    ]
  },
  shoulder: {
    mmt: [
      // Rotator cuff
      'Supraspinatus (empty can / full can)',
      'Infraspinatus (ER at side)',
      'Teres minor (ER at 90° ABD)',
      'Subscapularis (lift-off / belly press)',
      // Deltoid
      'Anterior deltoid (flexion)',
      'Middle deltoid (abduction)',
      'Posterior deltoid (extension)',
      // Scapular stabilizers
      'Serratus anterior (wall push-up plus)',
      'Lower trapezius',
      'Middle trapezius',
      // Biceps / other
      'Biceps (elbow flexion + supination)',
      'Grip strength (dynamometer)',
    ],
    rom: [
      {label:'Flexion — Active (°)',              norm:'150–180°'},
      {label:'Flexion — Passive (°)',             norm:'150–180°'},
      {label:'Abduction — Active (°)',            norm:'150–180°'},
      {label:'Abduction — Passive (°)',           norm:'150–180°'},
      {label:'ER at side — Active (°)',           norm:'60–90°'},
      {label:'ER at side — Passive (°)',          norm:'60–90°'},
      {label:'ER at 90° ABD — Active (°)',        norm:'90°'},
      {label:'IR at side — Active (°)',           norm:'60–90°'},
      {label:'IR at 90° ABD — Active (°)',        norm:'60–70°'},
      {label:'Extension (°)',                     norm:'45–60°'},
      {label:'Horizontal Adduction (°)',          norm:'30–45°'},
      {label:'Painful arc — onset (°)',           norm:'No pain through range'},
      {label:'Painful arc — resolution (°)',      norm:'No pain through range'},
    ]
  },
  elbow: {
    mmt: [
      'Elbow flexion — biceps (C5/C6)',
      'Elbow extension — triceps (C7)',
      'Forearm supination — biceps / supinator (C6)',
      'Forearm pronation — pronator teres (C7)',
      'Wrist extension — ECRB/ECRL (C6/C7)',
      'Wrist flexion — FCR/FCU (C7)',
      'Grip strength (dynamometer — compare bilaterally)',
      'Finger extension — EDC (PIN / C7)',
      'Thumb extension — EPL (PIN / C8)',
      'Intrinsic hand muscles (interossei / lumbricals — ulnar nerve)',
    ],
    rom: [
      {label:'Elbow Flexion (°)',            norm:'140–150°'},
      {label:'Elbow Extension (°)',          norm:'0° (full extension)'},
      {label:'Carrying Angle (°)',           norm:'5–15° valgus; compare bilaterally'},
      {label:'Forearm Pronation (°)',        norm:'75–80°'},
      {label:'Forearm Supination (°)',       norm:'80–85°'},
      {label:'Wrist Flexion (°)',            norm:'60–80°'},
      {label:'Wrist Extension (°)',          norm:'55–70°'},
      {label:'Grip Strength (kg / lbs)',     norm:'Compare to contralateral; deficit >10–15% significant'},
    ]
  },
  knee: {
    mmt: ['Quadriceps (L3/L4)','VMO isolation','Hamstrings (L5/S1)','Hip Abductors (L4/L5)','Hip Flexors (L1/L2)','Hip Extensors (L5/S1)','Gastroc/Soleus (S1/S2)','Hip ER','Hip IR'],
    rom: [
      {label:'Knee Flexion (°)',                  norm:'130–150°'},
      {label:'Knee Extension (°)',                norm:'0° (full)'},
      {label:'Knee Extension Deficit (°)',        norm:'0° deficit'},
      {label:'Hip Flexion (°)',                   norm:'110–120°'},
      {label:'Hip Abduction (°)',                 norm:'40–50°'},
      {label:'Ankle DF – knee straight (°)',      norm:'10–20°'},
      {label:'Ankle DF – knee bent (°)',          norm:'35–45°'},
      {label:'Patellar Mobility (mm)',            norm:'~10 mm each direction'},
      {label:'Thigh Girth – 10cm above patella (cm)', norm:'Compare bilaterally'},
      {label:'Effusion (cm diff)',                norm:'0 cm diff'},
    ]
  },
  ankle: {
    mmt: [
      'Dorsiflexion — tibialis anterior (L4)',
      'Plantar flexion — gastroc/soleus (S1)',
      'Inversion — tibialis posterior (L4)',
      'Eversion — peroneals (L5/S1)',
      'Great toe extension — EHL (L5)',
      'Great toe flexion — FHL',
      'Intrinsic foot muscles',
      'Single heel raise (endurance — reps to fatigue)',
    ],
    rom: [
      {label:'Dorsiflexion — knee straight (°)',         norm:'10–20°; reduced DF associated with plantar fasciitis & Achilles tendinopathy'},
      {label:'Dorsiflexion — knee bent (weight-bearing) (°)', norm:'35–45°; <38° = risk factor for lower limb injury'},
      {label:'Plantar Flexion (°)',                      norm:'40–50°'},
      {label:'Inversion (°)',                            norm:'30–35°'},
      {label:'Eversion (°)',                             norm:'15–20°'},
      {label:'1st MTP Extension (°)',                    norm:'60–90°; reduced = plantar fasciitis risk factor'},
      {label:'Subtalar Neutral (varus/valgus)',          norm:'Document & compare bilaterally'},
      {label:'Hindfoot alignment (varus/valgus)',        norm:'Neutral to slight valgus; hindfoot varus = peroneal risk'},
      {label:'Navicular Drop (mm)',                      norm:'<10 mm; >10 mm = excessive pronation / PTTD risk'},
      {label:'Arch Height Index (cm)',                   norm:'Document & compare bilaterally'},
      {label:'Calf Girth — 10 cm below tibial tuberosity (cm)', norm:'Compare bilaterally; asymmetry suggests atrophy'},
      {label:'Achilles tendon thickening (palpation)',  norm:'Uniform, no nodule; thickening suggests tendinopathy'},
    ]
  },
};

const SPECIAL_TESTS = {
  lumbar: [
    {name:'SLR — Ipsilateral (straight leg raise)',    purpose:'Lumbar disc herniation / nerve root irritation — 92% sensitive; positive <60° with leg pain reproduction'},
    {name:'SLR — Crossed (contralateral)',             purpose:'Disc herniation with central involvement — 90% specific; highly predictive of herniation'},
    {name:'Slump Test',                                purpose:'Neurodynamic tension — disc herniation, radiculopathy; often more sensitive than SLR'},
    {name:'Femoral Nerve Tension Test',                purpose:'Upper lumbar nerve root irritation — L2/L3/L4; positive with anterior thigh pain'},
    {name:'Prone Instability Test',                    purpose:'Lumbar segmental instability — pain reduced when muscles activated in prone'},
    {name:'Aberrant Movement Pattern Observation',     purpose:'Lumbar instability — painful arc, Gower\'s sign, lateral shift, instability catch'},
    {name:'Spring Test (posterior-anterior pressure)', purpose:'Segmental mobility / facet dysfunction — stiffness or pain reproduction at segment'},
    {name:'SI Provocation — Distraction',              purpose:'SI joint dysfunction — one test of the ≥3 cluster needed for diagnosis'},
    {name:'SI Provocation — Compression',              purpose:'SI joint dysfunction — pelvic compression in sidelying'},
    {name:'SI Provocation — Thigh Thrust',             purpose:'SI joint dysfunction — most sensitive single SI test'},
    {name:'SI Provocation — Gaenslen\'s Test',         purpose:'SI joint dysfunction — hip extension stress in sidelying'},
    {name:'SI Provocation — Sacral Thrust',            purpose:'SI joint dysfunction — anterior force through sacrum prone'},
    {name:'FABER Test (Patrick\'s)',                   purpose:'SI joint / hip pathology — reproduction of posterior pelvic pain'},
    {name:'Romberg Test',                              purpose:'Lumbar spinal stenosis / neurological compromise — balance/proprioception screening'},
    {name:'Vibration Sense (malleoli / great toe)',    purpose:'Lumbar spinal stenosis — decreased vibration sense in lower extremities'},
    {name:'Gait Assessment (wide-based)',              purpose:'Lumbar spinal stenosis — wide-based gait >90% specific, ~40% sensitive'},
    {name:'Dermatomal Sensory Testing',                purpose:'Nerve root level mapping — L3 (anterolateral thigh), L4 (medial leg), L5 (dorsum foot), S1 (lateral foot)'},
    {name:'Waddell\'s Signs (non-organic)',            purpose:'Psychosocial / non-organic pain factors — 3+ of 5 signs suggests non-organic component'}
  ],
  thoracic: [
    {name:'Thoracic Active ROM (inclinometer)',      purpose:'Segmental mobility — more reliable than visual estimate; note: rotation 40°, lat bend 26°, flex 21°, ext 13° are norms'},
    {name:'Segmental Mobility Testing (spring test)', purpose:'Thoracic segmental hypomobility / hypermobility — each vertebral level'},
    {name:'Thoracic Facet Loading (Ext + Rotation)', purpose:'Thoracic facet joint dysfunction — reproduction of local/referred pain'},
    {name:'Adam Forward Bend Test',                  purpose:'Structural scoliosis / Scheuermann\'s kyphosis — rib hump with forward flexion'},
    {name:'Rib Spring / Compression Test',           purpose:'Rib sprain / costovertebral dysfunction — pain with direct rib spring or lateral compression'},
    {name:'Costovertebral Joint Palpation',          purpose:'Costochondral / costovertebral injury — point tenderness over junction'},
    {name:'Scapular Assistance Test',                purpose:'Scapular dyskinesia — symptoms change when therapist manually assists scapular rotation'},
    {name:'Scapular Retraction Test',                purpose:'Scapular dyskinesia — symptoms change with passive scapular retraction'},
    {name:'Scapular Position Assessment (at rest)',  purpose:'Protraction, winging, asymmetry — visual inspection bilateral'},
    {name:'Dynamic Scapular Observation (arm raise)', purpose:'Scapular dyskinesia — abnormal scapular rhythm or winging during overhead motion'},
    {name:'Elevated Arm Stress Test (EAST / Roos)', purpose:'Thoracic outlet syndrome — sustained arm elevation reproduces UE symptoms'},
    {name:'Adson Test',                              purpose:'Thoracic outlet syndrome — radial pulse change with neck rotation + inspiration'},
    {name:'Wright Test (Hyperabduction)',            purpose:'Thoracic outlet syndrome — radial pulse or symptoms with full shoulder abduction'},
    {name:'Slump Test',                              purpose:'Thoracic neural tension / dural involvement'},
    {name:'Kyphosis Assessment (inclinometer)',      purpose:'Hyperkyphosis — normal standing T1–T12: 34–40°; rigid vs flexible differentiation'},
    {name:'Back Extensor Endurance (Biering-Sørensen)', purpose:'Kyphotic posture / Scheuermann\'s — back extensor weakness screening'}
  ],
  cervical: [
    {name:'Spurling Test (Compression)',        purpose:'Cervical radiculopathy — foraminal compression (positive LR for radiculopathy)'},
    {name:'Cervical Distraction Test',          purpose:'Radiculopathy / discogenic — relief with distraction suggests nerve root involvement'},
    {name:'Shoulder Abduction Relief Test',     purpose:'Radiculopathy — relief with hand-on-head position suggests foraminal compression'},
    {name:'Upper Limb Tension Test 1 (ULTT1)',  purpose:'Median nerve neurodynamics — C5/C6/C7 nerve root tension'},
    {name:'Upper Limb Tension Test 2 (ULTT2b)', purpose:'Radial nerve neurodynamics — C6/C7 nerve root tension'},
    {name:'Upper Limb Tension Test 3 (ULTT3)',  purpose:'Ulnar nerve neurodynamics — C8/T1 nerve root tension'},
    {name:'Cervical Flexion-Rotation Test',     purpose:'C1–C2 hypomobility — cervicogenic headache (>10° asymmetry = positive)'},
    {name:'Upper Cervical Segmental Mobility (C1–C3)', purpose:'Cervicogenic headache — manual assessment of upper cervical joints'},
    {name:'Cranial Cervical Flexion Test (CCFT)',purpose:'Deep neck flexor endurance — whiplash / instability screening'},
    {name:'Neck Flexor Endurance Test',         purpose:'Cervical muscle endurance — whiplash / postural dysfunction'},
    {name:'Facet Loading Maneuver (Ext + Rotation)', purpose:'Cervical facet syndrome — reproduction of local/referred pain'},
    {name:'Sharp-Purser Test',                  purpose:'Atlantoaxial instability (C1–C2) — use with caution; screen before manual Rx'},
    {name:'Vertebral Artery / VBI Screening',   purpose:'Vertebrobasilar insufficiency — mandatory before cervical manipulation'},
    {name:'DTR — Biceps (C5/C6)',               purpose:'Upper motor neuron / nerve root assessment'},
    {name:'DTR — Brachioradialis (C6)',         purpose:'C6 nerve root assessment'},
    {name:'DTR — Triceps (C7)',                 purpose:'C7 nerve root / upper motor neuron assessment'},
    {name:'Dermatomal Sensory Testing',         purpose:'Map numbness/tingling to cervical dermatome level'},
    {name:'Myotomal Strength Testing',          purpose:'Key muscles by level: C5 deltoid, C6 wrist ext, C7 triceps, C8 FDP, T1 interossei'}
  ],
  shoulder: [
    // Impingement / subacromial
    {name:'Hawkins-Kennedy Test',                 purpose:'Subacromial impingement / RC tendinopathy — 92% sensitive; internal rotation in 90° flexion'},
    {name:'Neer Impingement Sign',                purpose:'Subacromial impingement — 88% sensitive; passive forward flexion with IR'},
    {name:'Painful Arc Sign (60–120°)',           purpose:'Subacromial impingement / RC pathology — pain between 60–120° abduction; LR+ 3.7 for RC tear'},
    {name:'Infraspinatus Strength Test',          purpose:'RC impingement cluster — Hawkins + painful arc + infraspinatus weakness = 95% post-test probability'},
    // Rotator cuff integrity
    {name:'External Rotation Lag Test',           purpose:'Full-thickness RC tear (IR/supraspinatus) — LR+ 7.2; inability to maintain ER against gravity'},
    {name:'Internal Rotation Lag Test',           purpose:'Full-thickness subscapularis tear — LR+ 5.6; inability to maintain IR behind back'},
    {name:'Drop Arm Test',                        purpose:'Full-thickness supraspinatus tear — LR+ 3.3; inability to lower arm slowly from 90° ABD'},
    {name:'Empty Can Test (Jobe)',                purpose:'Supraspinatus tear / weakness — resisted elevation in scapular plane with IR'},
    {name:'Full Can Test',                        purpose:'Supraspinatus — resisted elevation in scapular plane with ER (less impingement provocation than empty can)'},
    {name:'Lift-Off Test',                        purpose:'Subscapularis tear — inability to lift hand off back in IR behind back'},
    {name:'Belly Press Test',                     purpose:'Subscapularis tear — resisted IR with elbow flexed; alternative to lift-off if IR limited'},
    // Labral / SLAP
    {name:'O\'Brien Active Compression Test',     purpose:'SLAP lesion — 90% sensitive; pain/click in pronation not supination suggests SLAP'},
    {name:'Dynamic Labral Shear Test',            purpose:'SLAP lesion — 72% sensitive, 98% specific, LR+ 31.6 — most specific single SLAP test'},
    {name:'Crank Test',                           purpose:'Labral tear — axial load + rotation in 160° elevation; O\'Brien + crank most sensitive in parallel'},
    {name:'Anterior Slide Test',                  purpose:'SLAP lesion — anterosuperior shoulder pain with resisted forward lean'},
    // Instability
    {name:'Apprehension Test',                    purpose:'Anterior GH instability — LR+ 8–100; patient fear/muscle guarding in ABD + ER'},
    {name:'Relocation Test',                      purpose:'Anterior instability — posterior force relieves apprehension; confirms anterior instability'},
    {name:'Release Test (Surprise Test)',          purpose:'Anterior instability — most predictive; sudden release of relocation force reproduces apprehension'},
    {name:'Load and Shift Test',                  purpose:'GH laxity/instability — LR+ >80 when positive; anterior/posterior humeral translation graded'},
    {name:'Sulcus Sign',                          purpose:'Multidirectional instability (MDI) — ≥2 cm inferior sulcus with distraction suggests MDI'},
    // Adhesive capsulitis / GH OA
    {name:'Global Passive ROM Assessment',        purpose:'Adhesive capsulitis / GH OA — global restriction of passive ROM, especially ER at side'},
    // AC joint
    {name:'AC Joint Palpation / Tenderness',      purpose:'AC joint pathology — 96% sensitive for AC joint disorder; direct palpation'},
    {name:'Cross-Body Adduction Test',            purpose:'AC joint pathology — horizontal adduction reproduces superior/anterior shoulder pain'},
    {name:'Paxinos Test',                         purpose:'AC joint OA — 79% sensitive; superior AC joint pressure reproduces pain; + bone scan = 99% post-test probability'},
    // Biceps
    {name:'Speed\'s Test',                        purpose:'LHB tendinopathy — 81% specific; resisted shoulder flexion with elbow extended and forearm supinated'},
    {name:'Yergason\'s Test',                     purpose:'LHB tendinopathy — 83–86% specific, LR+ 2.56; resisted supination + ER with elbow at 90°'},
    {name:'Upper Cut Test',                       purpose:'LHB tendinopathy — 77% accurate, LR+ 3.38; resisted shoulder flexion from hip level; bicipital groove tenderness + upper cut most accurate combination'},
    {name:'Bicipital Groove Tenderness',          purpose:'LHB tendinopathy — most common isolated finding; palpate with arm in 10° IR'},
    // Scapular
    {name:'Scapular Assistance Test',             purpose:'Scapular dyskinesis — symptoms improve with manual scapular upward rotation assistance'},
    {name:'Scapular Retraction Test',             purpose:'Scapular dyskinesis — strength or symptoms improve with passive scapular retraction'},
    {name:'Scapular Position / Winging Observation', purpose:'Scapular dyskinesis — yes/no classification of abnormal scapular position at rest and during arm elevation is reliable'},
    // TOS
    {name:'Elevated Arm Stress Test (EAST / Roos)', purpose:'Thoracic outlet syndrome — 3 min elevated arm opening/closing reproduces UE symptoms; most sensitive provocation test'},
    {name:'Adson Test',                           purpose:'Thoracic outlet syndrome — radial pulse change with neck rotation + inspiration; scalene compression'},
    {name:'Wright Test (Hyperabduction)',          purpose:'Thoracic outlet syndrome — radial pulse or symptoms with full shoulder ABD; pec minor compression'},
  ],
  elbow: [
    // Lateral elbow
    {name:'Cozen Test / Thomsen Test',                purpose:'Lateral epicondylalgia — 91% sensitive; resisted wrist extension with elbow extended reproduces lateral elbow pain'},
    {name:'Mill\'s Test',                             purpose:'Lateral epicondylalgia — passive wrist flexion + forearm pronation + elbow extension stretches common extensor origin'},
    {name:'Lateral Epicondyle Palpation',             purpose:'Lateral epicondylalgia — direct tenderness at lateral epicondyle / ECRB origin; most consistent isolated finding'},
    {name:'Grip Strength Assessment (dynamometer)',   purpose:'Lateral epicondylalgia — reduced grip strength 78–83% sensitive, 80–90% specific; compare bilaterally'},
    // Medial elbow
    {name:'Medial Epicondyle Palpation',              purpose:'Medial epicondylalgia — direct tenderness at medial epicondyle / common flexor-pronator origin'},
    {name:'Resisted Wrist Flexion Test',              purpose:'Medial epicondylalgia — pain with resisted wrist flexion; also screens for UCL stress'},
    {name:'Resisted Forearm Pronation Test',          purpose:'Medial epicondylalgia / pronator teres syndrome — pain with resisted forearm pronation'},
    // UCL
    {name:'Valgus Stress Test (20–30° flexion)',      purpose:'UCL sprain / insufficiency — medial joint line pain or laxity with valgus force at 20–30° elbow flexion'},
    {name:'Milking Maneuver',                         purpose:'UCL sprain — valgus stress applied by pulling thumb with elbow flexed >90° and forearm supinated'},
    {name:'Moving Valgus Stress Test',                purpose:'UCL sprain — most reliable test; valgus stress maintained while elbow cycled from full flexion to extension; pain at 70–120° = positive'},
    {name:'UCL / Sublime Tubercle Palpation',         purpose:'UCL sprain — tenderness 2 cm distal to medial epicondyle over UCL and sublime tubercle of ulna'},
    // Cubital tunnel / ulnar nerve
    {name:'Tinel\'s Sign (cubital tunnel)',           purpose:'Cubital tunnel syndrome — tapping over ulnar nerve at medial epicondyle reproduces tingling in ring/little fingers'},
    {name:'Elbow Flexion Test',                       purpose:'Cubital tunnel syndrome — sustained full elbow flexion + wrist extension for 60 sec reproduces ulnar paresthesias'},
    {name:'Shoulder IR Elbow Flexion Test',           purpose:'Cubital tunnel syndrome — 87% sensitive, 98% specific; shoulder IR + elbow flexion + wrist extension position'},
    {name:'Scratch Collapse Test',                    purpose:'Cubital tunnel syndrome — scratch stimulus over cubital tunnel causes momentary loss of ER resistance'},
    // Radial tunnel / PIN
    {name:'Radial Tunnel Palpation (3–4 cm distal to LE)', purpose:'Radial tunnel syndrome — tenderness 3–4 cm distal to lateral epicondyle over radial tunnel (anterior to radial neck)'},
    {name:'Resisted Supination Test',                 purpose:'Radial tunnel syndrome — pain with resisted supination stresses supinator / PIN at arcade of Frohse'},
    {name:'Resisted Middle Finger Extension Test',    purpose:'Radial tunnel syndrome — pain with resisted middle finger extension loads ECRB / PIN; differentiates from lateral epicondylalgia'},
    {name:'Finger Drop Assessment',                   purpose:'Posterior interosseous nerve syndrome (supinator syndrome) — inability to extend fingers / thumb with wrist in radial deviation (ECRL preserved)'},
    // Pronator teres / median nerve
    {name:'Pronator Teres Palpation',                 purpose:'Pronator teres syndrome — tenderness over proximal pronator teres, 4–6 cm distal to medial epicondyle'},
    {name:'Resisted Elbow Flexion (lacertus fibrosus)', purpose:'Pronator teres syndrome — pain with resisted elbow flexion + forearm supination compresses median nerve under lacertus fibrosus'},
    {name:'Resisted FDS Middle Finger Flexion',       purpose:'Pronator teres syndrome — pain with resisted PIP flexion of middle finger compresses median nerve at FDS arch'},
    {name:'Palmar Cutaneous Branch Sensation',        purpose:'Pronator teres vs CTS — palmar cutaneous branch is affected in pronator syndrome (spared in CTS); test sensation in proximal palm'},
    // Distal biceps
    {name:'Biceps Provocation Test',                  purpose:'Distal biceps tendinopathy — 95% sensitive, 97% specific; resisted supination with elbow at 90° reproduces anterior elbow pain'},
    {name:'Resisted Hook Test',                       purpose:'Distal biceps tendinopathy / rupture — 78% sensitive; hook finger under biceps tendon from lateral side; absent = rupture'},
    {name:'Palpation-Rotation Test',                  purpose:'Distal biceps partial tear — 100% sensitive for partial tears; palpate bicipital tuberosity during passive pronation/supination'},
    {name:'Hook Test (rupture)',                      purpose:'Distal biceps complete rupture — inability to hook finger under intact tendon from lateral side; most reliable single test'},
    {name:'Biceps Crease Interval (BCI)',             purpose:'Distal biceps rupture — BCI >6 cm (distance from antecubital crease to biceps muscle belly) suggests rupture'},
    {name:'Passive Forearm Pronation Test',           purpose:'Distal biceps rupture — pain/asymmetry with passive pronation; combined with hook test + BCI = 100% sensitivity/specificity'},
    {name:'Biceps Squeeze Test',                      purpose:'Distal biceps rupture — squeeze biceps belly produces forearm supination if tendon intact; absent = rupture'},
    // Elbow OA / general
    {name:'End-Range Elbow Stress (flexion/extension)', purpose:'Elbow OA / loose bodies — pain at end-range flexion or extension with overpressure; crepitus on palpation'},
  ],
  knee: [
    {name:'Lachman Test', purpose:'ACL integrity (87% sensitive, 97% specific)'},
    {name:'Anterior Drawer Test', purpose:'ACL laxity (supplementary to Lachman)'},
    {name:'Pivot Shift Test', purpose:'ACL rotational instability (49% sensitive, 98% specific)'},
    {name:'Posterior Drawer Test', purpose:'PCL integrity – posterior tibial sag sign'},
    {name:'Valgus Stress Test (0° and 30°)', purpose:'MCL integrity – grade I/II/III laxity'},
    {name:'Varus Stress Test (0° and 30°)', purpose:'LCL integrity / posterolateral corner'},
    {name:'McMurray Test', purpose:'Meniscal pathology (61% sensitive, 84% specific)'},
    {name:'Thessaly Test', purpose:'Meniscal tear – performed at 20° flexion'},
    {name:'Joint Line Palpation', purpose:'Meniscal tear (83% sensitive and specific)'},
    {name:'Patellar Grind / Clarke\'s Sign', purpose:'Patellofemoral pain syndrome / chondromalacia'},
    {name:'Patellar Compression Test', purpose:'PFPS – pain with sustained compression'},
    {name:'Patellar Apprehension Test', purpose:'Patellar instability / subluxation'},
    {name:'Ober Test', purpose:'IT band / TFL tightness'},
    {name:'Noble Compression Test', purpose:'IT band syndrome – pain at 30° flexion over lateral epicondyle'},
    {name:'Pes Anserine Palpation', purpose:'Pes anserine bursitis – 2cm distal to medial tibial plateau'},
    {name:'Patellar Tendon Palpation', purpose:'Patellar tendinopathy – inferior pole tenderness'},
    {name:'Single-Leg Squat Assessment', purpose:'Dynamic valgus / neuromuscular control screen'},
    {name:'Dial Test (30° and 90°)', purpose:'Posterolateral corner / external rotation asymmetry'}
  ],
  ankle: [
    // Lateral ankle ligament
    {name:'Anterior Drawer Test',                           purpose:'ATFL laxity — 100% specificity in acute setting; delayed exam (4–7 days) improves accuracy to 96% sensitive, 84% specific'},
    {name:'Talar Tilt Test',                                purpose:'CFL laxity (dorsiflexion position) / ATFL laxity (plantarflexion position); compare bilaterally; >5° asymmetry positive'},
    {name:'Ottawa Ankle Rules Assessment',                  purpose:'Fracture screening — bone tenderness at malleoli or base 5th metatarsal + inability to weight-bear; guides imaging'},
    // Syndesmosis / high ankle
    {name:'Syndesmosis Ligament Palpation',                 purpose:'High ankle sprain — 92% sensitive; tenderness over anterior tibiofibular ligament'},
    {name:'Dorsiflexion-External Rotation Stress Test',     purpose:'Syndesmotic sprain — 71% sensitive; DF + ER stress reproduces anterior ankle pain'},
    {name:'Squeeze Test (fibular compression)',             purpose:'Syndesmotic sprain — 88% specific; proximal fibular compression transmits pain to distal syndesmosis'},
    // Achilles
    {name:'Thompson Test',                                  purpose:'Achilles tendon rupture — absence of plantarflexion with calf squeeze confirms complete rupture'},
    {name:'Painful Arc Sign (Achilles)',                    purpose:'Achilles tendinopathy — 42% sensitive, 88% specific; pain moves with tendon in mid-portion; stays fixed at insertion'},
    {name:'Royal London Hospital Test',                     purpose:'Mid-portion Achilles tendinopathy — 54% sensitive, 86% specific; pain reduced when tendon under tension (dorsiflex)'},
    {name:'Mid-portion Achilles Palpation (2–6 cm)',        purpose:'Achilles tendinopathy — point tenderness 2–6 cm proximal to insertion distinguishes mid-portion from insertional'},
    {name:'Single Heel Raise Test (endurance)',             purpose:'Achilles / calf function — count to fatigue; compare bilaterally; <25 reps = clinically significant deficit'},
    // Plantar fascia
    {name:'Windlass Test (weight-bearing)',                 purpose:'Plantar fasciitis — passive great toe extension; weight-bearing position more sensitive than non-weight-bearing'},
    {name:'Medial Calcaneal Tuberosity Palpation',          purpose:'Plantar fasciitis — tenderness at medial calcaneal tuberosity is the most common isolated clinical finding'},
    // Tibialis posterior / PTTD
    {name:'Single-Limb Heel Raise Test',                    purpose:'PTTD — pain or inability to complete single heel raise; progressive inability indicates advancing PTTD stage'},
    {name:'Too Many Toes Sign',                             purpose:'PTTD / flatfoot — >2 toes visible lateral to tibia from behind due to hindfoot valgus and forefoot abduction'},
    {name:'Resisted Inversion (plantarflexed foot)',        purpose:'PTTD — pain or weakness with resisted inversion in plantarflexion isolates tibialis posterior'},
    {name:'Medial Arch Palpation (tibialis posterior)',     purpose:'PTTD — tenderness along tibialis posterior tendon from medial malleolus to navicular insertion'},
    // Anterior tibialis
    {name:'Resisted Dorsiflexion Test',                     purpose:'Anterior tibialis tendinopathy — pain with resisted dorsiflexion reproduces anterior ankle / medial midfoot pain'},
    {name:'Tibialis Anterior Passive Stretch',              purpose:'Anterior tibialis tendinopathy — pain with passive plantarflexion + inversion stretches tendon over dorsum'},
    // Peroneal
    {name:'Peroneal Compression Test',                      purpose:'Peroneal tendinopathy — pain along fibular groove with resisted plantarflexion/eversion'},
    {name:'Resisted Eversion & Plantarflexion',             purpose:'Peroneal tendinopathy — pain or weakness with combined resisted eversion and plantarflexion'},
    {name:'Peroneal Tendon Subluxation Test',               purpose:'Peroneal subluxation — tendon snaps over posterior fibula with active dorsiflexion/eversion + palpation'},
    // Tarsal tunnel
    {name:'Tinel\'s Sign (posterior tibial nerve)',         purpose:'Tarsal tunnel syndrome — tapping posterior to medial malleolus reproduces burning/tingling; sensory loss sparing heel is distinctive'},
    {name:'Dorsiflexion-Eversion Test',                     purpose:'Tarsal tunnel syndrome — maximal DF + eversion sustains for 5–10 sec reproduces symptoms'},
    {name:'Plantar Flexion-Inversion Test',                 purpose:'Tarsal tunnel syndrome — maximal PF + inversion sustains for 5–10 sec reproduces symptoms'},
    // Morton's neuroma
    {name:'Thumb-Index Finger Squeeze (webspace)',          purpose:'Morton\'s neuroma — tenderness with webspace compression between MT heads; 3rd–4th interspace most common'},
    {name:'Mulder\'s Sign',                                 purpose:'Morton\'s neuroma — palpable click with simultaneous lateral MT head compression; 97.5% confirmed histologically'},
    // Metatarsalgia / forefoot
    {name:'Metatarsal Head Palpation',                      purpose:'Metatarsalgia — tenderness over MT heads with plantar pressure; assess for callus pattern'},
    {name:'Ankle OA End-Range Stress Test',                 purpose:'Ankle OA — pain reproduced at end-range dorsiflexion and plantarflexion with overpressure'},
    // Functional
    {name:'Single Leg Balance (eyes open / closed)',        purpose:'Proprioception / chronic ankle instability — compare bilaterally; eyes closed <10 sec = significant deficit'},
    {name:'Y-Balance Test (anterior reach)',                purpose:'Dynamic balance / injury risk — anterior reach asymmetry >4 cm = elevated re-injury risk'},
    {name:'Navicular Drop Test',                            purpose:'Tibialis posterior dysfunction / pronation — >10 mm navicular drop = abnormal; risk factor for PTTD and plantar fasciitis'},
    {name:'Coleman Block Test',                             purpose:'Rigid vs flexible cavovarus — differentiates hindfoot-driven from forefoot-driven deformity'},
  ],
  pelvis: [
    // Hip intra-articular
    {name:'FADIR Test',                                  purpose:'FAI / labral tear — best screening tool; absence rules out FAI; high sensitivity for intra-articular pathology'},
    {name:'FABER Test (Patrick\'s)',                     purpose:'Hip OA / labral tear / SI joint — groin pain = hip intra-articular; buttock pain = SI joint'},
    {name:'Arlington / Anterior Impingement Test (AIT)', purpose:'Hip labral tear — 94% sensitive; groin pain + positive FABER + positive AIT = 97% sensitivity'},
    {name:'Log Roll Test',                               purpose:'Intra-articular hip pathology — passive IR/ER in supine; groin pain suggests capsular/labral involvement'},
    {name:'Hip Scour Test',                              purpose:'Intra-articular hip pathology — circumduction under axial load reproduces groin pain'},
    {name:'Squat Test',                                  purpose:'Hip OA — posterior pain with squat LR+ 6.1; groin pain on ABD/ADD LR+ 5.7; ≥4 findings LR+ 4.9'},
    {name:'Passive Hip Adduction (range & pain)',        purpose:'Hip OA — decreased passive adduction LR+ 4.2; most restricted motion alongside IR'},
    {name:'Restricted IR at 0° hip flexion',             purpose:'FAI — restricted IR in neutral best to rule in FAI; compare bilaterally'},
    // Hip flexor / iliopsoas
    {name:'Resisted Hip Flexion (seated)',               purpose:'Hip flexor strain / iliopsoas tendinopathy — pain with resisted hip flexion in seated position'},
    {name:'HEC Test (Hip Extension / External Rotation Compression)', purpose:'Iliopsoas tendinopathy — 94% sensitive, 88% specific; compression of iliopsoas against anterior hip capsule'},
    {name:'Passive Hip Extension (stretch)',             purpose:'Hip flexor strain — pain with passive hip extension stretches anterior hip structures'},
    {name:'Thomas Test',                                 purpose:'Hip flexor tightness — contralateral hip rises from table with ipsilateral hip flexion'},
    // Hamstring / proximal
    {name:'Active Hamstring Test at 30°',                purpose:'Proximal hamstring tendinopathy — combined 30° + 90°: 84% sensitive, 97% specific, LR+ 26.9'},
    {name:'Active Hamstring Test at 90°',                purpose:'Proximal hamstring tendinopathy — combined with 30° test; pain at ischial tuberosity'},
    {name:'Puranen-Orava Test',                          purpose:'Proximal hamstring tendinopathy — standing stretch: hand to ipsilateral foot with knee extended'},
    {name:'Ischial Tuberosity Palpation',                purpose:'Proximal hamstring tendinopathy / hamstring strain — point tenderness at ischial tuberosity'},
    {name:'Resisted Knee Flexion (prone)',               purpose:'Hamstring strain — pain or weakness with resisted knee flexion; assess for strength deficit'},
    // Adductor / athletic pubalgia
    {name:'Adductor Squeeze Test (0° and 45°)',          purpose:'Adductor strain — pain with resisted adduction; 45° most sensitive for adductor origin pathology'},
    {name:'Cross-Body Sit-Up Test',                      purpose:'Athletic pubalgia / sports hernia — 100% sensitive; pain with resisted diagonal sit-up'},
    {name:'Pubic Tubercle / Rectus Insertion Palpation', purpose:'Athletic pubalgia — tenderness over pubic tubercle or rectus abdominis insertion'},
    {name:'Adductor Contracture Test',                   purpose:'Athletic pubalgia — 100% sensitive; restricted passive abduction due to adductor tightness'},
    // Gluteal / lateral hip
    {name:'Single Leg Stance Test (30 sec)',             purpose:'Gluteal tendinopathy — pain within 30 sec = 100% specificity; most specific test for gluteal tendinopathy'},
    {name:'Resisted External Derotation Test',           purpose:'Gluteal tendinopathy / GTPS — resisted ER in hip flexion reproduces lateral hip pain'},
    {name:'Greater Trochanter Palpation',                purpose:'GTPS / gluteal tendinopathy — 80% sensitive; direct palpation over greater trochanteric footprint'},
    {name:'Trendelenburg Test',                          purpose:'Gluteus medius weakness / GTPS — positive if pelvis drops on contralateral side in single leg stance'},
    // Piriformis / deep gluteal
    {name:'Seated Piriformis Stretch Test',              purpose:'Piriformis / deep gluteal syndrome — seated hip IR reproduces buttock/sciatic pain'},
    {name:'Pace Sign',                                   purpose:'Piriformis syndrome — pain with resisted hip abduction + ER in seated position'},
    {name:'Sciatic Notch Palpation',                     purpose:'Deep gluteal syndrome — tenderness over greater sciatic notch / piriformis belly'},
    // Snapping hip
    {name:'Dynamic Hip Snap Observation',                purpose:'Snapping hip syndrome — audible/palpable snap with active hip flexion/extension; lateral = IT band; anterior = iliopsoas'},
    // SI joint
    {name:'SI Provocation — Thigh Thrust',               purpose:'SI joint dysfunction — most sensitive single SI test; posterior force through femur'},
    {name:'SI Provocation — Distraction',                purpose:'SI joint dysfunction — part of ≥3 positive cluster required for diagnosis'},
    {name:'SI Provocation — Compression',                purpose:'SI joint dysfunction — pelvic compression in sidelying'},
    {name:'SI Provocation — Gaenslen\'s Test',           purpose:'SI joint dysfunction — hip extension stress in sidelying'},
    {name:'SI Provocation — Sacral Thrust',              purpose:'SI joint dysfunction — anterior force through sacrum prone'},
    // Pelvic girdle pain
    {name:'Active Straight Leg Raise (ASLR)',            purpose:'Pelvic girdle pain / PGP — inability to raise leg without pelvic instability; improves with pelvic compression'},
    {name:'Posterior Pelvic Pain Provocation (P4)',      purpose:'Pelvic girdle pain — posterior pelvic pain with hip flexion + axial load in sidelying'},
    {name:'Long Dorsal Ligament Palpation',              purpose:'Pelvic girdle pain — 76–98% sensitive; tenderness over posterior SIJ / long dorsal SI ligament'},
    // Stress fracture
    {name:'Hop Test',                                    purpose:'Femoral neck stress fracture — single-leg hop reproduces pain; urgent refer if positive'},
    {name:'Fulcrum Test',                                purpose:'Femoral neck stress fracture — thigh fulcrum with fist reproduces anterior groin/thigh pain'},
    {name:'Heel Percussion Test',                        purpose:'Femoral neck / pubic ramus stress fracture — heel strike vibration transmits to fracture site'},
    // Other
    {name:'Ober Test',                                   purpose:'IT band / TFL tightness — hip fails to adduct to neutral in sidelying'},
    {name:'Ely\'s Test',                                 purpose:'Rectus femoris tightness — prone knee flexion causes ipsilateral hip to flex'},
    {name:'Step-Down Test',                              purpose:'Hip abductor control — contralateral pelvic drop and ipsilateral knee cave during step descent'},
  ],
  
};

const DDX_LOGIC = {
  lumbar: [
    {
      name: 'Lumbar Disc Herniation',
      ageNote: 'Peak 30–50 years; more common in males',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Radiating pain (leg)')||s.has('Leg pain greater than back pain')) score+=4;
        if(s.has('Paresthesias (dermatomal)')||s.has('Numbness')||s.has('Tingling')) score+=3;
        if(s.has('Weakness (lower extremity)')) score+=2;
        if(a.has('Bending forward (flexion)')||a.has('Prolonged sitting')) score+=2;
        if(a.has('Sneezing / coughing (Valsalva)')||a.has('Lifting')) score+=3;
        if(al.has('Walking')||al.has('Lying down')||al.has('Extension / back bend')) score+=2;
        if(tests['SLR — Ipsilateral (straight leg raise)']==='+') score+=4;
        if(tests['SLR — Crossed (contralateral)']==='+') score+=4;
        if(tests['Slump Test']==='+') score+=3;
        if(age) {
          if(age >= 30 && age <= 50) score+=3;
          else if(age >= 25 && age < 30) score+=1;
          else if(age >= 51 && age <= 60) score+=1;
          else if(age > 60) score = Math.max(0, score - 1);
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:'Lumbar disc herniation peaks at 30–50 years and is more common in males. The classic presentation is leg pain greater than back pain in a dermatomal distribution, often with associated paresthesias. The ipsilateral SLR is 92% sensitive; the crossed SLR is 90% specific and highly predictive of herniation. Key nerve root deficits: L5 causes great toe weakness; S1 causes plantar flexion weakness and reduced ankle reflex. Conservative PT including McKenzie extension, neural mobilization, and core stabilization is first-line; refer if progressive neurological deficit.',
      exercises:[
        {icon:'🔄', name:'McKenzie Extension Press-Ups', sets:'3x10 reps', desc:'Promotes posterior disc movement if centralization occurs with extension — reassess response.'},
        {icon:'🚶', name:'Walking Program', sets:'20–30 min/day', desc:'Extension-biased activity that promotes disc nutrition and nerve mobility.'},
        {icon:'🔄', name:'Neural Flossing (sciatic nerve)', sets:'2x10 gentle glides', desc:'Sciatic nerve mobilization to reduce neural adhesion — stop if symptoms worsen.'},
        {icon:'💪', name:'Dead Bug (core stabilization)', sets:'3x8 each side', desc:'Deep core stability in lumbar-neutral position to protect recovering disc.'}
      ]
    },
    {
      name: 'Lumbar Spinal Stenosis',
      ageNote: 'Typically >60 years; prevalence 47.2% in >60 years vs 20% in <40 years',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Neurogenic claudication')) score+=5;
        if(s.has('Bilateral leg symptoms')) score+=3;
        if(s.has('Numbness')||s.has('Tingling')||s.has('Paresthesias (dermatomal)')) score+=2;
        if(s.has('Weakness (lower extremity)')) score+=1;
        if(a.has('Prolonged walking')||a.has('Prolonged standing')) score+=3;
        if(a.has('Bending backward (extension)')) score+=3;
        if(al.has('Sitting')||al.has('Bending forward')||al.has('Bending forward over shopping cart')) score+=4;
        if(tests['Romberg Test']==='+') score+=2;
        if(tests['Gait Assessment (wide-based)']==='+') score+=3;
        if(tests['Vibration Sense (malleoli / great toe)']==='+') score+=2;
        if(age) {
          if(age >= 70) score+=5;
          else if(age >= 60) score+=4;
          else if(age >= 50) score+=2;
          else if(age < 40) score = Math.max(0, score - 2);
        }
        return score;
      },
      edu:'Lumbar spinal stenosis is the most common spinal surgery indication in adults over 65. The hallmark is neurogenic claudication — bilateral leg pain, heaviness, or paresthesias with walking or standing that relieves within minutes of sitting or flexing forward ("shopping cart sign"). Wide-based gait is >90% specific. Absence of pain while sitting is 52–70% sensitive and 55–83% specific. Flexion-based PT, aquatic therapy, and stationary cycling are well-tolerated; refer if conservative management fails after 6–12 weeks.',
      exercises:[
        {icon:'🚲', name:'Recumbent / Stationary Cycling', sets:'15–20 min', desc:'Flexed spinal position maintains canal space while building cardiovascular endurance.'},
        {icon:'🧘', name:'Lumbar Flexion in Lying (knees to chest)', sets:'3x10 reps', desc:'Gentle canal-opening flexion exercise in unloaded position.'},
        {icon:'💺', name:'Seated Forward Lean', sets:'3x30 sec', desc:'Opens the spinal canal and relieves neurogenic claudication during daily activities.'},
        {icon:'🦵', name:'Aquatic Walking / Pool Therapy', sets:'20–30 min', desc:'Buoyancy reduces spinal load — ideal for patients limited by claudication on land.'}
      ]
    },
    {
      name: 'Lumbar Radiculopathy',
      ageNote: 'Prevalence 3–5% of population; peak varies — disc herniation 30–50 years, stenosis >60 years',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Leg pain greater than back pain')) score+=5;
        if(s.has('Radiating pain (leg)')||s.has('Paresthesias (dermatomal)')) score+=3;
        if(s.has('Numbness')||s.has('Tingling')) score+=2;
        if(s.has('Weakness (lower extremity)')) score+=2;
        if(a.has('Prolonged sitting')||a.has('Sneezing / coughing (Valsalva)')) score+=2;
        if(al.has('Position changes')||al.has('Walking')) score+=1;
        if(tests['SLR — Ipsilateral (straight leg raise)']==='+') score+=4;
        if(tests['Slump Test']==='+') score+=3;
        if(tests['Dermatomal Sensory Testing']==='+') score+=3;
        return score;
      },
      edu:'Lumbar radiculopathy is defined by leg pain in a dermatomal distribution, typically greater than back pain. It results from nerve root compression (most commonly L4/L5/S1) due to disc herniation or stenosis. Key neurological findings by level: L4 (medial leg/foot, quad weakness, reduced patellar reflex), L5 (dorsum of foot, EHL weakness), S1 (lateral foot/heel, plantar flexion weakness, reduced Achilles reflex). Neurodynamic mobilization, directional preference exercises, and nerve root-specific motor re-education are cornerstones of treatment.',
      exercises:[
        {icon:'🔄', name:'Neural Flossing — Sciatic (L4/L5/S1)', sets:'2x10 gentle glides', desc:'Nerve mobilization — use sliding technique (not tensioning) acutely to avoid aggravation.'},
        {icon:'🔄', name:'Neural Flossing — Femoral (L2/L3/L4)', sets:'2x10 gentle glides', desc:'For anterior thigh/knee symptoms — prone knee bend with hip extension.'},
        {icon:'💪', name:'Level-Specific Motor Re-education', sets:'3x15 target muscle', desc:'L4: quad sets; L5: toe extension; S1: calf raises — targeted to weak myotome.'},
        {icon:'🧘', name:'Directional Preference Exercise (McKenzie)', sets:'3x10 reps', desc:'Extension or flexion bias based on centralization response — individualize to patient.'}
      ]
    },
    {
      name: 'Sacroiliac Joint Dysfunction',
      ageNote: 'Any age; more common in women, especially postpartum',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Unilateral buttock pain')||s.has('Posterior pelvic pain')) score+=4;
        if(s.has('Deep ache')) score+=1;
        // SIJ pain rarely goes below knee — penalize if distal leg symptoms dominate
        if(s.has('Leg pain greater than back pain')) score = Math.max(0, score - 2);
        if(a.has('Standing on one leg')||a.has('Transitional movements (sit-to-stand)')) score+=3;
        if(a.has('Prolonged sitting')||a.has('Stair climbing')) score+=2;
        if(al.has('Avoiding asymmetric loading')||al.has('Rest')) score+=2;
        // SI cluster — ≥3 positive tests significantly increases diagnostic probability
        const siTests = [
          tests['SI Provocation — Distraction'],
          tests['SI Provocation — Compression'],
          tests['SI Provocation — Thigh Thrust'],
          tests['SI Provocation — Gaenslen\'s Test'],
          tests['SI Provocation — Sacral Thrust'],
          tests['FABER Test (Patrick\'s)']
        ].filter(t => t === '+').length;
        if(siTests >= 3) score+=6;
        else if(siTests === 2) score+=3;
        else if(siTests === 1) score+=1;
        if(sex === 'female') score+=2;
        return score;
      },
      edu:'SI joint dysfunction causes unilateral buttock and posterior pelvic pain that rarely radiates below the knee (distinguishing it from radiculopathy). Pain with weight-bearing on the affected side and transitional movements (sit-to-stand) are characteristic. Diagnosis requires ≥3 positive SI provocation tests from the cluster (distraction, compression, thigh thrust, Gaenslen\'s, sacral thrust) — a single positive test is insufficient. The thigh thrust is the most sensitive single test. Treatment includes lumbopelvic stabilization, SIJ manipulation, and postpartum pelvic girdle rehabilitation.',
      exercises:[
        {icon:'🌉', name:'Glute Bridges (bilateral → single leg progression)', sets:'3x15 reps', desc:'Posterior chain activation and lumbopelvic stability — cornerstone of SIJ rehab.'},
        {icon:'💪', name:'Clamshells / Hip Abduction', sets:'3x15 each side', desc:'Gluteus medius strengthening to reduce asymmetric pelvic loading.'},
        {icon:'🧘', name:'Active SIJ Self-Mobilization', sets:'3x10 reps', desc:'Supine posterior rotation technique to restore SIJ mobility.'},
        {icon:'🦵', name:'Single Leg Balance Progression', sets:'3x30 sec each leg', desc:'Proprioception and lumbopelvic stability — progress to dynamic surfaces.'}
      ]
    },
    {
      name: 'Lumbar Instability',
      ageNote: 'Variable age; may be associated with spondylolisthesis or degenerative changes',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Giving way / instability')) score+=5;
        if(s.has('Pain with transitional movements')) score+=4;
        if(s.has('Deep ache')||s.has('Muscle spasm / guarding')) score+=1;
        if(a.has('Activities requiring dynamic spinal control')||a.has('Repetitive movements')||a.has('Lifting')) score+=2;
        if(a.has('Transitional movements (sit-to-stand)')) score+=2;
        if(al.has('Lumbar support / brace')||al.has('Core stabilization')) score+=3;
        if(tests['Prone Instability Test']==='+') score+=4;
        if(tests['Aberrant Movement Pattern Observation']==='+') score+=4;
        return score;
      },
      edu:'Lumbar instability is characterized by a "giving way" sensation, pain with movement transitions, and aberrant movement patterns (painful arc, lateral shift, Gower\'s sign). It may be associated with spondylolisthesis or degenerative changes. The prone instability test helps differentiate — pain reproduced in prone that resolves when the patient activates their muscles suggests instability. Core stabilization targeting the transversus abdominis and multifidus is the primary treatment.',
      exercises:[
        {icon:'💪', name:'Transversus Abdominis Activation', sets:'3x10, 10 sec hold', desc:'Foundation of lumbar stabilization — "drawing in" in neutral spinal position.'},
        {icon:'🌉', name:'Multifidus Co-Contraction (bird-dog)', sets:'3x8 each side, 5 sec hold', desc:'Deep segmental stabilizer activation — progress to dynamic with limb loading.'},
        {icon:'🧘', name:'Side Plank Progression', sets:'3x20–45 sec', desc:'Lateral core stability to control frontal plane instability.'},
        {icon:'🦵', name:'Functional Movement Retraining', sets:'3x10 reps', desc:'Sit-to-stand, step training, and lifting mechanics — addresses provocative transitional movements.'}
      ]
    },
    {
      name: 'Lumbar Osteoarthritis / Degenerative Joint Disease',
      ageNote: 'Increases with age; more common >45 years',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Deep ache')||s.has('Diffuse axial low back pain')) score+=3;
        if(s.has('Morning stiffness (<30 min)')) score+=3;
        if(s.has('Stiffness')) score+=2;
        // No radicular symptoms
        if(!s.has('Radiating pain (leg)') && !s.has('Leg pain greater than back pain')) score+=2;
        if(a.has('Weight-bearing activities')||a.has('Prolonged standing')) score+=2;
        if(a.has('Bending backward (extension)')||a.has('Rotation / twisting')) score+=2;
        if(al.has('Rest')||al.has('Heat')) score+=2;
        if(tests['Spring Test (posterior-anterior pressure)']==='+') score+=2;
        if(age) {
          if(age >= 65) score+=4;
          else if(age >= 55) score+=3;
          else if(age >= 45) score+=2;
          else if(age < 40) score = Math.max(0, score - 2);
        }
        return score;
      },
      edu:'Lumbar osteoarthritis involves degeneration of the facet joints and intervertebral discs. Morning stiffness lasting less than 30 minutes, axial back pain worsening with activity, and reduced extension/rotation are characteristic. Imaging typically shows degenerative changes but must correlate clinically — degeneration on MRI is common in asymptomatic adults. Exercise therapy (aquatic, cycling, strengthening) is the most evidence-based treatment; activity modification and load management are key.',
      exercises:[
        {icon:'🚲', name:'Stationary Cycling', sets:'15–20 min, low resistance', desc:'Joint-friendly aerobic exercise that maintains lumbar mobility without impact loading.'},
        {icon:'🌀', name:'Cat-Cow Mobilization', sets:'3x10 reps', desc:'Controlled lumbar mobility through available range — reduces stiffness.'},
        {icon:'💪', name:'Core Strengthening (plank progression)', sets:'3x20–45 sec', desc:'Spinal support without excessive extension loading.'},
        {icon:'🧘', name:'Aquatic Walking / Hydrotherapy', sets:'20–30 min', desc:'Buoyancy reduces spinal compressive load — ideal for activity-limited patients.'}
      ]
    },
    {
      name: 'Chronic Non-Specific Low Back Pain',
      ageNote: 'Peak 40–69 years; more common in women (40.6% vs 37.2% in men); 84% lifetime prevalence',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Diffuse axial low back pain')) score+=4;
        if(s.has('Deep ache')||s.has('Stiffness')||s.has('Muscle spasm / guarding')) score+=2;
        // Non-specific: no radicular or instability features
        if(!s.has('Leg pain greater than back pain') && !s.has('Radiating pain (leg)') && !s.has('Neurogenic claudication') && !s.has('Giving way / instability')) score+=3;
        if(a.has('Prolonged sitting')||a.has('Prolonged standing')||a.has('Bending forward (flexion)')) score+=2;
        if(al.has('Rest')||al.has('Position changes')||al.has('Activity modification')) score+=2;
        // Diagnosis of exclusion — penalize if specific tests positive
        if(tests['SLR — Ipsilateral (straight leg raise)']==='+') score = Math.max(0, score - 3);
        if(tests['SI Provocation — Thigh Thrust']==='+') score = Math.max(0, score - 2);
        if(tests['Prone Instability Test']==='+') score = Math.max(0, score - 2);
        if(age) {
          if(age >= 40 && age <= 69) score+=2;
        }
        if(sex === 'female') score+=1;
        return score;
      },
      edu:'Non-specific LBP is a diagnosis of exclusion after ruling out red flags (malignancy, fracture, infection, cauda equina) and specific pathology. It accounts for ~85% of all low back pain presentations. Pain is diffuse, difficult to localize, without radicular or neurological features. Biopsychosocial factors (fear-avoidance, catastrophizing, sleep, work demands) are major contributors to chronicity. Active rehabilitation, graded exposure, pain education, and addressing psychosocial factors are the most evidence-based treatments — passive modalities alone are insufficient.',
      exercises:[
        {icon:'🚶', name:'Graded Walking Program', sets:'Start 10 min, progress by 5 min/week', desc:'Most evidence-based aerobic intervention for non-specific LBP — reduces pain and disability.'},
        {icon:'💪', name:'General Strengthening (deadlift progression)', sets:'3x10 reps, progressive load', desc:'Hip-hinge and posterior chain strengthening — reduces LBP recurrence.'},
        {icon:'🧘', name:'Pain Neuroscience Education', sets:'1–2 sessions', desc:'Reconceptualizing pain as a protective response — reduces fear-avoidance and catastrophizing.'},
        {icon:'🌀', name:'Yoga / Mind-Body Movement', sets:'2–3x/week', desc:'Combines mobility, strengthening, and relaxation — strong evidence for chronic LBP.'}
      ]
    }
  ],
  pelvis: [
    {
      name: 'Hip Osteoarthritis',
      ageNote: '>45 years; more common in women; prevalence increases with age',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Deep groin pain')||s.has('Anterior hip / groin pain')) score+=4;
        if(s.has('Morning stiffness (<30 min)')) score+=3;
        if(s.has('Stiffness')||s.has('Deep ache')) score+=2;
        if(s.has('Referred pain to thigh')||s.has('Referred pain to knee')) score+=1;
        if(a.has('Walking / ambulation')||a.has('Ascending stairs')) score+=2;
        if(a.has('End-range hip movements')||a.has('Transitional movements (sit-to-stand)')) score+=2;
        if(al.has('Rest')||al.has('Non-weight-bearing')) score+=2;
        // LR+ data from reference doc
        if(tests['Squat Test']==='+') score+=4;                       // LR+ 6.1 posterior; LR+ 5.7 groin on ABD/ADD
        if(tests['Passive Hip Adduction (range & pain)']==='+') score+=3; // LR+ 4.2
        if(tests['FABER Test (Patrick\'s)']==='+') score+=2;
        if(tests['Log Roll Test']==='+') score+=2;
        // ≥4 positive findings = LR+ 4.9
        const oaFindings = [tests['Squat Test'], tests['Passive Hip Adduction (range & pain)'], tests['FABER Test (Patrick\'s)'], tests['Log Roll Test'], tests['Hip Scour Test']].filter(t=>t==='+').length;
        if(oaFindings >= 4) score+=5;
        if(age) {
          if(age >= 65) score+=4;
          else if(age >= 55) score+=3;
          else if(age >= 45) score+=2;
          else if(age < 40) score=Math.max(0,score-3);
        }
        if(sex==='female') score+=1;
        return score;
      },
      edu:'Hip OA presents with deep groin pain, morning stiffness <30 minutes, and progressive loss of IR and adduction (the earliest and most restricted motions). The squat test (LR+ 6.1 for posterior pain, LR+ 5.7 for groin on ABD/ADD) and decreased passive adduction (LR+ 4.2) are the most diagnostically powerful tests; ≥4 positive findings yields LR+ 4.9. Exercise therapy (strengthening, aquatic, cycling) is the gold standard; total hip replacement is highly effective when conservative management fails.',
      exercises:[
        {icon:'🚲', name:'Stationary Cycling (raised seat)', sets:'15–20 min, low resistance', desc:'Joint-friendly aerobic exercise — maintains hip ROM and builds quad/glute strength.'},
        {icon:'💪', name:'Hip Abductor Strengthening (sidelying)', sets:'3x15 each side', desc:'Reduces joint loading forces and compensatory Trendelenburg gait.'},
        {icon:'🌉', name:'Glute Bridges', sets:'3x15 reps', desc:'Hip extensor activation with minimal joint compressive load.'},
        {icon:'🧘', name:'Aquatic Walking / Hydrotherapy', sets:'20–30 min', desc:'Buoyancy reduces hip compressive load — ideal for activity-limited patients.'}
      ]
    },
    {
      name: 'Hip Labral Tear',
      ageNote: 'Young athletes 20–40 years; associated with sports requiring hip rotation',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior hip / groin pain')||s.has('Deep groin pain')) score+=3;
        if(s.has('Clicking / snapping (hip)')||s.has('Locking / catching sensation')) score+=4;
        if(s.has('Giving way')) score+=2;
        if(a.has('Pivoting / rotation')||a.has('Deep squatting')) score+=3;
        if(a.has('Prolonged sitting (>30 min)')||a.has('Hip flexion activities')) score+=2;
        if(al.has('Rest')||al.has('Avoiding deep hip flexion')) score+=2;
        if(tests['FADIR Test']==='+') score+=4;
        if(tests['Arlington / Anterior Impingement Test (AIT)']==='+') score+=5; // 94% sensitive
        if(tests['FABER Test (Patrick\'s)']==='+') score+=3;
        // groin pain + positive FABER + positive AIT = 97% sensitivity
        if(tests['Arlington / Anterior Impingement Test (AIT)']==='+' && tests['FABER Test (Patrick\'s)']==='+') score+=4;
        if(age) {
          if(age >= 18 && age <= 40) score+=3;
          else if(age >= 41 && age <= 50) score+=1;
          else if(age > 55) score=Math.max(0,score-2);
        }
        return score;
      },
      edu:'Hip labral tears commonly present with anterior groin pain, a "C-sign," and mechanical symptoms (clicking, catching, locking). The Arlington Impingement Test is 94% sensitive; combining groin pain + positive FABER + positive AIT yields 97% sensitivity. MR arthrography is the gold standard for diagnosis. Conservative PT (hip stabilizer strengthening, movement retraining, activity modification) is first-line; surgical labral repair is considered after 3–6 months failed conservative management.',
      exercises:[
        {icon:'💪', name:'Hip Stabilizer Strengthening (ABD, ER)', sets:'3x15 each', desc:'Reduces abnormal femoral translation that stresses the labrum.'},
        {icon:'🧘', name:'Movement Pattern Retraining', sets:'3x10 functional reps', desc:'Hip hinge and squat mechanics — avoid hip adduction/IR loading pattern.'},
        {icon:'🌉', name:'Glute Bridges → Single Leg Progression', sets:'3x15 → 3x10 SL', desc:'Progressive posterior chain loading in non-provocative range.'},
        {icon:'🚲', name:'Stationary Cycling (raised seat)', sets:'15 min', desc:'Aerobic conditioning with reduced impingement range exposure.'}
      ]
    },
    {
      name: 'Femoroacetabular Impingement (FAI)',
      ageNote: 'Young, athletic patients; gradual onset; history of SCFE or DDH increases risk',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Deep groin pain')||s.has('Anterior hip / groin pain')) score+=3;
        if(s.has('Stiffness')) score+=2;
        if(a.has('Hip flexion activities')||a.has('Prolonged sitting (>30 min)')) score+=3;
        if(a.has('Pivoting / rotation')||a.has('Deep squatting')) score+=3;
        if(al.has('Rest')||al.has('Avoiding deep hip flexion')) score+=2;
        if(tests['FADIR Test']==='+') score+=5;   // best screening; absence rules out
        if(tests['FABER Test (Patrick\'s)']==='+') score+=3; // absence rules out
        if(tests['Restricted IR at 0° hip flexion']==='+') score+=4; // best to rule in
        if(age) {
          if(age >= 16 && age <= 40) score+=3;
          else if(age >= 41 && age <= 50) score+=1;
          else if(age > 55) score=Math.max(0,score-2);
        }
        return score;
      },
      edu:'FAI results from abnormal bony morphology (cam = femoral head asphericity; pincer = acetabular overcoverage) causing mechanical impingement during hip flexion and rotation. The FADIR test is the best screening tool — its absence helps rule out FAI. Restricted IR in neutral hip flexion is the best single finding to rule in FAI. Conservative PT is first-line; surgical FAI correction (arthroscopic osteoplasty) is considered after 3–6 months failed conservative management.',
      exercises:[
        {icon:'💪', name:'Hip Abductor & ER Strengthening', sets:'3x15 each direction', desc:'Reduces femoral adduction/IR during dynamic activities — decreases impingement forces.'},
        {icon:'🧘', name:'Hip Mobility (pain-free range only)', sets:'2x10 each direction', desc:'Maintain available ROM without provoking impingement at end range.'},
        {icon:'🌉', name:'Glute Bridges (neutral hip position)', sets:'3x15 reps', desc:'Hip extensor activation avoiding provocative end-range flexion.'},
        {icon:'🔄', name:'Movement Retraining (avoid adduction/IR)', sets:'3x10 functional reps', desc:'Correct Trendelenburg and hip adduction pattern during gait and stairs.'}
      ]
    },
    {
      name: 'Hip Flexor Strain',
      ageNote: 'Any age; athletes; overuse or acute eccentric injury',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior hip / groin pain')) score+=3;
        if(s.has('Deep groin pain')) score+=2;
        if(s.has('Ecchymosis (acute)')) score+=3;
        if(a.has('Hip flexion activities')||a.has('Kicking')||a.has('Running / sprinting')) score+=4;
        if(al.has('Rest')||al.has('Avoiding deep hip flexion')) score+=3;
        if(tests['Resisted Hip Flexion (seated)']==='+') score+=4;
        if(tests['Passive Hip Extension (stretch)']==='+') score+=3;
        if(tests['Thomas Test']==='+') score+=2;
        // Differentiate from tendinopathy: acute onset, possible ecchymosis
        if(s.has('Ecchymosis (acute)')||s.has('Antalgic gait')) score+=2;
        return score;
      },
      edu:'Hip flexor strains involve the iliopsoas or rectus femoris and present with acute anterior groin pain, tenderness over the ASIS/AIIS or pubic symphysis, and pain with resisted hip flexion or passive extension. Ecchymosis indicates a higher-grade tear. Acute management includes relative rest, ice, and gentle ROM; rehabilitation progresses through isometric → isotonic → sport-specific loading.',
      exercises:[
        {icon:'🧘', name:'Gentle Hip Flexor Stretching (when pain allows)', sets:'Hold 20 sec x3 each', desc:'Begin gentle stretching once acute inflammation settles — avoid aggressive stretch early.'},
        {icon:'💪', name:'Isometric Hip Flexion (seated)', sets:'5x10 sec holds', desc:'Early tendon/muscle loading — pain-free isometrics before progressing.'},
        {icon:'🌀', name:'Progressive Hip Flexion Strengthening', sets:'3x15 reps, progressive load', desc:'Graded return to full hip flexion strength — isotonic when isometrics pain-free.'},
        {icon:'🚶', name:'Graded Return to Running / Kicking', sets:'Progressive volume', desc:'Structured return to sport once full pain-free strength and ROM restored.'}
      ]
    },
    {
      name: 'Iliopsoas Tendinopathy',
      ageNote: 'Any age; athletes, dancers; insidious onset from repetitive hip flexion',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior hip / groin pain')||s.has('Deep groin pain')) score+=3;
        if(s.has('Groin tightness')) score+=2;
        // Insidious onset differentiates from strain
        if(!s.has('Ecchymosis (acute)')) score+=2;
        if(a.has('Running / sprinting')||a.has('Kicking')||a.has('Hip flexion activities')) score+=3;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['HEC Test (Hip Extension / External Rotation Compression)']==='+') score+=5; // 94% sensitive, 88% specific
        if(tests['Resisted Hip Flexion (seated)']==='+') score+=3;
        return score;
      },
      edu:'Iliopsoas tendinopathy presents with insidious anterior groin pain worsened by repetitive hip flexion activities (running, kicking, dancing). The HEC test is 94% sensitive and 88% specific — the most validated test for iliopsoas pathology. Iliopsoas palpation at the lesser trochanter confirms tenderness. Progressive tendon loading (isometric → isotonic → sport-specific) is the evidence-based treatment.',
      exercises:[
        {icon:'💪', name:'Isometric Hip Flexion Holds', sets:'5x45 sec, 70% effort', desc:'Pain-modulating isometrics — cornerstone of tendinopathy management.'},
        {icon:'🔄', name:'Isotonic Hip Flexion Progression (band/cable)', sets:'4x8 heavy slow resistance', desc:'Tendon remodeling loading — progress from isometrics when pain <3/10.'},
        {icon:'🧘', name:'Hip Flexor Stretching (symptom-guided)', sets:'Hold 30 sec x3', desc:'Restore flexibility — avoid aggressive stretch in acute phase.'},
        {icon:'🏃', name:'Graded Return to Running / Dance', sets:'Progressive volume and speed', desc:'Structured sport-specific loading once full pain-free strength achieved.'}
      ]
    },
    {
      name: 'Hamstring Strain',
      ageNote: 'Athletes; acute injury with eccentric contraction (sprinting, kicking)',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Posterior hip pain / buttock')) score+=2;
        if(s.has('Ecchymosis (acute)')) score+=4;
        if(s.has('Weakness')) score+=2;
        if(a.has('Running / sprinting')||a.has('Kicking')) score+=4;
        if(al.has('Rest')||al.has('Non-weight-bearing')) score+=2;
        if(tests['Ischial Tuberosity Palpation']==='+') score+=3;
        if(tests['Resisted Knee Flexion (prone)']==='+') score+=4;
        // Active hamstring tests at 30° and 90° are key — negative helps rule out tendinopathy
        if(tests['Active Hamstring Test at 30°']==='+') score+=2;
        // Acute strain: pain with passive stretch
        if(s.has('Ecchymosis (acute)')||a.has('Running / sprinting')) score+=1;
        return score;
      },
      edu:'Hamstring strains are the most common muscle injury in sprinting sports. They occur acutely with eccentric contraction during late swing phase sprinting. Ecchymosis and a palpable defect at the myotendinous junction or ischial tuberosity indicate higher-grade tears. Active knee extension deficit in prone is a useful functional indicator of severity. The Nordic hamstring curl is the most evidence-based prevention and rehabilitation exercise.',
      exercises:[
        {icon:'🧘', name:'Gentle Hamstring Stretch (pain-free range)', sets:'Hold 20 sec x3', desc:'Restore mobility gradually — avoid aggressive stretch in acute phase (grade II/III).'},
        {icon:'💪', name:'Isometric Knee Flexion (prone)', sets:'5x10 sec holds', desc:'Early pain-free loading before progressing to isotonic exercises.'},
        {icon:'🔄', name:'Nordic Hamstring Curl (eccentric)', sets:'3x6–8 reps (progressive)', desc:'Gold standard — reduces hamstring re-injury rate by 50–70% when used in rehabilitation.'},
        {icon:'🏃', name:'Graded Return to Running Protocol', sets:'Progressive speed and volume', desc:'Structured sprint re-introduction — criterion-based, not time-based.'}
      ]
    },
    {
      name: 'Proximal Hamstring Tendinopathy',
      ageNote: 'Athletes; overuse with hip extension activities; runners and cyclists particularly affected',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Posterior hip pain / buttock')) score+=3;
        if(s.has('Pain with sitting >30 min')) score+=4;
        if(s.has('Deep ache')) score+=2;
        if(a.has('Running / sprinting')||a.has('Hill running')) score+=3;
        if(a.has('Sitting on hard surfaces')||a.has('Prolonged sitting (>30 min)')) score+=3;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        // Combined test LR+ 26.9
        if(tests['Active Hamstring Test at 30°']==='+' && tests['Active Hamstring Test at 90°']==='+') score+=8; // LR+ 26.9 combined
        else if(tests['Active Hamstring Test at 30°']==='+') score+=4;
        else if(tests['Active Hamstring Test at 90°']==='+') score+=4;
        if(tests['Puranen-Orava Test']==='+') score+=3;
        if(tests['Ischial Tuberosity Palpation']==='+') score+=3;
        return score;
      },
      edu:'Proximal hamstring tendinopathy presents with deep buttock pain at the ischial tuberosity, worsened by prolonged sitting, running, and hill work. The combined active hamstring test at 30° and 90° is the most diagnostically powerful test (84% sensitive, 97% specific, LR+ 26.9). Compressive loads (sitting, hip flexion with knee extended) are the primary provocateur — must be managed during rehabilitation. Progressive tendon loading using the heavy slow resistance protocol is the gold standard.',
      exercises:[
        {icon:'💪', name:'Isometric Hamstring Bridge (hip neutral)', sets:'5x45 sec holds', desc:'Initial pain-modulating tendon loading — avoid hip flexion that increases proximal tendon compression.'},
        {icon:'🌉', name:'Heavy Slow Resistance Deadlift Progression', sets:'4x8 reps, 3–4 sec tempo', desc:'Gold standard tendon remodeling — Romanian deadlift, progress to full deadlift.'},
        {icon:'🧘', name:'Avoid Sustained Sitting Compression', sets:'Postural modification', desc:'Sit on padded surfaces, avoid end-range hip flexion — reduces tendon compression on ischium.'},
        {icon:'🏃', name:'Graded Return to Running (avoid hills early)', sets:'Progressive flat-surface volume', desc:'Flat running before hills — hill running markedly increases proximal hamstring tendon load.'}
      ]
    },
    {
      name: 'Hip Adductor Strain',
      ageNote: 'Athletes; acute injury or overuse from kicking, cutting, and lateral movements',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Deep groin pain')||s.has('Anterior hip / groin pain')) score+=3;
        if(s.has('Ecchymosis (acute)')) score+=3;
        if(a.has('Kicking')||a.has('Cutting / lateral movements')) score+=4;
        if(a.has('Running / sprinting')) score+=2;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['Adductor Squeeze Test (0° and 45°)']==='+') score+=5;
        if(tests['Pubic Tubercle / Rectus Insertion Palpation']==='+') score+=2;
        return score;
      },
      edu:'Adductor strains are the most common groin injury in field and ice sports, involving the adductor longus origin at the pubic symphysis. Pain is medial groin, reproduced by resisted adduction and tenderness at the adductor origin. The Copenhagen adductor exercise is the most evidence-based prevention and rehabilitation protocol (Hölmich protocol). Differentiate from athletic pubalgia by the absence of cross-body sit-up pain.',
      exercises:[
        {icon:'💪', name:'Copenhagen Adductor Exercise', sets:'3x8–12 reps', desc:'Gold standard eccentric adductor loading — reduces adductor strain incidence by 30%.'},
        {icon:'🧘', name:'Isometric Adductor Squeeze (0° and 45°)', sets:'5x10 sec holds', desc:'Early phase pain-free loading before progressing to dynamic exercises.'},
        {icon:'🌀', name:'Lateral Lunge / Skating Progression', sets:'3x10 reps', desc:'Sport-specific multiplanar loading for return-to-sport readiness.'},
        {icon:'🦵', name:'Adductor Flexibility (symptom-guided)', sets:'Hold 30 sec x3 each', desc:'Restore flexibility — progress as pain allows.'}
      ]
    },
    {
      name: 'Gluteal Tendinopathy (Glute Med / Min)',
      ageNote: 'Women 40–60 years; prevalence 10–25% in middle-aged women',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lateral hip pain')) score+=5;
        if(s.has('Night pain')||s.has('Pain at rest')) score+=2;
        if(s.has('Pain with weight-bearing')) score+=2;
        if(a.has('Walking / ambulation')||a.has('Ascending stairs')) score+=2;
        if(a.has('Prolonged standing')||a.has('Standing on one leg')) score+=2;
        if(al.has('Rest')||al.has('Avoiding side-lying on affected hip')) score+=2;
        if(tests['Single Leg Stance Test (30 sec)']==='+') score+=6; // 100% specificity
        if(tests['Resisted External Derotation Test']==='+') score+=4;
        if(tests['Greater Trochanter Palpation']==='+') score+=3; // 80% sensitive
        if(tests['Trendelenburg Test']==='+') score+=2;
        if(age) {
          if(age >= 40 && age <= 65) score+=3;
          else if(age < 30) score=Math.max(0,score-2);
        }
        if(sex==='female') score+=3;
        return score;
      },
      edu:'Gluteal tendinopathy involves the gluteus medius/minimus at their greater trochanteric insertion. Lateral hip pain within 30 seconds of single-leg stance is 100% specific. Compressive loading (adducted hip positions: crossing legs, hip drop, lying on affected side) is the primary driver — patient education on load management is essential. Heavy slow resistance loading of the gluteal tendons is the gold standard rehabilitation approach.',
      exercises:[
        {icon:'💪', name:'Isometric Hip Abduction (wall press)', sets:'5x45 sec holds', desc:'Pain-modulating isometrics — avoids compressive tendon loading that worsens symptoms.'},
        {icon:'🌉', name:'Heavy Slow Resistance Hip ABD (cable/band)', sets:'4x8 reps, 3–4 sec tempo', desc:'Tendon remodeling — slow, heavy eccentric loading is the gold standard.'},
        {icon:'🦵', name:'Lateral Step-Ups (controlled eccentric)', sets:'3x10 slow reps', desc:'Functional progressive loading targeting gluteus medius.'},
        {icon:'🧘', name:'Compressive Load Education', sets:'Ongoing', desc:'Avoid: crossing legs, hip drop in standing, lying on affected side — these compress the tendon.'}
      ]
    },
    {
      name: 'Greater Trochanteric Pain Syndrome (GTPS)',
      ageNote: 'Women 40–60 years; associated with high BMI; often overlaps with gluteal tendinopathy',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lateral hip pain')) score+=4;
        if(s.has('Night pain')) score+=3;
        if(s.has('Pain at rest')) score+=1;
        if(a.has('Walking / ambulation')||a.has('Ascending stairs')) score+=2;
        if(a.has('Prolonged standing')||a.has('Standing on one leg')) score+=3;
        if(al.has('Rest')||al.has('Avoiding side-lying on affected hip')) score+=2;
        if(tests['Greater Trochanter Palpation']==='+') score+=4;
        if(tests['Trendelenburg Test']==='+') score+=3;
        if(tests['Resisted External Derotation Test']==='+') score+=3;
        if(tests['Single Leg Stance Test (30 sec)']==='+') score+=3;
        if(age) {
          if(age >= 40 && age <= 65) score+=3;
          else if(age < 30) score=Math.max(0,score-2);
        }
        if(sex==='female') score+=2;
        return score;
      },
      edu:'GTPS encompasses gluteal tendinopathy and trochanteric bursitis. Direct tenderness over the greater trochanteric footprint is the hallmark. It is now understood that true bursitis is uncommon in isolation — most cases represent gluteal tendinopathy. Management mirrors gluteal tendinopathy: load management to avoid compressive positions, progressive gluteal strengthening, and education.',
      exercises:[
        {icon:'💪', name:'Isometric Hip Abduction (side-lying, neutral hip)', sets:'5x45 sec holds', desc:'Early isometric loading — avoid adducted positions that compress the trochanteric bursa.'},
        {icon:'🌉', name:'Glute Bridge Progression', sets:'3x15 → 4x8 heavy slow', desc:'Progressive posterior chain loading from low-load to heavy resistance.'},
        {icon:'🦵', name:'Lateral Band Walking', sets:'3x20 steps each direction', desc:'Dynamic gluteus medius loading in functional range.'},
        {icon:'🧘', name:'Posture & Load Management Education', sets:'Ongoing', desc:'No crossing legs, no hip drop in standing, sleep with pillow between knees.'}
      ]
    },
    {
      name: 'Piriformis Syndrome / Deep Gluteal Syndrome',
      ageNote: 'Any age; more common in women; associated with running and prolonged sitting',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Mid-buttock pain')) score+=4;
        if(s.has('Sciatica / burning pain down leg')) score+=4;
        if(s.has('Numbness / tingling (thigh)')) score+=3;
        if(s.has('Pain with sitting >30 min')) score+=3;
        if(a.has('Prolonged sitting (>30 min)')||a.has('Sitting on hard surfaces')) score+=4;
        if(a.has('Running / sprinting')) score+=2;
        if(al.has('Rest')||al.has('Non-weight-bearing')) score+=1;
        if(tests['Seated Piriformis Stretch Test']==='+') score+=4;
        if(tests['Pace Sign']==='+') score+=4;
        if(tests['Sciatic Notch Palpation']==='+') score+=3;
        if(sex==='female') score+=2;
        return score;
      },
      edu:'Piriformis / deep gluteal syndrome causes mid-buttock pain and sciatica-like symptoms from compression of the sciatic nerve by the piriformis or other deep external rotators. Key differentiator from lumbar radiculopathy: pain is deep in the buttock (not lower back), worse with sitting, and reproduced by piriformis provocation tests without lumbar findings. Piriformis stretching, sciatic nerve mobilization, and deep external rotator strengthening are the primary treatments.',
      exercises:[
        {icon:'🧘', name:'Piriformis Stretch (figure-4 / seated)', sets:'Hold 30 sec x3 each side', desc:'Primary treatment — stretch in hip flexion/IR/adduction position.'},
        {icon:'🔄', name:'Neural Mobilization (sciatic nerve)', sets:'2x10 gentle glides', desc:'Reduces sciatic nerve adhesion — use sliding technique to avoid aggravation.'},
        {icon:'💪', name:'Hip ER Eccentric Strengthening', sets:'3x15 reps', desc:'Builds piriformis resilience to reduce muscle over-activation and guarding.'},
        {icon:'🌀', name:'Hip Stabilizer Strengthening', sets:'3x15 each direction', desc:'Addresses the underlying hip weakness that increases piriformis demand.'}
      ]
    },
    {
      name: 'Snapping Hip Syndrome',
      ageNote: 'Young adults; dancers and athletes; may be painless or painful',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Clicking / snapping (hip)')||s.has('Audible snap with hip motion')) score+=6;
        if(s.has('Lateral hip pain')) score+=2; // external type
        if(s.has('Anterior hip / groin pain')) score+=2; // internal type
        if(a.has('Hip flexion activities')||a.has('Running / sprinting')) score+=3;
        if(al.has('Rest')||al.has('Avoiding pivoting')) score+=1;
        if(tests['Dynamic Hip Snap Observation']==='+') score+=5;
        if(age) {
          if(age >= 15 && age <= 35) score+=2;
        }
        return score;
      },
      edu:'Snapping hip syndrome has two forms: external (IT band snapping over greater trochanter — lateral snap) and internal (iliopsoas snapping over the iliopectineal eminence — anterior/groin snap). Most snapping is painless; intervention is only needed if painful or functionally limiting. Dynamic ultrasound confirms the diagnosis. Treatment addresses the underlying tightness: IT band/TFL stretching for external type, iliopsoas stretching and progressive loading for internal type.',
      exercises:[
        {icon:'🧘', name:'IT Band / TFL Stretch (external type)', sets:'Hold 30 sec x3 each', desc:'Primary treatment for external snapping hip — reduces IT band tension over greater trochanter.'},
        {icon:'🧘', name:'Iliopsoas Stretch (internal type)', sets:'Hold 30 sec x3 each', desc:'Primary treatment for internal snapping hip — reduces iliopsoas tension over iliopectineal eminence.'},
        {icon:'💪', name:'Hip Abductor Strengthening', sets:'3x15 reps each side', desc:'Reduces IT band tension and improves dynamic hip control.'},
        {icon:'🔄', name:'Eccentric Iliopsoas Loading', sets:'3x15 reps', desc:'Builds tendon resilience for internal type — slow eccentric hip flexion lowering.'}
      ]
    },
    {
      name: 'Pelvic Girdle Pain (PGP)',
      ageNote: 'Pregnant/postpartum women; prevalence 20% in pregnancy',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Posterior hip pain / buttock')) score+=3;
        if(s.has('Pain with weight-bearing')) score+=2;
        if(s.has('Deep groin pain')) score+=1;
        if(a.has('Walking / ambulation')||a.has('Ascending stairs')) score+=2;
        if(a.has('Turning in bed')) score+=3;
        if(al.has('Rest')||al.has('Pelvic support belt')) score+=3;
        if(tests['Active Straight Leg Raise (ASLR)']==='+') score+=5;
        if(tests['Posterior Pelvic Pain Provocation (P4)']==='+') score+=4;
        if(tests['Long Dorsal Ligament Palpation']==='+') score+=4; // 76–98% sensitive
        if(sex==='female') score+=3;
        return score;
      },
      edu:'Pelvic girdle pain affects 20% of pregnant women and is common postpartum. Pain is located in the SI joints, pubic symphysis, or both, worsened by weight-bearing activities and turning in bed. The long dorsal ligament palpation test is 76–98% sensitive. Pelvic support belts provide immediate symptom relief. Lumbopelvic stabilization exercises are the cornerstone of rehabilitation; asymmetric loading activities should be avoided.',
      exercises:[
        {icon:'🧘', name:'Pelvic Floor & Transversus Abdominis Activation', sets:'3x10, 10 sec hold', desc:'Restores inner unit stability to reduce SIJ shear forces.'},
        {icon:'🌉', name:'Clam Shells / Hip Abduction (sidelying)', sets:'3x15 each side', desc:'Gluteus medius activation — improves lumbopelvic force closure.'},
        {icon:'💪', name:'Glute Bridges (supported)', sets:'3x15 reps', desc:'Posterior chain stability — avoid single-leg loading until symptoms controlled.'},
        {icon:'🧘', name:'Pelvic Belt Education + Activity Modification', sets:'Ongoing', desc:'Reduce asymmetric loading — avoid one-leg standing, wide-leg movements, and unsupported positions.'}
      ]
    },
    {
      name: 'Athletic Pubalgia (Sports Hernia / Core Muscle Injury)',
      ageNote: 'Young male athletes; sports requiring kicking, cutting, and sprinting',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lower abdominal pain')) score+=4;
        if(s.has('Deep groin pain')) score+=3;
        if(s.has('Anterior hip / groin pain')) score+=2;
        if(a.has('Kicking')||a.has('Cutting / lateral movements')||a.has('Running / sprinting')) score+=4;
        if(a.has('Coughing / sneezing')) score+=3;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['Cross-Body Sit-Up Test']==='+') score+=6; // 100% sensitive
        if(tests['Adductor Contracture Test']==='+') score+=5; // 100% sensitive
        if(tests['Pubic Tubercle / Rectus Insertion Palpation']==='+') score+=4;
        if(age) {
          if(age >= 15 && age <= 35) score+=2;
        }
        if(sex==='male') score+=3;
        return score;
      },
      edu:'Athletic pubalgia (sports hernia / core muscle injury) involves disruption of the posterior inguinal wall at the pubic symphysis, typically at the conjoint tendon or rectus abdominis insertion. The cross-body sit-up test and adductor contracture test are both 100% sensitive. MRI or dynamic ultrasound confirm diagnosis. Conservative PT (core stabilization, progressive abdominal and adductor loading) is first-line; surgical repair is considered if symptoms persist beyond 3 months.',
      exercises:[
        {icon:'💪', name:'Transversus Abdominis Activation', sets:'3x10, 10 sec hold', desc:'Foundation of athletic pubalgia rehabilitation — deep core before outer core.'},
        {icon:'🌀', name:'Progressive Abdominal Strengthening (avoid twisting early)', sets:'3x10–15 reps', desc:'Straight-plane loading before rotational — avoid provocative twisting until pain-free.'},
        {icon:'🧘', name:'Adductor Isometric → Copenhagen Progression', sets:'5x10 sec → 3x8 reps', desc:'Concurrent adductor rehab — 100% of cases have adductor involvement.'},
        {icon:'🏃', name:'Graded Return to Kicking / Cutting', sets:'Progressive sport-specific loading', desc:'Structured return — criterion-based progression only after full pain-free strength.'}
      ]
    },
    {
      name: '⚠️ Stress Fracture (Femoral Neck / Pubic Ramus) — RED FLAG',
      ageNote: 'Military recruits, endurance athletes 20–30 years; postmenopausal women',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior hip / groin pain')||s.has('Deep groin pain')) score+=2;
        if(s.has('Night pain')||s.has('Pain at rest')) score+=3;
        if(s.has('Pain with weight-bearing')||s.has('Antalgic gait')) score+=3;
        if(a.has('Running / sprinting')||a.has('Increased training load')) score+=4;
        if(al.has('Non-weight-bearing')||al.has('Complete activity cessation (stress fracture)')) score+=4;
        if(tests['Hop Test']==='+') score+=5;
        if(tests['Fulcrum Test']==='+') score+=5;
        if(tests['Heel Percussion Test']==='+') score+=4;
        return score;
      },
      edu:'⚠️ RED FLAG: Femoral neck stress fractures are limb-threatening if missed. Suspect in endurance athletes or military recruits with anterior groin pain and night pain. The hop test, fulcrum test, and heel percussion test are screening tools — a positive test warrants urgent MRI (gold standard). TENSION-SIDE femoral neck fractures require URGENT surgical consultation (high risk of complete fracture and avascular necrosis). Complete non-weight-bearing rest and immediate orthopaedic referral are mandatory if suspected.',
      exercises:[
        {icon:'⚠️', name:'NON-WEIGHT-BEARING REST', sets:'Until fracture ruled out by MRI', desc:'Do NOT load the hip until stress fracture is definitively ruled out — risk of complete fracture.'},
        {icon:'🚲', name:'Pool Running / Aquatic Therapy (if cleared)', sets:'As per orthopaedic clearance', desc:'Maintain cardiovascular fitness with no impact loading during healing phase.'},
        {icon:'💪', name:'Upper Body & Core Maintenance', sets:'As tolerated', desc:'Maintain strength and fitness in unaffected areas during healing.'},
        {icon:'🏃', name:'Graded Return to Running (post-clearance)', sets:'12–16 week structured protocol', desc:'MRI-guided return — only after radiological evidence of healing confirmed.'}
      ]
    },
    {
      name: 'SI Joint Dysfunction',
      ageNote: 'Any age; more common in women, especially postpartum',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Posterior hip pain / buttock')) score+=4;
        if(s.has('Deep ache')) score+=1;
        if(!s.has('Sciatica / burning pain down leg')) score+=1; // rarely below knee
        if(a.has('Prolonged sitting (>30 min)')||a.has('Standing on one leg')) score+=3;
        if(a.has('Transitional movements (sit-to-stand)')||a.has('Ascending stairs')) score+=2;
        if(al.has('Rest')||al.has('Avoiding asymmetric loading')) score+=2;
        const siTests = [
          tests['SI Provocation — Thigh Thrust'],
          tests['SI Provocation — Distraction'],
          tests['SI Provocation — Compression'],
          tests['SI Provocation — Gaenslen\'s Test'],
          tests['SI Provocation — Sacral Thrust']
        ].filter(t=>t==='+').length;
        if(siTests >= 3) score+=6;
        else if(siTests === 2) score+=3;
        else if(siTests === 1) score+=1;
        if(sex==='female') score+=2;
        return score;
      },
      edu:'SI joint dysfunction causes unilateral buttock and posterior pelvic pain that rarely radiates below the knee. Diagnosis requires ≥3 positive SI provocation tests from the cluster (distraction, compression, thigh thrust, Gaenslen\'s, sacral thrust). The thigh thrust is the most sensitive single test. Diagnostic intra-articular injection is the gold standard. Treatment includes lumbopelvic stabilization, SI joint manipulation, and postpartum pelvic girdle rehabilitation.',
      exercises:[
        {icon:'🌉', name:'Glute Bridges (bilateral → single leg)', sets:'3x15 reps', desc:'Posterior chain activation and lumbopelvic stability — cornerstone of SIJ rehab.'},
        {icon:'💪', name:'Clamshells / Hip Abduction', sets:'3x15 each side', desc:'Gluteus medius strengthening to reduce asymmetric pelvic loading.'},
        {icon:'🧘', name:'SIJ Self-Mobilization (posterior rotation supine)', sets:'3x10 reps', desc:'Restore SIJ mobility — gentle posterior rotation technique.'},
        {icon:'🦵', name:'Single Leg Balance Progression', sets:'3x30 sec each leg', desc:'Proprioception and lumbopelvic stability — progress to dynamic surfaces.'}
      ]
    }
  ],
  cervical: [
    {
      name: 'Cervical Radiculopathy',
      ageNote: 'Peak 50–54 years; more common in males (peak 40–60 years)',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Unilateral arm pain')||s.has('Radiating pain (arm)')) score+=4;
        if(s.has('Paresthesias')||s.has('Numbness (dermatomal)')||s.has('Tingling')) score+=3;
        if(s.has('Weakness (arm/hand)')) score+=2;
        if(a.has('Valsalva / sneezing / coughing')||a.has('Overhead activities')) score+=2;
        if(a.has('Neck movement (any)')||a.has('Sustained neck positions')) score+=1;
        if(al.has('Shoulder abduction (hand on head)')||al.has('Traction')) score+=3;
        if(tests['Spurling Test (Compression)']==='+') score+=4;
        if(tests['Cervical Distraction Test']==='+') score+=3;
        if(tests['Shoulder Abduction Relief Test']==='+') score+=3;
        if(tests['Upper Limb Tension Test 1 (ULTT1)']==='+') score+=3;
        if(tests['Upper Limb Tension Test 2 (ULTT2b)']==='+') score+=2;
        if(tests['Upper Limb Tension Test 3 (ULTT3)']==='+') score+=2;
        // Peak 40–60; more common in males
        if(age) {
          if(age >= 40 && age <= 60) score+=3;
          else if(age >= 35 && age < 40) score+=1;
          else if(age > 60) score+=1;
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:'Cervical radiculopathy involves compression or irritation of a cervical nerve root, typically causing unilateral arm pain in a dermatomal distribution with associated paresthesias. The Spurling test has a positive likelihood ratio for radiculopathy; relief with shoulder abduction (hand-on-head) is highly suggestive. Common levels: C6 (thumb/index), C7 (middle finger), C8 (ring/little). Conservative management includes neural mobilization, cervical traction, and postural correction.',
      exercises:[
        {icon:'🔄', name:'Neural Flossing — Level-Specific', sets:'2x10 reps each nerve', desc:'ULTT-based nerve gliding for median (C6/7), radial (C6/7), or ulnar (C8/T1) depending on dermatome.'},
        {icon:'🧘', name:'Chin Tucks (Cervical Retraction)', sets:'3x10 reps', desc:'Promotes cervical retraction, reduces foraminal compression, and activates deep neck flexors.'},
        {icon:'🌀', name:'Cervical Lateral Glide (McKenzie)', sets:'2x10 reps', desc:'Away from symptomatic side — used when lateral shift or peripheralization is present.'},
        {icon:'💪', name:'Cervical Isometrics (pain-free directions)', sets:'3x10 sec hold each direction', desc:'Builds deep neck stabilizer strength without provoking radicular symptoms.'}
      ]
    },
    {
      name: 'Cervicogenic Headache',
      ageNote: 'Any age; history of whiplash or upper cervical dysfunction common',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Headache (unilateral)')) score+=4;
        if(s.has('Neck pain')||s.has('Neck stiffness')) score+=2;
        if(s.has('Dizziness')||s.has('Nausea')||s.has('Photophobia')||s.has('Phonophobia')) score+=1;
        if(s.has('Autonomic symptoms')) score+=1;
        if(a.has('Neck movement (any)')||a.has('Sustained neck positions')) score+=2;
        if(a.has('External pressure on posterior neck')) score+=3;
        if(al.has('Manual therapy')||al.has('Rest')) score+=2;
        if(tests['Cervical Flexion-Rotation Test']==='+') score+=4;
        if(tests['Upper Cervical Segmental Mobility (C1–C3)']==='+') score+=3;
        return score;
      },
      edu:'Cervicogenic headache originates from the upper cervical spine (C1–C3) and presents as unilateral head pain starting in the neck and radiating to the frontotemporal region. A hallmark is that neck movement or pressure on the posterior neck reproduces the headache. The cervical flexion-rotation test (>10° asymmetry) is the most validated clinical test. Manual therapy targeting C1–C3 and deep neck flexor training are the most evidence-based treatments.',
      exercises:[
        {icon:'🔄', name:'Cervical Flexion-Rotation Self-Mobilization', sets:'2x10 reps toward restricted side', desc:'Active C1–C2 mobility in the direction of restriction identified on examination.'},
        {icon:'🧘', name:'Cranial Cervical Flexion (Chin Tuck)', sets:'3x10 reps, progressing pressure levels', desc:'Deep neck flexor activation targeting longus colli and capitis — reduces upper cervical joint load.'},
        {icon:'💪', name:'Neck Flexor Endurance Training', sets:'3x progressively timed holds', desc:'Build endurance in deep cervical flexors to reduce headache frequency.'},
        {icon:'🌀', name:'Upper Cervical Self-Mobilization (C1–C2)', sets:'2x10 gentle rotations', desc:'Patient-performed upper cervical mobility exercise in supported supine position.'}
      ]
    },
    {
      name: 'Cervical Whiplash / Movement Coordination Impairment',
      ageNote: 'Any age following acceleration-deceleration trauma',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Neck pain')||s.has('Neck stiffness')) score+=3;
        if(s.has('Muscle spasm')) score+=2;
        if(s.has('Headache (unilateral)')||s.has('Headache (bilateral)')) score+=1;
        if(s.has('Dizziness')) score+=2;
        if(a.has('Neck movement (any)')||a.has('Sustained neck positions')) score+=2;
        if(al.has('Rest')||al.has('Cervical support / collar')) score+=2;
        if(tests['Cranial Cervical Flexion Test (CCFT)']==='+') score+=3;
        if(tests['Neck Flexor Endurance Test']==='+') score+=3;
        return score;
      },
      edu:'Whiplash (WAD) results from rapid acceleration-deceleration forces to the cervical spine. Key features include neck pain/stiffness, muscle spasm, reduced ROM with altered movement quality (reduced speed, smoothness, irregular axes), and possible neurological findings. Early active mobilization is superior to collar immobilization. Deep neck flexor retraining and graded motor imagery are evidence-based approaches for persistent symptoms.',
      exercises:[
        {icon:'🔄', name:'Active Cervical ROM (early mobilization)', sets:'2x10 reps all planes', desc:'Gentle active movement in all planes — early movement outperforms immobilization.'},
        {icon:'🧘', name:'Cranial Cervical Flexion (progressive levels)', sets:'3x10 reps, 5 pressure levels', desc:'CCFT-based retraining of deep neck flexors — cornerstone of WAD rehabilitation.'},
        {icon:'💪', name:'Cervical Proprioception / Gaze Stability', sets:'3x30 sec', desc:'Head-to-target exercises to restore cervico-ocular coordination and reduce dizziness.'},
        {icon:'🌀', name:'Scapular Stabilization', sets:'3x15 reps', desc:'Restores upper quadrant stability and reduces cervical load during arm activities.'}
      ]
    },
    {
      name: 'Cervical Facet Joint Syndrome',
      ageNote: 'Any age; more common with degenerative changes; C2–C3 and C5–C6 most common levels',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Neck pain')) score+=2;
        if(s.has('Deep ache')) score+=1;
        if(s.has('Headache (unilateral)')||s.has('Headache (bilateral)')) score+=1;
        if(s.has('Muscle spasm')) score+=1;
        if(a.has('Looking up (extension)')||a.has('Rotation')) score+=3;
        if(a.has('Sustained neck positions')) score+=2;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['Facet Loading Maneuver (Ext + Rotation)']==='+') score+=4;
        if(tests['Spurling Test (Compression)']==='-') score+=1; // helps rule out radiculopathy
        // More common with age/degenerative changes
        if(age) {
          if(age >= 50) score+=2;
          else if(age >= 40) score+=1;
        }
        return score;
      },
      edu:'Cervical facet (zygapophyseal) joint pain is a common source of axial neck pain, typically worsened by extension and ipsilateral rotation. Pain can radiate to the head (C2–C3), shoulder, or upper arm but without dermatomal neurological features. Paraspinal tenderness has some predictive value for treatment response. Diagnostic medial branch blocks are the gold standard but not typically available in PT. Manual therapy, postural correction, and deep cervical flexor training are first-line interventions.',
      exercises:[
        {icon:'🧘', name:'Chin Tucks', sets:'3x10 reps', desc:'Reduces upper cervical extension and facet joint loading.'},
        {icon:'🌀', name:'Cervical AROM (away from pain)', sets:'2x10 reps', desc:'Mobility in non-provocative directions to maintain range.'},
        {icon:'💪', name:'Scapular Retraction / Mid-Trap', sets:'3x15 reps', desc:'Improves thoracic posture to offload cervical facet joints.'},
        {icon:'🧘', name:'Levator Scapulae & Upper Trap Stretch', sets:'Hold 30 sec x3 each', desc:'Reduces tension in paraspinal muscles that load facet joints.'}
      ]
    },
    {
      name: 'Cervical Disc Herniation',
      ageNote: 'Peak 40–60 years; more common in males',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Radiating pain (arm)')||s.has('Unilateral arm pain')) score+=3;
        if(s.has('Paresthesias')||s.has('Numbness (dermatomal)')||s.has('Tingling')) score+=3;
        if(s.has('Neck pain')) score+=1;
        if(a.has('Looking down (flexion)')||a.has('Valsalva / sneezing / coughing')) score+=3;
        if(al.has('Rest')||al.has('Traction')) score+=2;
        if(tests['Spurling Test (Compression)']==='+') score+=3;
        if(tests['Upper Limb Tension Test 1 (ULTT1)']==='+') score+=2;
        if(tests['Cervical Distraction Test']==='+') score+=3;
        // Peak 40–60; more common in males
        if(age) {
          if(age >= 40 && age <= 60) score+=2;
          else if(age >= 35) score+=1;
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:'Cervical disc herniation can present as radiculopathy (arm pain/paresthesias in dermatomal pattern) or contribute to mechanical neck pain without neurological features. Flexion and Valsalva maneuvers typically increase intradiscal pressure and worsen symptoms. MRI confirms herniation but must correlate clinically — incidental findings are common. Conservative PT is first-line; refer for surgical opinion if myelopathy signs, severe weakness, or failed 6–8 weeks of PT.',
      exercises:[
        {icon:'🔄', name:'Cervical Retraction / Extension (McKenzie)', sets:'3x10 reps', desc:'Extension bias to promote posterior disc displacement if centralization occurs with extension.'},
        {icon:'🧘', name:'Neural Flossing (nerve-level specific)', sets:'2x10 gentle glides', desc:'Nerve mobilization to reduce neural adhesion and improve radicular symptoms.'},
        {icon:'💪', name:'Cervical Isometrics (extension bias)', sets:'3x10 sec hold', desc:'Stabilize in extension-biased position to support disc recovery.'},
        {icon:'🌀', name:'Thoracic Mobility (extension)', sets:'3x10 over foam roller', desc:'Reduces compensatory cervical loading from thoracic kyphosis.'}
      ]
    },
    {
      name: 'Cervical Mobility Deficit / Mechanical Neck Pain',
      ageNote: 'Any age; 15% prevalence at any time; 30–50% develop chronic symptoms; mobility deficits increase with age',
      match:(s,a,al,obj,tests,age,sex) => {
        let score = 0;
        if(s.has('Neck stiffness')||s.has('Neck pain')) score+=3;
        if(s.has('Deep ache')) score+=1;
        if(s.has('Muscle spasm')) score+=1;
        // No arm symptoms (differentiates from radiculopathy)
        if(!s.has('Unilateral arm pain') && !s.has('Radiating pain (arm)') && !s.has('Numbness (dermatomal)')) score+=2;
        if(a.has('Prolonged sitting')||a.has('Sustained neck positions')||a.has('Looking down (flexion)')) score+=2;
        if(a.has('Neck movement (any)')) score+=1;
        if(al.has('Gentle movement')||al.has('Activity modification')||al.has('Heat')) score+=2;
        if(tests['Spurling Test (Compression)']==='-') score+=1;
        if(tests['Cervical Distraction Test']==='-') score+=1;
        // Age-related mobility loss increases prevalence
        if(age) {
          if(age >= 50) score+=2;
          else if(age >= 40) score+=1;
        }
        return score;
      },
      edu:'Mechanical neck pain / cervical mobility deficits are among the most common musculoskeletal presentations. Pain is typically diffuse, difficult to localize, and may radiate to the shoulders or head without neurological features. Prolonged static postures (especially forward head posture at screens) are a major contributing factor. Manual therapy combined with exercise is the most evidence-based approach. Mobility deficits increase with age and are generally longer-lasting in males.',
      exercises:[
        {icon:'🌀', name:'Cervical AROM All Planes', sets:'2x10 reps each direction', desc:'Active mobility to restore range — the primary treatment for mobility deficits.'},
        {icon:'🧘', name:'Chin Tucks + Capital Extension', sets:'3x10 reps', desc:'Corrects forward head posture and activates deep cervical flexors.'},
        {icon:'💪', name:'Cervical Strengthening (isometrics all planes)', sets:'3x10 sec hold each direction', desc:'Builds endurance in cervical stabilizers to support postural correction.'},
        {icon:'🪑', name:'Thoracic Foam Roller Extension', sets:'2 min across multiple segments', desc:'Restores thoracic extension to reduce compensatory cervical loading.'}
      ]
    }
  ],
  thoracic: [
    {
      name: 'Thoracic Mobility Deficits / Spondylosis',
      ageNote: 'Increases with age; earlier onset and longer duration in males; ROM decreases ~5° per decade',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Stiffness')||s.has('Mid-back pain')||s.has('Deep ache')) score+=3;
        if(s.has('Interscapular pain')) score+=1;
        if(a.has('Prolonged sitting')||a.has('End-range movements')||a.has('Trunk rotation')) score+=3;
        if(a.has('Extension')||a.has('Activities requiring upright posture')) score+=1;
        if(al.has('Gentle movement')||al.has('Activity modification')) score+=2;
        if(tests['Thoracic Active ROM (inclinometer)']==='+') score+=3;
        if(tests['Segmental Mobility Testing (spring test)']==='+') score+=3;
        if(age) {
          if(age >= 60) score+=3;
          else if(age >= 45) score+=2;
          else if(age >= 35) score+=1;
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:'Thoracic mobility deficits are extremely common and worsen with age (~5° per decade loss in all planes). Lower thoracic segments (T8–T12) are most affected with aging. Stiffness with trunk rotation and extension are the hallmark functional complaints. Thoracic mobility directly impacts cervical and shoulder function — restricted thoracic rotation is a major contributor to neck pain and shoulder impingement. Manual therapy and active mobility exercises are highly effective.',
      exercises:[
        {icon:'🌀', name:'Thoracic Rotation in Seated (hands on shoulders)', sets:'3x10 each direction', desc:'Primary mobility exercise for thoracic rotation — most functionally limited plane.'},
        {icon:'🪑', name:'Foam Roller Thoracic Extension', sets:'2–3 min across T4–T10', desc:'Segmental extension mobilization — addresses the most common restriction pattern.'},
        {icon:'🧘', name:'Thread the Needle', sets:'3x10 each side', desc:'Combined rotation and extension in quadruped — excellent for lower thoracic segments.'},
        {icon:'💪', name:'Thoracic Extension over Towel Roll', sets:'3x30 sec', desc:'Targeted extension stretch at specific stiff segments.'}
      ]
    },
    {
      name: 'Age-Related Hyperkyphosis',
      ageNote: 'Older adults; prevalence 20–40% in geriatric population; kyphosis increases ~3° per decade',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Postural complaints')||s.has('Fatigue / postural fatigue')) score+=4;
        if(s.has('Interscapular pain')||s.has('Upper back pain')) score+=2;
        if(a.has('Weight-bearing activities')||a.has('Prolonged standing')||a.has('Activities requiring upright posture')) score+=3;
        if(al.has('Lying down / supine')||al.has('Rest')) score+=2;
        if(tests['Kyphosis Assessment (inclinometer)']==='+') score+=4;
        if(tests['Back Extensor Endurance (Biering-Sørensen)']==='+') score+=3;
        if(age) {
          if(age >= 70) score+=5;
          else if(age >= 60) score+=4;
          else if(age >= 50) score+=2;
          else if(age < 40) score = Math.max(0, score - 3);
        }
        return score;
      },
      edu:'Age-related hyperkyphosis involves progressive increase in thoracic kyphosis (~3° per decade). Normal standing T1–T12 kyphosis is 34–40°; values above this with associated functional impairment indicate hyperkyphosis. Importantly, 60–70% of cases have no vertebral fractures. Back extensor weakness is a key modifiable contributor. Exercise targeting back extensors, hip extensors, and thoracic mobility is the most evidence-based intervention.',
      exercises:[
        {icon:'💪', name:'Back Extensor Strengthening (prone)', sets:'3x15 reps', desc:'Addresses the primary modifiable driver of progressive kyphosis.'},
        {icon:'🧘', name:'Thoracic Extension Stretch', sets:'3x30 sec over towel roll', desc:'Passive stretch targeting stiff thoracic segments.'},
        {icon:'🌉', name:'Hip Extension Strengthening', sets:'3x15 reps', desc:'Hip extensor weakness contributes to anterior pelvic tilt and compensatory kyphosis.'},
        {icon:'🪑', name:'Postural Retraining (wall angels)', sets:'3x10 reps', desc:'Active thoracic extension and scapular retraction in supported upright position.'}
      ]
    },
    {
      name: 'Scapular Dyskinesia',
      ageNote: 'Common in athletes and patients with shoulder pathology; any age',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Interscapular pain')||s.has('Upper back pain')) score+=2;
        if(s.has('Postural complaints')) score+=1;
        if(a.has('Overhead activities')||a.has('Repetitive arm movements')||a.has('Reaching overhead')) score+=3;
        if(a.has('Carrying objects')||a.has('Sustained arm positions')) score+=1;
        if(al.has('Scapular stabilization exercises')||al.has('Rest')) score+=2;
        if(tests['Scapular Assistance Test']==='+') score+=4;
        if(tests['Scapular Retraction Test']==='+') score+=3;
        if(tests['Dynamic Scapular Observation (arm raise)']==='+') score+=4;
        if(tests['Scapular Position Assessment (at rest)']==='+') score+=2;
        return score;
      },
      edu:'Scapular dyskinesia refers to abnormal scapular position or motion — typically protraction at rest and abnormal upward rotation rhythm during arm elevation. It is rarely an isolated finding; it is usually secondary to shoulder pathology, thoracic stiffness, or rotator cuff dysfunction. The scapular assistance test (improved symptoms with manual scapular assistance) is a key diagnostic and treatment-planning tool. Scapular stabilizer strengthening and thoracic mobility are the primary treatments.',
      exercises:[
        {icon:'💪', name:'Scapular Retraction & Depression (band)', sets:'3x15 reps', desc:'Lower and mid trapezius activation to restore scapular positioning.'},
        {icon:'🔄', name:'Wall Slides (serratus activation)', sets:'3x15 reps', desc:'Serratus anterior strengthening to restore scapular protraction control and upward rotation.'},
        {icon:'🌀', name:'Thoracic Rotation Mobility', sets:'3x10 each side', desc:'Thoracic stiffness is a primary contributor to scapular dyskinesia — must be addressed concurrently.'},
        {icon:'🧘', name:'Prone Y-T-W', sets:'3x10 each position', desc:'Comprehensive lower trap, mid-trap, and rhomboid activation for scapular stability.'}
      ]
    },
    {
      name: 'Rib Sprain / Costochondral Injury',
      ageNote: 'Any age; can occur with coughing, minor trauma, or repetitive activities',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Chest wall pain')||s.has('Rib pain')) score+=4;
        if(s.has('Sharp pain with breathing')) score+=4;
        if(s.has('Sharp pain')) score+=1;
        if(a.has('Deep breathing')||a.has('Coughing / sneezing')) score+=4;
        if(a.has('Trunk rotation')||a.has('Direct pressure on rib/chest')) score+=3;
        if(al.has('Splinting (rib)')||al.has('Avoiding provocative movements')) score+=3;
        if(tests['Rib Spring / Compression Test']==='+') score+=4;
        if(tests['Costovertebral Joint Palpation']==='+') score+=4;
        return score;
      },
      edu:'Rib sprains and costochondral injuries present with highly localized chest wall pain, classically sharp with breathing, coughing, or trunk rotation. Point tenderness directly over the affected rib or costochondral junction is the key finding. Most heal well with activity modification and time (4–8 weeks). Splinting with a pillow during coughing helps manage acute pain. Rib stress fractures should be considered in overhead athletes or those with repetitive loading.',
      exercises:[
        {icon:'🧘', name:'Supported Breathing / Diaphragmatic Breathing', sets:'5 min x2 daily', desc:'Reduces respiratory splinting and maintains rib cage mobility during healing.'},
        {icon:'🌀', name:'Pain-Free Trunk Rotation (seated)', sets:'2x10 gentle range', desc:'Maintain thoracic mobility within pain-free range to prevent stiffness.'},
        {icon:'💪', name:'Postural Correction (supported posture)', sets:'Ongoing', desc:'Avoid sustained forward flexion which loads costochondral junctions.'},
        {icon:'🔄', name:'Gradual Return to Activity', sets:'Progressive loading over 4–8 weeks', desc:'Graded return once pain with deep breathing resolves.'}
      ]
    },
    {
      name: 'Thoracic Outlet Syndrome (Neurogenic)',
      ageNote: 'More common in females; associated with trauma, repetitive overhead work, or congenital anomalies',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Numbness')||s.has('Tingling')) score+=3;
        if(s.has('Weakness (upper extremity)')||s.has('Arm fatigue')) score+=3;
        if(s.has('Radiating pain')) score+=2;
        if(a.has('Sustained arm positions')||a.has('Carrying objects')) score+=3;
        if(a.has('Overhead activities')||a.has('Reaching overhead')||a.has('Repetitive arm movements')) score+=3;
        if(al.has('Shoulder abduction (hand on head)')||al.has('Rest')) score+=2;
        if(tests['Elevated Arm Stress Test (EAST / Roos)']==='+') score+=4;
        if(tests['Adson Test']==='+') score+=3;
        if(tests['Wright Test (Hyperabduction)']==='+') score+=3;
        if(sex === 'female') score+=1;
        return score;
      },
      edu:'Neurogenic TOS involves compression of the brachial plexus (typically C8–T1) between the clavicle and first rib or by scalene/pectoralis minor muscles. Paresthesias in the C8/T1 distribution (ring/little finger, medial forearm), arm fatigue with elevation, and thenar/hypothenar atrophy in severe cases are hallmarks. The EAST/Roos test (symptoms reproduced with 3 minutes of elevated arm opening/closing) is the most sensitive provocation test. Conservative PT (postural correction, scalene/pec minor stretching, first rib mobilization) is first-line.',
      exercises:[
        {icon:'🧘', name:'Scalene Stretch', sets:'Hold 30 sec x3 each side', desc:'Reduces anterior and middle scalene compression of the brachial plexus.'},
        {icon:'🌀', name:'Pectoralis Minor Stretch (corner stretch)', sets:'Hold 30 sec x3', desc:'Releases pec minor compression on brachial plexus beneath the coracoid.'},
        {icon:'💪', name:'First Rib Mobilization (self)', sets:'2x10 reps', desc:'Reduces first rib elevation contributing to thoracic outlet narrowing.'},
        {icon:'🪑', name:'Postural Correction & Thoracic Extension', sets:'3x10 reps + sustained posture work', desc:'Forward head and rounded shoulder posture are primary TOS contributors.'}
      ]
    },
    {
      name: "Scheuermann's Kyphosis",
      ageNote: 'Develops before puberty, presents in adolescence; prevalence 0.4–10%; may be more common in males',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Postural complaints')||s.has('Fatigue / postural fatigue')) score+=3;
        if(s.has('Mid-back pain')||s.has('Deep ache')) score+=2;
        if(a.has('Activities requiring upright posture')||a.has('Sports participation')||a.has('Prolonged sitting')) score+=2;
        if(al.has('Rest')||al.has('Avoiding provocative movements')) score+=1;
        if(tests['Adam Forward Bend Test']==='+') score+=3;
        if(tests['Kyphosis Assessment (inclinometer)']==='+') score+=3;
        if(age) {
          if(age >= 10 && age <= 20) score+=5;
          else if(age >= 21 && age <= 40) score+=2;
          else if(age > 50) score = Math.max(0, score - 2);
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:"Scheuermann's kyphosis is a structural thoracic deformity defined radiographically by anterior vertebral wedging ≥5° in 3 or more adjacent vertebrae, endplate irregularities, disc space narrowing, and Schmorl nodes. The kyphosis is rigid — it does not correct with positioning (differentiating it from postural kyphosis). Symptoms often diminish at skeletal maturity. Conservative PT focuses on thoracic extension mobility, back extensor and core strengthening, and postural retraining. Refer for orthopaedic evaluation if curves are severe or progressive.",
      exercises:[
        {icon:'💪', name:'Back Extensor Strengthening (prone)', sets:'3x15 reps', desc:'Key intervention to counteract progressive kyphotic deformity.'},
        {icon:'🧘', name:'Thoracic Extension over Bolster', sets:'3x30 sec at apex of curve', desc:'Passive extension stretching at the apex of structural deformity.'},
        {icon:'🌀', name:'Thoracic Rotation Mobility', sets:'3x10 each direction', desc:'Maintains available rotation ROM which is often preserved in Scheuermann\'s.'},
        {icon:'🪑', name:'Core Stabilization', sets:'3x10 reps varied', desc:'Lumbopelvic stability to counteract compensatory lumbar hyperlordosis.'}
      ]
    },
    {
      name: 'Thoracic Facet Joint Dysfunction',
      ageNote: 'Any age; increases with degenerative changes; prevalence 34–48% in chronic thoracic pain patients',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Mid-back pain')||s.has('Upper back pain')) score+=3;
        if(s.has('Deep ache')) score+=1;
        if(s.has('Chest wall pain')||s.has('Rib pain')) score+=1; // referred pain
        // No neurological features
        if(!s.has('Numbness') && !s.has('Tingling') && !s.has('Weakness (upper extremity)')) score+=2;
        if(a.has('Extension')||a.has('Trunk rotation')) score+=3;
        if(a.has('Prolonged sitting')||a.has('Weight-bearing activities')) score+=2;
        if(al.has('Rest')||al.has('Avoiding provocative movements')) score+=2;
        if(tests['Thoracic Facet Loading (Ext + Rotation)']==='+') score+=4;
        if(tests['Segmental Mobility Testing (spring test)']==='+') score+=2;
        if(age) {
          if(age >= 50) score+=2;
          else if(age >= 40) score+=1;
        }
        return score;
      },
      edu:'Thoracic facet joint dysfunction is responsible for 34–48% of chronic thoracic pain cases. Pain is typically axial (mid or upper back), may refer to the chest wall or ribs, but lacks neurological features. Extension and ipsilateral rotation are the provocative movements. There are no reliable standalone physical exam tests — diagnosis is primarily clinical and supported by response to treatment. Manual therapy targeting the affected segments is highly effective.',
      exercises:[
        {icon:'🌀', name:'Thoracic Rotation AROM (away from pain)', sets:'2x10 reps', desc:'Mobility in non-provocative direction to maintain range.'},
        {icon:'🪑', name:'Foam Roller Thoracic Extension', sets:'2 min at affected segments', desc:'Extension mobilization to unload facet joints and restore extension range.'},
        {icon:'💪', name:'Scapular Retraction / Mid-Trap', sets:'3x15 reps', desc:'Improves thoracic posture and reduces sustained facet loading.'},
        {icon:'🧘', name:'Thread the Needle', sets:'3x10 each side', desc:'Rotational mobility drill targeting thoracic segments.'}
      ]
    }
  ],
  shoulder: [
    {
      name: 'Shoulder Impingement Syndrome (Subacromial)',
      ageNote: 'Most common cause of shoulder pain; middle-aged adults',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterolateral shoulder pain')) score+=3;
        if(s.has('Painful arc (60–120°)')) score+=3;
        if(s.has('Night pain / sleep disturbance')) score+=2;
        if(s.has('Difficulty reaching behind back')) score+=1;
        if(a.has('Overhead activities (60–120° arc)')||a.has('Arm elevation')||a.has('Repetitive overhead motion')) score+=3;
        if(al.has('Avoiding overhead activities')||al.has('Rest')) score+=2;
        if(tests['Hawkins-Kennedy Test']==='+') score+=3;
        if(tests['Neer Impingement Sign']==='+') score+=3;
        if(tests['Painful Arc Sign (60–120°)']==='+') score+=3;
        // Combination: Hawkins + painful arc + infraspinatus = 95% post-test probability
        if(tests['Hawkins-Kennedy Test']==='+' && tests['Painful Arc Sign (60–120°)']==='+' && tests['Infraspinatus Strength Test']==='+') score+=5;
        return score;
      },
      edu:'Subacromial impingement is the most common cause of shoulder pain in adults, involving compression of the rotator cuff tendons and bursa under the acromion during arm elevation. The painful arc (60–120° abduction) is a hallmark. The combination of Hawkins-Kennedy + painful arc + infraspinatus weakness yields 95% post-test probability. Rotator cuff strengthening, scapular stabilization, and posterior capsule stretching are the cornerstones of treatment.',
      exercises:[
        {icon:'💪', name:'Sidelying External Rotation', sets:'3x15 reps', desc:'Infraspinatus/teres minor strengthening — depresses humeral head and widens subacromial space.'},
        {icon:'🏋️', name:'Scaption (Scapular Plane Elevation)', sets:'3x15 reps', desc:'Supraspinatus in safe scapular plane — avoids peak impingement zone.'},
        {icon:'🔄', name:'Scapular Retraction & Depression (band)', sets:'3x15 reps', desc:'Lower and middle trapezius — restores scapular upward rotation rhythm.'},
        {icon:'🧘', name:'Sleeper Stretch', sets:'Hold 30 sec x3', desc:'Posterior capsule stretch — reduces superior humeral head migration by improving IR.'}
      ]
    },
    {
      name: 'Rotator Cuff Tear',
      ageNote: 'Degenerative: >40 years; traumatic: any age; more common in males',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Weakness with lifting')||s.has('Weakness with overhead')) score+=4;
        if(s.has('Night pain / sleep disturbance')) score+=3;
        if(s.has('Anterolateral shoulder pain')||s.has('Deep shoulder pain')) score+=2;
        if(s.has('Difficulty dressing / toileting')||s.has('Difficulty reaching behind back')) score+=1;
        if(a.has('Overhead activities (60–120° arc)')||a.has('Lifting above shoulder level')||a.has('Reaching behind back')) score+=2;
        if(al.has('Rest')||al.has('Avoiding overhead activities')) score+=1;
        if(tests['External Rotation Lag Test']==='+') score+=5; // LR+ 7.2
        if(tests['Internal Rotation Lag Test']==='+') score+=5; // LR+ 5.6
        if(tests['Drop Arm Test']==='+') score+=4;              // LR+ 3.3
        if(tests['Painful Arc Sign (60–120°)']==='+') score+=3; // LR+ 3.7
        if(tests['Empty Can Test (Jobe)']==='+') score+=2;
        if(tests['Lift-Off Test']==='+') score+=3;
        if(age) {
          if(age >= 60) score+=3;
          else if(age >= 50) score+=2;
          else if(age >= 40) score+=1;
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:'Rotator cuff tears range from partial to full-thickness and can be degenerative (insidious, >40 years) or traumatic (any age, often with acute event). The external rotation lag test (LR+ 7.2) and internal rotation lag test (LR+ 5.6) are the most diagnostically powerful tests for full-thickness tears. Passive ROM is often preserved despite reduced active ROM. Conservative PT (progressive RC loading, scapular stability) is first-line for partial tears; refer for surgical evaluation if full-thickness tear with significant weakness or failed 3 months of PT.',
      exercises:[
        {icon:'💪', name:'Isometric ER & ABD (pain-free angles)', sets:'3x10 sec holds', desc:'Early tendon loading — isometrics reduce pain and begin strength recovery.'},
        {icon:'🔄', name:'Pendulum Exercises', sets:'2 min each direction', desc:'Gentle distraction and passive mobility for irritable phase.'},
        {icon:'🏋️', name:'Scapular Plane ABD (to pain-free range)', sets:'3x15 reps', desc:'Progressive supraspinatus loading in safe scapular plane.'},
        {icon:'🧘', name:'Sidelying ER → Standing ER with Band', sets:'3x15 reps, progressive load', desc:'Full rotator cuff progression — progress load as strength and pain allow.'}
      ]
    },
    {
      name: 'Rotator Cuff Tendinopathy',
      ageNote: 'Middle-aged adults; accounts for 65% of all shoulder pain visits',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterolateral shoulder pain')) score+=3;
        if(s.has('Painful arc (60–120°)')) score+=2;
        // Tendinopathy: pain without significant weakness distinguishes from tear
        if(!s.has('Weakness with lifting') && !s.has('Weakness with overhead')) score+=2;
        if(a.has('Repetitive overhead motion')||a.has('Overhead activities (60–120° arc)')) score+=3;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['Hawkins-Kennedy Test']==='+') score+=3;
        if(tests['Neer Impingement Sign']==='+') score+=2;
        if(tests['Empty Can Test (Jobe)']==='+') score+=2;
        // Lag tests negative helps differentiate from tear
        if(tests['External Rotation Lag Test']==='-') score+=2;
        if(tests['Drop Arm Test']==='-') score+=2;
        if(age) {
          if(age >= 40 && age <= 60) score+=2;
        }
        return score;
      },
      edu:'RC tendinopathy (without tear) accounts for the majority of shoulder pain presentations. Pain is anterolateral, worsened by overhead activity, with gradual onset. Strength is typically diminished by pain rather than structural deficit — lag tests should be negative. No single test is definitive; use a combination of history, Hawkins-Kennedy, Neer, and empty can. Progressive tendon loading (isometric → isotonic → functional) is the evidence-based treatment; avoid complete rest.',
      exercises:[
        {icon:'💪', name:'Isometric RC Loading (all planes)', sets:'5x45 sec holds', desc:'Pain-modulating isometrics — start at 50–70% effort in pain-free positions.'},
        {icon:'🔄', name:'Isotonic ER / IR Progression (band)', sets:'3x15 reps', desc:'Progress from isometrics when pain <3/10 — slow, controlled tempo.'},
        {icon:'🏋️', name:'Scaption to 90° (progressive load)', sets:'3x15 reps', desc:'Functional supraspinatus loading — key for overhead return.'},
        {icon:'🧘', name:'Posterior Capsule Stretch (sleeper)', sets:'Hold 30 sec x3', desc:'Reduces GIRD (glenohumeral IR deficit) — major modifiable contributor to RC tendinopathy.'}
      ]
    },
    {
      name: 'Subacromial Bursitis',
      ageNote: 'Any age; often accompanies rotator cuff pathology',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterolateral shoulder pain')) score+=3;
        if(s.has('Painful arc (60–120°)')) score+=3;
        if(s.has('Night pain / sleep disturbance')) score+=2;
        if(a.has('Arm elevation')||a.has('Overhead activities (60–120° arc)')||a.has('Repetitive overhead motion')) score+=3;
        if(al.has('Rest')||al.has('Ice')) score+=2;
        if(tests['Hawkins-Kennedy Test']==='+') score+=3;
        if(tests['Neer Impingement Sign']==='+') score+=3;
        // Bursitis is clinically indistinguishable from impingement — very similar scoring
        if(tests['External Rotation Lag Test']==='-') score+=2; // helps differentiate from tear
        if(tests['Drop Arm Test']==='-') score+=2;
        return score;
      },
      edu:'Subacromial bursitis is often clinically indistinguishable from impingement syndrome and frequently coexists with rotator cuff pathology. Diagnostic injection (corticosteroid + local anaesthetic) can help differentiate — complete pain relief suggests predominantly bursal involvement. The same tests (Hawkins-Kennedy, Neer, painful arc) are positive. Acute management includes ice and activity modification; subacute treatment mirrors impingement rehabilitation.',
      exercises:[
        {icon:'🧊', name:'Ice / Cryotherapy', sets:'10–15 min x3 daily', desc:'Reduces acute bursal inflammation — most effective in the first 48–72 hours.'},
        {icon:'🔄', name:'Pendulum / Codman Exercises', sets:'2 min each direction', desc:'Gentle distraction movement to prevent stiffness without loading the bursa.'},
        {icon:'💪', name:'Scapular Stabilization (no overhead)', sets:'3x15 reps', desc:'Improve subacromial space through scapular positioning — avoid overhead loading until inflammation settles.'},
        {icon:'🏋️', name:'Progressive RC Strengthening (as tolerated)', sets:'3x15 reps', desc:'Transition to full impingement protocol once acute inflammation resolves.'}
      ]
    },
    {
      name: 'Labral Tear (SLAP)',
      ageNote: 'Young athletes in overhead sports; traumatic or repetitive microtrauma',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Deep shoulder pain')) score+=3;
        if(s.has('Clicking / popping / catching')) score+=3;
        if(s.has('Giving way / instability')) score+=2;
        if(s.has('Anterolateral shoulder pain')) score+=1;
        if(a.has('Overhead throwing')||a.has('Throwing / sport activities')) score+=4;
        if(a.has('Repetitive overhead motion')||a.has('Overhead activities (60–120° arc)')) score+=2;
        if(al.has('Rest')||al.has('Avoiding provocative positions')) score+=1;
        if(tests['Dynamic Labral Shear Test']==='+') score+=6; // LR+ 31.6
        if(tests['O\'Brien Active Compression Test']==='+') score+=4;
        if(tests['Crank Test']==='+') score+=3;
        if(tests['Anterior Slide Test']==='+') score+=2;
        if(age) {
          if(age >= 15 && age <= 35) score+=2;
        }
        return score;
      },
      edu:'SLAP tears involve the superior labrum from anterior to posterior at the biceps anchor. Deep shoulder pain, mechanical symptoms (clicking/catching), and instability with overhead throwing are hallmarks. The dynamic labral shear test is the most specific (LR+ 31.6); O\'Brien test is 90% sensitive; combining O\'Brien + crank is most sensitive in parallel. Conservative PT (RC strengthening, posterior capsule stretching, scapular stability) is first-line; surgical repair considered if conservative management fails after 3–6 months.',
      exercises:[
        {icon:'💪', name:'RC Strengthening (below 90°)', sets:'3x15 reps each direction', desc:'Rebuild RC strength to reduce superior labral load — avoid provocative end-range initially.'},
        {icon:'🧘', name:'Posterior Capsule Stretch (sleeper)', sets:'Hold 30 sec x3', desc:'GIRD is a major risk factor for SLAP tears in throwers — must address.'},
        {icon:'🔄', name:'Scapular Stability Training', sets:'3x15 reps each', desc:'Serratus anterior and lower trap activation to restore scapular upward rotation.'},
        {icon:'🏋️', name:'Interval Throwing Program (return phase)', sets:'Graded volume/intensity', desc:'Structured return to throwing — only after full strength and pain-free overhead ROM restored.'}
      ]
    },
    {
      name: 'Glenohumeral Instability / Dislocation',
      ageNote: 'Peak 15–25 years; males > females; recurrence up to 92% in young athletes',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Giving way / instability')) score+=5;
        if(s.has('Apprehension')) score+=4;
        if(s.has('Clicking / popping / catching')) score+=2;
        if(s.has('Pain radiating down arm / biceps')) score+=1;
        if(a.has('Abduction + external rotation')||a.has('Throwing / sport activities')) score+=3;
        if(a.has('Overhead activities (60–120° arc)')) score+=1;
        if(al.has('Immobilization (acute instability)')||al.has('Avoiding provocative positions')) score+=3;
        if(tests['Apprehension Test']==='+') score+=5;         // LR+ 8–100
        if(tests['Relocation Test']==='+') score+=3;
        if(tests['Release Test (Surprise Test)']==='+') score+=4; // most predictive
        if(tests['Load and Shift Test']==='+') score+=4;       // LR+ >80
        if(tests['Sulcus Sign']==='+') score+=3;               // ≥2cm = MDI
        if(age) {
          if(age >= 15 && age <= 25) score+=3;
          else if(age >= 26 && age <= 35) score+=1;
        }
        if(sex === 'male') score+=1;
        return score;
      },
      edu:'Anterior GH instability is the most common direction (95%), typically occurring with abduction + ER (e.g., tackling, fall on outstretched arm). Recurrence is up to 92% in athletes under 25 — surgical stabilization should be discussed early in young active patients. The apprehension test (LR+ 8–100) and release test are most diagnostically powerful. MDI is suggested by a positive sulcus sign ≥2 cm. Rehabilitation focuses on dynamic stabilizers (subscapularis, infraspinatus) and proprioceptive retraining.',
      exercises:[
        {icon:'💪', name:'Subscapularis Strengthening (IR)', sets:'3x15 reps, progressive load', desc:'Primary dynamic stabiliser against anterior translation — sidelying IR, belly press.'},
        {icon:'🔄', name:'Rhythmic Stabilization (IR/ER)', sets:'3x30 sec', desc:'Dynamic neuromuscular stability with therapist perturbation.'},
        {icon:'🧘', name:'Proprioceptive Ball Rolling on Wall', sets:'2x60 sec each position', desc:'Joint position sense retraining — progress from stable to unstable surfaces.'},
        {icon:'🌀', name:'Progressive Sport-Specific Loading', sets:'Graded return', desc:'Throwing, contact, or overhead sport mechanics — only after full RC strength and proprioception restored.'}
      ]
    },
    {
      name: 'Adhesive Capsulitis (Frozen Shoulder)',
      ageNote: '40–60 years; more common in females (2–5% prevalence); higher risk with diabetes and hypothyroidism',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Progressive loss of motion')) score+=5;
        if(s.has('Stiffness')) score+=3;
        if(s.has('Night pain / sleep disturbance')) score+=2;
        if(s.has('Deep shoulder pain')) score+=2;
        if(s.has('Difficulty dressing / toileting')||s.has('Difficulty reaching behind back')) score+=2;
        if(a.has('Dressing / toileting')||a.has('Reaching behind back')) score+=2;
        if(al.has('Avoiding end-range movements')||al.has('Rest')) score+=2;
        // Global passive ROM restriction is the diagnostic hallmark
        if(tests['Global Passive ROM Assessment']==='+') score+=6;
        // No specific provocative tests — penalise if SLAP/instability tests positive
        if(tests['Apprehension Test']==='-') score+=1;
        if(tests['O\'Brien Active Compression Test']==='-') score+=1;
        if(age) {
          if(age >= 40 && age <= 60) score+=3;
          else if(age < 35 || age > 70) score=Math.max(0, score-2);
        }
        if(sex === 'female') score+=2;
        return score;
      },
      edu:'Adhesive capsulitis presents in 3 phases: freezing (increasing pain, early stiffness), frozen (reduced pain but severe stiffness), and thawing (gradual ROM return). The diagnostic hallmark is global restriction of BOTH active and passive ROM, with greatest loss in passive ER at the side. Most cases resolve in 1–3 years but residual stiffness is common. Risk is significantly higher with diabetes and hypothyroidism. Treatment includes mobilisation, stretching, and corticosteroid injection for the painful freezing phase; hydrodilation is an option for frozen phase.',
      exercises:[
        {icon:'🌀', name:'Pendulum / Codman Exercises', sets:'2 min each direction', desc:'Gravity-assisted distraction mobilisation — critical in all phases.'},
        {icon:'🧘', name:'Progressive Passive Stretching (ER priority)', sets:'3x30 sec holds, all planes', desc:'ER at side is the primary target — most restricted motion in adhesive capsulitis.'},
        {icon:'🔄', name:'Active-Assisted ROM (pulley / wand)', sets:'3x10 reps all planes', desc:'Maintain and progressively restore ROM across all phases.'},
        {icon:'💪', name:'RC Strengthening (pain-free range)', sets:'3x15 reps', desc:'Maintain strength through restricted range — prevent atrophy during frozen phase.'}
      ]
    },
    {
      name: 'Biceps Tendinopathy (Long Head)',
      ageNote: 'Middle-aged adults; 95% have associated rotator cuff pathology or SLAP lesion',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterolateral shoulder pain')||s.has('Deep shoulder pain')) score+=2;
        if(s.has('Pain radiating down arm / biceps')) score+=4;
        if(a.has('Repetitive overhead motion')||a.has('Overhead activities (60–120° arc)')) score+=2;
        if(al.has('Rest')||al.has('Avoiding provocative positions')) score+=1;
        if(tests['Bicipital Groove Tenderness']==='+') score+=4;
        if(tests['Upper Cut Test']==='+') score+=4;             // LR+ 3.38; 77% accurate
        if(tests['Speed\'s Test']==='+') score+=3;              // 81% specific
        if(tests['Yergason\'s Test']==='+') score+=3;           // LR+ 2.56; 83–86% specific
        // Combination of upper cut + bicipital groove tenderness is optimal
        if(tests['Upper Cut Test']==='+' && tests['Bicipital Groove Tenderness']==='+') score+=3;
        if(age) {
          if(age >= 40 && age <= 60) score+=2;
        }
        return score;
      },
      edu:'LHB tendinopathy presents as deep, throbbing anterior shoulder pain often radiating down the biceps. The bicipital groove is tender with the arm in 10° IR. Importantly, 95% of cases have associated RC pathology or SLAP lesion — always evaluate the full shoulder. The upper cut test (LR+ 3.38) combined with bicipital groove tenderness is the most accurate clinical combination. Speed\'s (81% specific) and Yergason\'s (83–86% specific) are useful confirmatory tests. Progressive biceps and RC loading is the primary treatment.',
      exercises:[
        {icon:'💪', name:'Isometric Biceps Loading (elbow 90°)', sets:'5x10 sec holds', desc:'Pain-modulating isometrics — start in position of comfort before progressing.'},
        {icon:'🔄', name:'Eccentric Bicep Curls', sets:'3x15 slow eccentric', desc:'Tendon remodeling loading — slow 3–4 sec lowering phase.'},
        {icon:'🏋️', name:'RC Strengthening (concurrent)', sets:'3x15 reps', desc:'Address the associated RC pathology present in 95% of LHB cases.'},
        {icon:'🧘', name:'Posterior Capsule Stretch', sets:'Hold 30 sec x3', desc:'Reduces anterior shoulder translation that loads the biceps anchor.'}
      ]
    },
    {
      name: 'AC Joint Osteoarthritis / Dysfunction',
      ageNote: 'Middle-aged adults; most common AC joint disorder',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Superior shoulder pain')||s.has('Pain at AC joint')) score+=5;
        if(s.has('Anterolateral shoulder pain')) score+=1;
        if(a.has('Cross-body / horizontal adduction')||a.has('Reaching across body')) score+=4;
        if(a.has('Overhead activities (60–120° arc)')||a.has('Side lying on affected shoulder')) score+=2;
        if(al.has('Avoiding provocative positions')||al.has('Rest')) score+=2;
        if(tests['AC Joint Palpation / Tenderness']==='+') score+=5; // 96% sensitive
        if(tests['Cross-Body Adduction Test']==='+') score+=4;
        if(tests['Paxinos Test']==='+') score+=4;               // 79% sensitive
        // Paxinos + bone scan = 99% post-test probability (refer for imaging if needed)
        if(age) {
          if(age >= 40) score+=2;
          else if(age >= 30) score+=1;
        }
        return score;
      },
      edu:'AC joint OA is the most common AC joint disorder and presents with anterior/superior shoulder pain localised to the AC joint, worsened by cross-body adduction and overhead activity. AC joint tenderness is 96% sensitive; the Paxinos test is 79% sensitive. Diagnostic local anaesthetic injection confirms the AC joint as the pain source. A positive Paxinos test combined with a positive bone scan yields 99% post-test probability. Conservative treatment includes activity modification and AC joint mobilisation; corticosteroid injection is effective for persistent symptoms.',
      exercises:[
        {icon:'🔄', name:'Scapular Retraction & Postural Correction', sets:'3x15 reps + sustained posture', desc:'Reduces AC joint compressive loading from rounded shoulder posture.'},
        {icon:'💪', name:'RC Strengthening (avoid cross-body)', sets:'3x15 reps each direction', desc:'Maintain rotator cuff strength — modify to avoid horizontal adduction provocation.'},
        {icon:'🧘', name:'Pectoralis Minor Stretch', sets:'Hold 30 sec x3', desc:'Releases anterior shoulder tightness contributing to AC joint loading.'},
        {icon:'🌀', name:'Gradual Return to Overhead / Cross-Body', sets:'Progressive load', desc:'Graded reintroduction of provocative movements as symptoms settle.'}
      ]
    },
    {
      name: 'Glenohumeral Osteoarthritis',
      ageNote: 'Most common >60 years; more common in women; prevalence 94% in women >80 years',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Progressive loss of motion')) score+=4;
        if(s.has('Stiffness')) score+=3;
        if(s.has('Deep shoulder pain')) score+=2;
        if(s.has('Clicking / popping / catching')) score+=1; // crepitus
        if(a.has('Overhead activities (60–120° arc)')||a.has('Arm elevation')) score+=2;
        if(al.has('Rest')||al.has('Avoiding provocative positions')) score+=2;
        if(tests['Global Passive ROM Assessment']==='+') score+=4;
        if(age) {
          if(age >= 70) score+=5;
          else if(age >= 60) score+=4;
          else if(age >= 50) score+=2;
          else if(age < 45) score=Math.max(0, score-3);
        }
        if(sex === 'female') score+=1;
        return score;
      },
      edu:'GH OA presents with progressive pain and stiffness over months to years, with global passive ROM restriction (greatest in ER at side) and possible crepitus. Prevalence reaches 94% in women over 80. Radiographs show joint space narrowing, osteophytes, and posterior humeral head subluxation. There are no specific provocative tests — diagnosis is clinical + radiographic. Conservative PT (mobility, RC strengthening, activity modification) is first-line; total shoulder arthroplasty is highly effective when conservative management fails.',
      exercises:[
        {icon:'🌀', name:'Pendulum & Active-Assisted ROM', sets:'2 min + 3x10 reps each direction', desc:'Maintain available ROM and prevent further capsular contracture.'},
        {icon:'💪', name:'RC Strengthening (pain-free range)', sets:'3x15 reps', desc:'Maintain dynamic joint stability and slow functional decline.'},
        {icon:'🧘', name:'ER Stretching at Side (towel/wand)', sets:'Hold 30 sec x3', desc:'Priority stretch — ER is the most restricted motion in GH OA.'},
        {icon:'🚲', name:'Aquatic / Low-Load Functional Activities', sets:'20–30 min', desc:'Buoyancy reduces GH compressive load — ideal for pain-limited patients.'}
      ]
    },
    {
      name: 'Scapular Dyskinesis',
      ageNote: 'Common in athletes and patients with shoulder pathology; any age',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterolateral shoulder pain')) score+=2;
        if(s.has('Giving way / instability')) score+=2;
        if(s.has('Difficulty reaching behind back')) score+=1;
        if(a.has('Overhead activities (60–120° arc)')||a.has('Repetitive overhead motion')) score+=3;
        if(al.has('Rest')) score+=1;
        if(tests['Scapular Assistance Test']==='+') score+=5;
        if(tests['Scapular Retraction Test']==='+') score+=4;
        if(tests['Scapular Position / Winging Observation']==='+') score+=3;
        return score;
      },
      edu:'Scapular dyskinesis refers to abnormal scapular position or motion — typically protraction at rest and abnormal upward rotation rhythm during arm elevation. It is rarely an isolated diagnosis; it is usually secondary to shoulder pathology, thoracic stiffness, or RC dysfunction. The scapular assistance test (symptoms improve with manual upward rotation assistance) is key for diagnosis and treatment planning. Scapular stabilizer strengthening and thoracic mobility are the primary treatments.',
      exercises:[
        {icon:'💪', name:'Lower Trap Strengthening (prone Y)', sets:'3x15 reps', desc:'Primary scapular depressor and upward rotator — cornerstone of dyskinesis rehab.'},
        {icon:'🔄', name:'Wall Slides (serratus activation)', sets:'3x15 reps', desc:'Serratus anterior — restores scapular protraction control and upward rotation.'},
        {icon:'🌀', name:'Thoracic Rotation Mobility', sets:'3x10 each direction', desc:'Thoracic restriction is a primary driver of scapular dyskinesis.'},
        {icon:'🧘', name:'Prone Y-T-W', sets:'3x10 each position', desc:'Comprehensive lower trap, mid-trap, and rhomboid activation for scapular stability.'}
      ]
    },
    {
      name: 'Thoracic Outlet Syndrome (Neurogenic) — Shoulder presentation',
      ageNote: 'More common in females; associated with trauma, repetitive overhead work, or congenital anomalies',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Paresthesias (C8/T1 distribution)')) score+=5;
        if(s.has('Arm fatigue')) score+=3;
        if(s.has('Weakness with lifting')||s.has('Weakness with overhead')) score+=2;
        if(s.has('Pain radiating down arm / biceps')) score+=2;
        if(a.has('Sustained arm positions')||a.has('Carrying objects')) score+=3;
        if(a.has('Overhead activities (60–120° arc)')||a.has('Repetitive overhead motion')) score+=3;
        if(al.has('Shoulder abduction (hand on head)')||al.has('Avoiding provocative positions')) score+=3;
        if(tests['Elevated Arm Stress Test (EAST / Roos)']==='+') score+=4;
        if(tests['Adson Test']==='+') score+=3;
        if(tests['Wright Test (Hyperabduction)']==='+') score+=3;
        if(sex === 'female') score+=1;
        return score;
      },
      edu:'Neurogenic TOS at the shoulder involves compression of the lower brachial plexus (C8–T1) causing paresthesias in the ring/little finger, hand weakness, and arm fatigue with elevation. Thenar/hypothenar atrophy indicates severe or long-standing compression. The EAST/Roos test (3 min elevated arm opening/closing) is the most sensitive provocation. Conservative PT (postural correction, scalene/pec minor stretching, first rib mobilization) is first-line — the same protocol as thoracic-region TOS.',
      exercises:[
        {icon:'🧘', name:'Scalene Stretch', sets:'Hold 30 sec x3 each side', desc:'Reduces anterior and middle scalene compression of the brachial plexus.'},
        {icon:'🌀', name:'Pectoralis Minor Stretch', sets:'Hold 30 sec x3', desc:'Releases pec minor compression beneath the coracoid.'},
        {icon:'💪', name:'First Rib Mobilization (self)', sets:'2x10 reps', desc:'Reduces first rib elevation contributing to thoracic outlet narrowing.'},
        {icon:'🪑', name:'Postural Correction & Thoracic Extension', sets:'3x10 reps + sustained posture work', desc:'Forward head and rounded shoulders are primary TOS contributors.'}
      ]
    }
  ],
  knee: [
    {
      name: 'Knee Osteoarthritis',
      ageNote: 'Most common ≥45 years; rare under 30',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Crepitus')||s.has('Bony enlargement')) score+=3;
        if(s.has('Morning stiffness (<30 min)')||s.has('Swelling/effusion')) score+=2;
        if(s.has('Deep ache')||s.has('Night pain')) score+=1;
        if(a.has('Weight-bearing activities')||a.has('Prolonged walking')||a.has('Ascending stairs')||a.has('Descending stairs')) score+=2;
        if(a.has('Squatting')||a.has('Kneeling')) score+=1;
        if(al.has('Rest')||al.has('Activity modification')) score+=1;
        if(tests['Patellar Grind / Clarke\'s Sign']==='+') score+=1;
        // Age weighting: OA is rare under 40, common over 55
        if(age) {
          if(age >= 65) score+=4;
          else if(age >= 55) score+=3;
          else if(age >= 45) score+=2;
          else if(age >= 40) score+=1;
          else if(age < 35) score = Math.max(0, score - 3);
        }
        return score;
      },
      edu:'Knee osteoarthritis involves breakdown of joint cartilage and is the most common musculoskeletal condition in adults over 45. Morning stiffness lasting less than 30 minutes and crepitus are hallmark signs. Exercise therapy is the most evidence-based treatment — the joint needs movement to stay healthy. Weight loss (if applicable), aquatic therapy, and activity modification are also beneficial.',
      exercises:[
        {icon:'🚲', name:'Stationary Cycling', sets:'15–20 min, low resistance', desc:'Joint-friendly aerobic exercise that maintains ROM and builds quad strength without impact.'},
        {icon:'💪', name:'Quad Sets', sets:'3x15, 10 sec hold', desc:'Isometric quad activation to reduce pain and maintain strength.'},
        {icon:'🌉', name:'Seated Leg Press (partial range)', sets:'3x15', desc:'Closed-chain strengthening within comfortable range.'},
        {icon:'🧘', name:'Aquatic Walking / Pool Therapy', sets:'20–30 min', desc:'Buoyancy reduces joint load while allowing full movement and strength work.'}
      ]
    },
    {
      name: 'Patellofemoral Pain Syndrome (PFPS)',
      ageNote: 'Peak incidence 16–25 years; can occur up to ~40 years',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior knee pain')) score+=3;
        if(s.has('Stiffness after sitting')) score+=2;
        if(s.has('Crepitus')) score+=1;
        if(a.has('Squatting')) score+=3;
        if(a.has('Prolonged sitting')||a.has('Descending stairs')||a.has('Running')||a.has('Repetitive knee flexion/extension')) score+=2;
        if(a.has('Kneeling')) score+=1;
        if(al.has('Rest')||al.has('Activity modification')) score+=1;
        if(tests['Patellar Grind / Clarke\'s Sign']==='+') score+=2;
        if(tests['Patellar Compression Test']==='+') score+=2;
        if(tests['Single-Leg Squat Assessment']==='+') score+=2;
        // Peak incidence 16–25; more common in females
        if(age) {
          if(age >= 16 && age <= 25) score+=3;
          else if(age >= 26 && age <= 40) score+=1;
          else if(age > 50) score = Math.max(0, score - 2);
        }
        if(sex === 'female') score+=2;
        return score;
      },
      edu:'PFPS causes anterior or peripatellar knee pain due to abnormal patellofemoral stress, often from quad weakness, hip weakness, or poor patellar tracking. The "theater sign" (pain with prolonged sitting) is a classic clue. Avoid provocative activities initially, but progressive loading is essential for recovery.',
      exercises:[
        {icon:'💪', name:'VMO Quad Sets (slight knee bend)', sets:'3x15, 10 sec hold', desc:'Targeted VMO activation — key muscle for patellar tracking.'},
        {icon:'🦵', name:'Hip Abduction & ER Strengthening', sets:'3x20 each', desc:'Glute med and ER weakness are major contributors to PFPS via femoral adduction.'},
        {icon:'🌀', name:'Terminal Knee Extension (TKE)', sets:'3x20', desc:'VMO activation at terminal range with resistance band.'},
        {icon:'🧘', name:'Step-Downs (eccentric control)', sets:'3x10 slow', desc:'Controlled eccentric quad loading for functional carry-over.'}
      ]
    },
    {
      name: 'Patellar Tendinopathy (Jumper\'s Knee)',
      ageNote: 'Athletes in jumping sports (basketball, volleyball); any age',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Tenderness at patellar tendon')) score+=4;
        if(s.has('Anterior knee pain')||s.has('Sharp pain')) score+=1;
        if(a.has('Jumping/landing')||a.has('Running')) score+=3;
        if(a.has('Squatting')||a.has('Kneeling')||a.has('Repetitive knee flexion/extension')) score+=2;
        if(al.has('Rest')||al.has('Activity modification')) score+=1;
        if(tests['Patellar Tendon Palpation']==='+') score+=4;
        // Common in young athletic population
        if(age) {
          if(age >= 15 && age <= 35) score+=2;
          else if(age > 50) score = Math.max(0, score - 1);
        }
        return score;
      },
      edu:'Patellar tendinopathy presents with localized pain at the inferior pole of the patella, typically load-related. Resisted knee extension is often painful. Tendon thickening >8.8 mm is considered abnormal. Unlike most injuries, complete rest is counterproductive — progressive tendon loading is the gold standard treatment.',
      exercises:[
        {icon:'🏋️', name:'Isometric Leg Press / Wall Sit', sets:'5x45 sec holds', desc:'Isometric loading for immediate pain relief and early tendon loading.'},
        {icon:'🔄', name:'Spanish Squat (Isotonic)', sets:'4x8, heavy and slow', desc:'Progress to heavy slow resistance — most evidence-based for tendon remodeling.'},
        {icon:'🦵', name:'Decline Squat (25° decline board)', sets:'3x15', desc:'Isolates patellar tendon loading more effectively than flat squats.'},
        {icon:'💪', name:'Single-Leg Press (progressive load)', sets:'3x12, increase load weekly', desc:'Functional progressive loading toward return to sport.'}
      ]
    },
    {
      name: 'ACL Sprain / Tear',
      ageNote: 'Peak 15–25 years; more common in females',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Giving way/instability')||s.has('Swelling/effusion')) score+=2;
        if(a.has('Pivoting/cutting')||a.has('Jumping/landing')) score+=3;
        if(tests['Lachman Test']==='+') score+=5;
        if(tests['Pivot Shift Test']==='+') score+=4;
        if(tests['Anterior Drawer Test']==='+') score+=2;
        // Peak 15–25, more common in females
        if(age) {
          if(age >= 15 && age <= 25) score+=3;
          else if(age >= 26 && age <= 35) score+=1;
        }
        if(sex === 'female') score+=2;
        return score;
      },
      edu:'ACL tears often occur with pivoting, cutting, or landing mechanisms and frequently produce an audible "pop" with acute effusion. The Lachman test is the gold standard (87% sensitive, 97% specific). Both surgical and conservative options exist depending on activity level, age, and associated injuries. Early rehabilitation focuses on swelling control and quad activation.',
      exercises:[
        {icon:'💪', name:'Quad Sets & Straight Leg Raises', sets:'3x15', desc:'Immediate post-injury quad activation to prevent atrophy.'},
        {icon:'🌉', name:'Heel Slides', sets:'3x15', desc:'Gentle ROM restoration — target full extension first.'},
        {icon:'🦵', name:'Hip Abduction & Extension', sets:'3x20', desc:'Proximal strength to reduce dynamic valgus at return to sport.'},
        {icon:'🚲', name:'Stationary Cycling (short crank)', sets:'15 min', desc:'ROM and quad activation with a controlled, safe environment.'}
      ]
    },
    {
      name: 'PCL Sprain / Tear',
      ageNote: 'Any age; less common than ACL',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Posterior knee pain')||s.has('Swelling/effusion')) score+=2;
        if(a.has('Weight-bearing activities')||a.has('Descending stairs')) score+=1;
        if(tests['Posterior Drawer Test']==='+') score+=5;
        return score;
      },
      edu:'PCL injuries often result from a direct blow to the anterior tibia (dashboard injury) or falling on a flexed knee. They produce less instability than ACL tears and frequently have minimal trauma recalled. The posterior tibial sag sign is pathognomonic. Most isolated PCL tears respond well to conservative PT.',
      exercises:[
        {icon:'💪', name:'Prone Hamstring Curls (avoid)', sets:'— Contraindicated acutely', desc:'Hamstring activation pulls tibia posteriorly — avoid in acute PCL injury.'},
        {icon:'🌉', name:'Quad Sets & SLRs', sets:'3x15', desc:'Quad dominance preferred early — quads stabilize against posterior tibial translation.'},
        {icon:'🦵', name:'Closed Chain Leg Press (0–60°)', sets:'3x15', desc:'Safe strengthening arc for PCL protection.'},
        {icon:'🚲', name:'Stationary Cycling', sets:'15 min', desc:'Joint-friendly quad strengthening and ROM restoration.'}
      ]
    },
    {
      name: 'MCL Sprain',
      ageNote: 'Any age; most common collateral ligament injury',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial knee pain')||s.has('Swelling/effusion')) score+=2;
        if(a.has('Pivoting/cutting')) score+=2;
        if(al.has('Rest')||al.has('Bracing/support')) score+=1;
        if(tests['Valgus Stress Test (0° and 30°)']==='+') score+=5;
        return score;
      },
      edu:'MCL sprains are the most common knee ligament injury, typically from a valgus force (e.g., soccer tackle). Graded I–III based on laxity. Grade I–II injuries heal well conservatively; Grade III may require bracing or surgical consult if associated with ACL/meniscal injury. Medial joint line tenderness and valgus stress test are key findings.',
      exercises:[
        {icon:'💪', name:'Quad Sets & SLRs', sets:'3x15', desc:'Maintains quad strength without stressing the healing MCL.'},
        {icon:'🦵', name:'Hip Abduction Strengthening', sets:'3x20', desc:'Reduces dynamic valgus stresses on the MCL.'},
        {icon:'🌉', name:'Mini Squats (pain-free range)', sets:'3x15', desc:'Begin closed chain loading as swelling resolves.'},
        {icon:'🧘', name:'Single-Leg Balance Progression', sets:'3x30 sec', desc:'Proprioception restoration for return to sport readiness.'}
      ]
    },
    {
      name: 'LCL Sprain / Posterolateral Corner',
      ageNote: 'Any age; rare in isolation — often combined injury',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lateral knee pain')) score+=2;
        if(tests['Varus Stress Test (0° and 30°)']==='+') score+=4;
        if(tests['Dial Test (30° and 90°)']==='+') score+=3;
        return score;
      },
      edu:'Isolated LCL sprains are uncommon. When the varus stress test is positive, screen carefully for posterolateral corner (PLC) involvement and PCL injury. PLC injuries have a high failure rate when missed. Lateral knee tenderness and varus laxity are key findings. Refer for imaging if combined injury suspected.',
      exercises:[
        {icon:'💪', name:'Hip Abduction & ER Strengthening', sets:'3x20', desc:'Supports lateral knee stability by controlling proximal mechanics.'},
        {icon:'🌉', name:'Quad Sets & Terminal Knee Extension', sets:'3x15', desc:'Maintains quad strength while avoiding varus stress.'},
        {icon:'🧘', name:'Balance Perturbation Training', sets:'3x30 sec each leg', desc:'Proprioception and lateral stabilizer re-education.'},
        {icon:'🦵', name:'Side-Lying Hip Strengthening Series', sets:'3x20 each', desc:'Glute med/max and TFL activation for posterolateral stability.'}
      ]
    },
    {
      name: 'Meniscal Tear (Traumatic)',
      ageNote: 'Typically <40 years with twisting mechanism',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Locking')||s.has('Catching sensation')) score+=3;
        if(s.has('Swelling/effusion')||s.has('Clicking/popping')) score+=2;
        if(s.has('Medial knee pain')||s.has('Lateral knee pain')) score+=1;
        if(a.has('Twisting movements')||a.has('Pivoting/cutting')||a.has('Deep knee flexion')) score+=3;
        if(al.has('Rest')||al.has('Avoiding deep flexion')) score+=1;
        if(tests['McMurray Test']==='+') score+=3;
        if(tests['Thessaly Test']==='+') score+=3;
        if(tests['Joint Line Palpation']==='+') score+=3;
        return score;
      },
      edu:'Traumatic meniscal tears typically occur with twisting mechanisms and present with joint line tenderness, possible effusion, and mechanical symptoms (locking, catching). McMurray test (61% sensitive, 84% specific) and joint line tenderness (83% sensitive/specific) are key clinical tests. Conservative PT works well for many tears; surgical consult for locked knees or failed conservative management.',
      exercises:[
        {icon:'💪', name:'Quad Sets (full extension)', sets:'3x15, 10 sec hold', desc:'Quad activation without compressive load on meniscus.'},
        {icon:'🌉', name:'Straight Leg Raises', sets:'3x15', desc:'Strengthens quad without requiring knee flexion.'},
        {icon:'🦵', name:'Hip Strengthening Series (sidelying)', sets:'3x20 each direction', desc:'Reduces meniscal load through improved proximal control.'},
        {icon:'🚲', name:'Stationary Cycling (low resistance)', sets:'15–20 min', desc:'Joint mobility with minimal compressive and shear load.'}
      ]
    },
    {
      name: 'Meniscal Tear (Degenerative)',
      ageNote: 'Typically ≥40 years; often coexists with osteoarthritis',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial knee pain')||s.has('Lateral knee pain')) score+=2;
        if(s.has('Swelling/effusion')||s.has('Deep ache')) score+=1;
        if(a.has('Weight-bearing activities')||a.has('Twisting movements')||a.has('Prolonged walking')) score+=2;
        if(al.has('Rest')||al.has('Activity modification')) score+=1;
        if(tests['McMurray Test']==='+') score+=2;
        if(tests['Joint Line Palpation']==='+') score+=3;
        // Age weighting: degenerative tears are uncommon under 40
        if(age) {
          if(age >= 55) score+=3;
          else if(age >= 40) score+=2;
          else if(age < 35) score = Math.max(0, score - 2);
        }
        return score;
      },
      edu:'Degenerative meniscal tears are common in adults over 40 and frequently coexist with osteoarthritis. Mechanical symptoms do not predict surgical need in this population — strong evidence supports conservative PT over surgery for most degenerative tears. Focus on quadriceps strength, activity modification, and load management.',
      exercises:[
        {icon:'💪', name:'Quad Sets & SLRs', sets:'3x15', desc:'Foundation of conservative meniscal rehab regardless of tear type.'},
        {icon:'🚲', name:'Stationary Cycling', sets:'15–20 min', desc:'Aerobic capacity and quad strength with minimal joint stress.'},
        {icon:'🌉', name:'Seated Leg Press (shallow range)', sets:'3x15', desc:'Progressive loading with controlled range of motion.'},
        {icon:'🧘', name:'Gait Training / Walking Program', sets:'20–30 min, level surface', desc:'Graded return to functional activity with load management.'}
      ]
    },
    {
      name: 'Pes Anserine Bursitis',
      ageNote: 'Middle-aged to older adults, especially females; associated with knee OA',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial knee pain')) score+=2;
        if(s.has('Night pain')) score+=1;
        if(a.has('Ascending stairs')||a.has('Running')||a.has('Weight-bearing activities')) score+=2;
        if(al.has('Rest')||al.has('Ice')) score+=1;
        if(tests['Pes Anserine Palpation']==='+') score+=5;
        // More common in middle-aged/older females
        if(age) {
          if(age >= 50) score+=2;
          else if(age >= 40) score+=1;
        }
        if(sex === 'female') score+=1;
        return score;
      },
      edu:'Pes anserine bursitis causes medial knee pain approximately 2 cm distal to the medial tibial plateau — distal and inferior to the joint line (distinguishing it from MCL or meniscal pathology). It is commonly associated with obesity, knee OA, and diabetes. Pain often radiates proximally along the semitendinosus. Ice, activity modification, and hamstring/quad stretching are first-line treatments.',
      exercises:[
        {icon:'🧘', name:'Hamstring Stretching (supine)', sets:'Hold 30 sec x3 each', desc:'Reduces tension at the pes anserine insertion.'},
        {icon:'💪', name:'Quad Sets', sets:'3x15, 10 sec hold', desc:'Maintains quad strength without provoking the bursa.'},
        {icon:'🔄', name:'Hip Adductor Stretching', sets:'Hold 30 sec x3 each', desc:'Reduces valgus load contributing to bursal irritation.'},
        {icon:'🌉', name:'Stationary Cycling (low resistance)', sets:'15 min', desc:'Maintains fitness with low friction over the medial knee.'}
      ]
    }
  ],
  ankle: [
    {
      name: 'Lateral Ankle Sprain (ATFL/CFL)',
      ageNote: 'Any age; most common musculoskeletal injury; athletes and general population',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lateral ankle pain')) score+=4;
        if(s.has('Swelling / effusion')||s.has('Bruising / ecchymosis')) score+=3;
        if(s.has('Instability / giving way')) score+=2;
        if(a.has('Inversion injury')) score+=5;
        if(a.has('Uneven terrain')||a.has('Weight-bearing activities')) score+=2;
        if(al.has('Rest')||al.has('Immobilization / boot')) score+=2;
        if(tests['Anterior Drawer Test']==='+') score+=5;
        if(tests['Talar Tilt Test']==='+') score+=3;
        if(tests['Ottawa Ankle Rules Assessment']==='-') score+=1;
        return score;
      },
      edu:'Lateral ankle sprains are the most common musculoskeletal injury, involving the ATFL (most commonly) followed by the CFL. Ottawa Rules screen for fracture. The anterior drawer test is 100% specific in the acute setting; delayed exam at 4–7 days improves sensitivity to 96%. Chronic ankle instability develops in 30–40% — proprioceptive retraining is essential. Early weight-bearing and functional rehabilitation outperform immobilisation.',
      exercises:[
        {icon:'🔄', name:'Alphabet Ankle (active ROM)', sets:'3 reps (full alphabet)', desc:'Restore mobility in all planes — begin as soon as weight-bearing tolerated.'},
        {icon:'🧘', name:'Single Leg Balance Progression', sets:'3x30 sec → eyes closed → unstable surface', desc:'Proprioception is the most important factor in preventing re-sprain.'},
        {icon:'🌀', name:'Resistance Band Eversion (peroneal strengthening)', sets:'3x20 reps', desc:'Peroneals are the primary dynamic lateral stabilisers — critical for recurrence prevention.'},
        {icon:'🦵', name:'Heel-Toe Walking → Hopping Progression', sets:'Graded return', desc:'Criterion-based functional return — not time-based.'}
      ]
    },
    {
      name: 'High Ankle Sprain (Syndesmotic)',
      ageNote: 'Athletes; eversion / external rotation mechanism; longer recovery than lateral sprain',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior ankle pain')) score+=3;
        if(s.has('Pain out of proportion to injury')) score+=4;
        if(a.has('External rotation of foot')||a.has('Push-off / toe-off')) score+=4;
        if(a.has('Weight-bearing activities')||a.has('Running')) score+=2;
        if(al.has('Rest')||al.has('Immobilization / boot')) score+=2;
        if(tests['Syndesmosis Ligament Palpation']==='+') score+=5;
        if(tests['Squeeze Test (fibular compression)']==='+') score+=4;
        if(tests['Dorsiflexion-External Rotation Stress Test']==='+') score+=3;
        if(tests['Syndesmosis Ligament Palpation']==='+' && tests['Squeeze Test (fibular compression)']==='+') score+=3;
        return score;
      },
      edu:'Syndesmotic (high ankle) sprains involve the anterior tibiofibular ligament and recover significantly slower than lateral sprains. Syndesmosis ligament palpation is 92% sensitive; squeeze test is 88% specific — combine both for best accuracy. Ottawa Rules apply — screen for associated Maisonneuve fracture. Return to sport requires full pain-free dorsiflexion and hop test clearance — typically 6–12 weeks minimum.',
      exercises:[
        {icon:'🧘', name:'Isometric Ankle Stabilisation', sets:'5x10 sec holds', desc:'Early-phase pain-free loading — protect healing syndesmosis.'},
        {icon:'🔄', name:'Progressive Dorsiflexion Range Work', sets:'3x10 reps', desc:'Restore DF — the primary motion limited by syndesmotic tightness.'},
        {icon:'💪', name:'Calf Strengthening Progression', sets:'3x15 → single heel raise', desc:'Restores push-off strength — bilateral before unilateral.'},
        {icon:'🦵', name:'Graduated Return to Running / Cutting', sets:'Progressive load ~6–12 weeks', desc:'Slower return than lateral sprain — hop test symmetry required before sport clearance.'}
      ]
    },
    {
      name: 'Ankle Osteoarthritis',
      ageNote: 'Increases with age; prevalence ~7% in older adults; often post-traumatic',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Deep ache')||s.has('Anterior ankle pain')) score+=2;
        if(s.has('Stiffness')) score+=3;
        if(s.has('Clicking / popping')) score+=1;
        if(s.has('Morning pain (first steps)')) score+=1;
        if(a.has('Weight-bearing activities')||a.has('Prolonged standing')||a.has('Prolonged walking')) score+=3;
        if(a.has('Ascending stairs')||a.has('Descending stairs')) score+=2;
        if(al.has('Rest')||al.has('Orthotics / arch support')) score+=2;
        if(tests['Ankle OA End-Range Stress Test']==='+') score+=4;
        if(age) {
          if(age >= 65) score+=4;
          else if(age >= 55) score+=3;
          else if(age >= 45) score+=2;
          else if(age < 35) score=Math.max(0,score-2);
        }
        return score;
      },
      edu:'Ankle OA is often post-traumatic (prior fracture or chronic instability) rather than primary. Morning stiffness, end-range pain, crepitus, and bony enlargement are characteristic. Radiographs confirm joint space narrowing and osteophytes. Conservative PT (ROM, strengthening, orthotics, activity modification) is first-line; surgical options (arthroscopy, fusion, arthroplasty) are considered when conservative management fails.',
      exercises:[
        {icon:'🔄', name:'Ankle ROM (alphabet / circles)', sets:'3 reps twice daily', desc:'Maintain available range — most critical for preserving function in ankle OA.'},
        {icon:'💪', name:'Progressive Calf Strengthening', sets:'3x15 reps', desc:'Absorbs ground reaction force and reduces ankle joint compressive load.'},
        {icon:'🧘', name:'Aquatic Walking / Pool Therapy', sets:'20–30 min', desc:'Buoyancy reduces ankle compressive load — ideal for activity-limited patients.'},
        {icon:'🌀', name:'Balance & Proprioception Training', sets:'3x30 sec each', desc:'Restores neuromuscular control often impaired in ankle OA.'}
      ]
    },
    {
      name: 'Plantar Fasciitis',
      ageNote: 'Peak 45–64 years; 1% annual prevalence; equal male/female; BMI >30 increases risk (OR 5.6)',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Plantar heel pain')) score+=5;
        if(s.has('Morning pain (first steps)')) score+=4;
        if(s.has('Pain improves with activity then worsens')) score+=3;
        if(s.has('Arch pain / medial foot pain')) score+=2;
        if(a.has('First steps in morning')) score+=4;
        if(a.has('Prolonged standing')||a.has('Weight-bearing activities')) score+=2;
        if(al.has('Rest')||al.has('Cushioned footwear')||al.has('Stretching calf')) score+=2;
        if(tests['Windlass Test (weight-bearing)']==='+') score+=4;
        if(tests['Medial Calcaneal Tuberosity Palpation']==='+') score+=4;
        if(age) { if(age >= 45 && age <= 65) score+=2; }
        return score;
      },
      edu:'Plantar fasciitis is the most common cause of heel pain, with 1% annual prevalence. Pain is worst with first steps in the morning, improves with walking, then worsens with prolonged standing. BMI >30 increases risk 5.6-fold. The weight-bearing Windlass test is more sensitive than non-weight-bearing. Reduced ankle dorsiflexion is a key modifiable risk factor. Calf stretching, plantar fascia stretching, intrinsic strengthening, and orthotics are evidence-based. Shockwave therapy is effective for chronic cases.',
      exercises:[
        {icon:'🦶', name:'Plantar Fascia Stretch (before first steps)', sets:'Hold 30 sec x3 before standing', desc:'Most important exercise — passive toe extension pre-loads fascia before first steps.'},
        {icon:'🧘', name:'Calf Stretch — gastroc (knee straight) + soleus (knee bent)', sets:'Hold 30 sec x3 each', desc:'Soleus (knee bent) specifically reduces plantar fascia load — both variants required.'},
        {icon:'🌀', name:'Short Foot / Intrinsic Foot Activation', sets:'3x15 reps, 5 sec hold', desc:'Restores active arch support — reduces passive plantar fascia load.'},
        {icon:'🔄', name:'Frozen Water Bottle Roll', sets:'5 min twice daily', desc:'Myofascial release + cryotherapy — symptomatic relief between loading sessions.'}
      ]
    },
    {
      name: 'Achilles Tendinopathy',
      ageNote: 'Peak 45–69 years; equal male/female; fluoroquinolone use is a risk factor',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Posterior ankle pain')) score+=3;
        if(s.has('Deep ache')||s.has('Stiffness')) score+=2;
        if(s.has('Morning pain (first steps)')) score+=2;
        if(s.has('Pain improves with activity then worsens')) score+=3;
        if(a.has('Running')||a.has('Increased training load')) score+=3;
        if(a.has('Push-off / toe-off')||a.has('Ascending stairs')) score+=2;
        if(al.has('Rest')) score+=1;
        if(tests['Thompson Test']==='-') score+=2;
        if(tests['Painful Arc Sign (Achilles)']==='+') score+=3;
        if(tests['Royal London Hospital Test']==='+') score+=3;
        if(tests['Mid-portion Achilles Palpation (2–6 cm)']==='+') score+=4;
        if(tests['Single Heel Raise Test (endurance)']==='+') score+=2;
        if(age) { if(age >= 45 && age <= 69) score+=2; }
        return score;
      },
      edu:'Achilles tendinopathy presents with mid-portion (2–6 cm above insertion) or insertional pain. The painful arc sign is 88% specific and the Royal London Hospital test is 86% specific for mid-portion involvement. Pain is worst on initiating activity, improves with light activity, then worsens with prolonged loading. Mid-portion and insertional types have different management — insertional: avoid end-range dorsiflexion stretching. Alfredson eccentric protocol and heavy slow resistance are the gold standards.',
      exercises:[
        {icon:'🦵', name:'Eccentric Heel Drop — Alfredson (step edge)', sets:'3x15 twice daily (knee straight + knee bent)', desc:'Gold standard for mid-portion tendinopathy — slow lowering through full range; avoid for insertional type.'},
        {icon:'💪', name:'Isometric Calf Holds', sets:'5x45 sec, 70% effort', desc:'Pain-modulating isometrics — especially effective during high-irritability phase.'},
        {icon:'🔄', name:'Heavy Slow Resistance Calf Raise', sets:'4x8 reps, 3–4 sec tempo', desc:'Tendon remodeling — bilateral to unilateral, bodyweight to loaded.'},
        {icon:'🧘', name:'Calf Stretching (mid-portion only)', sets:'Hold 30 sec x3; avoid for insertional type', desc:'Mid-portion: gastroc + soleus stretch; insertional: avoid aggressive end-range DF.'}
      ]
    },
    {
      name: 'Posterior Tibial Tendon Dysfunction (PTTD)',
      ageNote: 'Adults; prevalence 10% in adults >65 years; risk factors: obesity, diabetes, hypertension',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial ankle pain')) score+=3;
        if(s.has('Arch pain / medial foot pain')) score+=3;
        if(s.has('Progressive flatfoot deformity')) score+=5;
        if(s.has('Weakness')) score+=2;
        if(a.has('Weight-bearing activities')||a.has('Prolonged walking')||a.has('Prolonged standing')) score+=3;
        if(al.has('Rest')||al.has('Orthotics / arch support')||al.has('Immobilization / boot')) score+=2;
        if(tests['Too Many Toes Sign']==='+') score+=4;
        if(tests['Single-Limb Heel Raise Test']==='+') score+=4;
        if(tests['Resisted Inversion (plantarflexed foot)']==='+') score+=4;
        if(tests['Navicular Drop Test']==='+') score+=3;
        if(age) {
          if(age >= 65) score+=3;
          else if(age >= 50) score+=2;
        }
        if(sex==='female') score+=1;
        return score;
      },
      edu:'PTTD is the most common cause of adult-acquired flatfoot, with 10% prevalence in adults over 65. Progressive posteromedial ankle pain, hindfoot valgus, medial arch collapse, and inability to perform a single heel raise are hallmarks. MRI is 95% sensitive and 100% specific; ultrasound is 80% sensitive and 90% specific. Early stages respond to conservative PT, orthotics, and progressive strengthening; advanced stages with rigid deformity often require surgical reconstruction.',
      exercises:[
        {icon:'💪', name:'Eccentric Tibialis Posterior Inversion', sets:'3x15 slow reps', desc:'Primary rehabilitation — slow eccentric lowering from inverted to everted position.'},
        {icon:'🦶', name:'Short Foot Exercise / Arch Doming', sets:'3x15, 5 sec hold', desc:'Intrinsic foot activation — restores active arch support independent of tibialis posterior.'},
        {icon:'🧘', name:'Single Heel Raise Progression', sets:'Bilateral → unilateral, reps to 25', desc:'Systematically rebuilds tibialis posterior strength and push-off capacity.'},
        {icon:'🌀', name:'Orthotics + Medial Arch Support', sets:'Full-time in all footwear', desc:'Offloads tibialis posterior — essential adjunct to prevent progressive deformity.'}
      ]
    },
    {
      name: 'Anterior Tibialis Tendinopathy',
      ageNote: 'Any age; overuse from dorsiflexion activities; runners and hikers',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior ankle pain')) score+=4;
        if(s.has('Deep ache')) score+=2;
        if(a.has('Dorsiflexion activities')||a.has('Running')||a.has('Prolonged walking')) score+=3;
        if(a.has('Ascending stairs')||a.has('Descending stairs')) score+=2;
        if(al.has('Rest')||al.has('Immobilization / boot')) score+=2;
        if(tests['Resisted Dorsiflexion Test']==='+') score+=5;
        if(tests['Tibialis Anterior Passive Stretch']==='+') score+=4;
        return score;
      },
      edu:'Anterior tibialis tendinopathy causes anterior ankle and medial midfoot pain, reproduced by resisted dorsiflexion and passive plantarflexion/inversion stretch. It is less common than posterior or peroneal tendinopathy. Footwear lace pressure over the tendon is a common aggravating factor. Progressive tendon loading (isometric → isotonic) and lace modification are the primary treatments.',
      exercises:[
        {icon:'💪', name:'Isometric Dorsiflexion Holds', sets:'5x45 sec, 70% effort', desc:'Pain-modulating isometrics — begin pain-free before progressing.'},
        {icon:'🔄', name:'Isotonic Dorsiflexion with Band', sets:'3x15 reps slow tempo', desc:'Progressive tendon loading — 3–4 sec eccentric lowering.'},
        {icon:'🧘', name:'Plantar Flexion Stretch (gentle)', sets:'Hold 20 sec x3', desc:'Maintain tendon extensibility — avoid aggressive stretch acutely.'},
        {icon:'🌀', name:'Footwear Lace Modification', sets:'Ongoing', desc:'Reduce direct tendon compression — re-lace to avoid pressure over anterior ankle.'}
      ]
    },
    {
      name: 'Peroneal Tendinopathy',
      ageNote: 'Any age; athletes; often accompanies lateral ankle sprains; hindfoot varus is a risk factor',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lateral ankle pain')||s.has('Posterior ankle pain')) score+=3;
        if(s.has('Instability / giving way')) score+=2;
        if(a.has('Running')||a.has('Eversion activities')) score+=3;
        if(a.has('Inversion injury')||a.has('Uneven terrain')) score+=2;
        if(al.has('Rest')||al.has('Orthotics / arch support')) score+=2;
        if(tests['Peroneal Compression Test']==='+') score+=4;
        if(tests['Resisted Eversion & Plantarflexion']==='+') score+=4;
        if(tests['Peroneal Tendon Subluxation Test']==='+') score+=3;
        return score;
      },
      edu:'Peroneal tendinopathy involves peroneus longus (lateral cuboid pain) and/or brevis (posterior to lateral malleolus). It frequently accompanies chronic ankle instability. Hindfoot varus increases peroneal load. Ultrasound is 100% sensitive and 85% specific for peroneal instability. Brevis longitudinal split tears are common with recurrent subluxation. Progressive eccentric loading and ankle stabilisation are primary treatments; surgical exploration for confirmed split tears or subluxation.',
      exercises:[
        {icon:'🌀', name:'Eccentric Peroneal Inversion-to-Eversion', sets:'3x15 slow reps', desc:'Progressive tendon loading — slow eccentric from inversion back to neutral.'},
        {icon:'💪', name:'Isometric Eversion Holds', sets:'5x45 sec', desc:'Pain-modulating isometrics — begin in pain-free position.'},
        {icon:'🧘', name:'Single Leg Balance + Perturbation', sets:'3x30 sec with perturbation', desc:'Address underlying ankle instability that drives peroneal overload.'},
        {icon:'🌀', name:'Lateral Wedge Orthotics', sets:'Full-time in all footwear', desc:'Reduces peroneal tendon compression from hindfoot varus.'}
      ]
    },
    {
      name: 'Tarsal Tunnel Syndrome',
      ageNote: 'Any age; associated with pes planus, ankle trauma, and space-occupying lesions',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Burning pain')) score+=3;
        if(s.has('Numbness')||s.has('Tingling / electrical sensations')) score+=4;
        if(s.has('Cramping (medial arch)')) score+=3;
        if(s.has('Medial ankle pain')) score+=2;
        if(a.has('Prolonged standing')||a.has('Prolonged walking')||a.has('Running')) score+=3;
        if(al.has('Rest')||al.has('Loose footwear')||al.has('Elevation')) score+=2;
        if(tests['Tinel\'s Sign (posterior tibial nerve)']==='+') score+=4;
        if(tests['Dorsiflexion-Eversion Test']==='+') score+=4;
        if(tests['Plantar Flexion-Inversion Test']==='+') score+=3;
        if(tests['Navicular Drop Test']==='+') score+=2;
        return score;
      },
      edu:'Tarsal tunnel syndrome involves compression of the posterior tibial nerve beneath the flexor retinaculum. Burning, tingling, and cramping in the medial plantar foot are characteristic — sensory loss sparing the heel distinguishes it from plantar fasciitis. Nerve conduction studies confirm diagnosis; MRI identifies space-occupying lesions. Conservative treatment includes orthotics, neural mobilisation, and activity modification; surgical decompression for refractory cases.',
      exercises:[
        {icon:'🔄', name:'Neural Mobilisation (tibial nerve)', sets:'2x10 gentle glides', desc:'Reduces nerve adhesion in tarsal tunnel — use sliding technique to avoid aggravation.'},
        {icon:'🧘', name:'Medial Arch Support (orthotics)', sets:'Full-time in all footwear', desc:'Reduces tarsal tunnel pressure from excessive pronation.'},
        {icon:'🌀', name:'Calf Flexibility', sets:'Hold 30 sec x3', desc:'Reduces posterior compartment tension contributing to tarsal tunnel compression.'},
        {icon:'💪', name:'Intrinsic Foot Strengthening', sets:'3x15 reps', desc:'Improves arch control — reduces tibial nerve traction during pronation.'}
      ]
    },
    {
      name: "Morton's Neuroma",
      ageNote: "Peak 45–54 years; women:men >4:1; bilateral in 21%",
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Burning pain')) score+=4;
        if(s.has('Numbness')||s.has('Tingling / electrical sensations')) score+=4;
        if(s.has('Forefoot / metatarsal head pain')) score+=3;
        if(a.has('Tight / constrictive footwear')||a.has('High-heeled shoes')) score+=4;
        if(a.has('Prolonged walking')||a.has('Running')) score+=2;
        if(al.has('Wide-toed shoes')||al.has('Removing shoes')||al.has('Rest')) score+=4;
        if(tests["Thumb-Index Finger Squeeze (webspace)"]==='+') score+=4;
        if(tests["Mulder's Sign"]==='+') score+=5;
        if(sex==='female') score+=2;
        if(age) { if(age >= 45 && age <= 60) score+=2; }
        return score;
      },
      edu:"Morton's neuroma is perineural fibrosis around the common digital nerve, most commonly between 3rd and 4th metatarsals. 91% report pain with walking; 86% worse with tight shoes; symptoms relieve when shoes removed. Mulder's sign is pathognomonic. 97.5% of clinically diagnosed cases confirmed histologically. US is 91% sensitive and 85% specific; MRI is 90% sensitive and 100% specific. Footwear modification is first-line; corticosteroid or sclerosant injections for persistent symptoms.",
      exercises:[
        {icon:'🦶', name:'Metatarsal Pad Positioning', sets:'Daily in all footwear', desc:'Offloads the interspace — most important intervention for Morton\'s neuroma.'},
        {icon:'🌀', name:'Intrinsic Foot Muscle Activation (toe spreaders)', sets:'3x15 reps', desc:'Decompress metatarsal heads and reduce interdigital nerve compression.'},
        {icon:'🧘', name:'Forefoot Stretching (toe extension)', sets:'Hold 30 sec x3', desc:'Reduces forefoot plantar tension contributing to nerve compression.'},
        {icon:'💆', name:'Metatarsal Mobilisation (MT head glides)', sets:'Gentle, 2 min', desc:'Dorsal/plantar glides to reduce stiffness and interspace compression.'}
      ]
    },
    {
      name: 'Metatarsalgia',
      ageNote: 'Any age; associated with high-heeled shoes and high-impact activities',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Forefoot / metatarsal head pain')) score+=5;
        if(s.has('Deep ache')) score+=1;
        if(a.has('Weight-bearing activities')||a.has('Running')) score+=3;
        if(a.has('High-heeled shoes')||a.has('Tight / constrictive footwear')) score+=3;
        if(a.has('Prolonged standing')||a.has('Prolonged walking')) score+=2;
        if(al.has('Rest')||al.has('Cushioned footwear')) score+=2;
        if(tests['Metatarsal Head Palpation']==='+') score+=4;
        if(tests["Mulder's Sign"]==='-') score+=2;
        if(tests["Thumb-Index Finger Squeeze (webspace)"]==='-') score+=1;
        return score;
      },
      edu:"Metatarsalgia is a broad term for forefoot pain under the metatarsal heads, from abnormal load distribution. Assess for callus pattern, Morton's neuroma, plantar plate injury, and stress fracture. Metatarsal pads, cushioned footwear, orthotics, and activity modification are first-line. Refer for MRI if plantar plate tear or stress fracture suspected.",
      exercises:[
        {icon:'🦶', name:'Metatarsal Pad + Cushioned Insole', sets:'Daily in all footwear', desc:'Redistributes forefoot load — primary symptom management.'},
        {icon:'🌀', name:'Toe Flexor Strengthening', sets:'3x20 towel curls / marble pickups', desc:'Restores intrinsic foot strength to improve forefoot load distribution.'},
        {icon:'🧘', name:'Calf Stretching (reduce forefoot load)', sets:'Hold 30 sec x3', desc:'Reduces forefoot pressure by improving ankle dorsiflexion.'},
        {icon:'💆', name:'MT Head Mobilisation', sets:'Gentle, 2 min', desc:'Restore metatarsal mobility and reduce stiffness contributing to abnormal load.'}
      ]
    },
    {
      name: 'Chronic Ankle Instability (CAI)',
      ageNote: 'Any age; follows lateral ankle sprain; affects 30–40% of initial sprain patients',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Instability / giving way')) score+=5;
        if(s.has('Lateral ankle pain')) score+=2;
        if(s.has('Clicking / popping')) score+=1;
        if(a.has('Uneven terrain')||a.has('Impact activities')) score+=3;
        if(a.has('Running')) score+=2;
        if(al.has('Bracing / ankle support')||al.has('Taping')) score+=3;
        if(tests['Anterior Drawer Test']==='+') score+=3;
        if(tests['Talar Tilt Test']==='+') score+=3;
        if(tests['Single Leg Balance (eyes open / closed)']==='+') score+=4;
        if(tests['Y-Balance Test (anterior reach)']==='+') score+=3;
        return score;
      },
      edu:'Chronic ankle instability results from inadequate rehabilitation after acute lateral ankle sprain — 30–40% of initial sprains develop into CAI. Both mechanical laxity and sensorimotor deficits must be addressed. Balance training is the most evidence-based intervention; peroneal strengthening and sport-specific agility reduce re-injury risk. Ankle bracing reduces re-sprain risk during return to sport.',
      exercises:[
        {icon:'🧘', name:'Progressive Balance Training (BOSU/wobble board)', sets:'3x45 sec, increasing difficulty weekly', desc:'Sensorimotor retraining — most evidence-based intervention for CAI.'},
        {icon:'🌀', name:'Peroneal Eccentric Strengthening', sets:'3x15 slow reps', desc:'Builds peroneal tendon resilience and dynamic lateral stability.'},
        {icon:'🦵', name:'Lateral Agility Drills', sets:'3x30 sec', desc:'Sport-specific neuromuscular control — progress from stable to unstable, slow to fast.'},
        {icon:'🔄', name:'Ankle Proprioception (eyes closed, unstable surface)', sets:'3x30 sec each foot', desc:'Restores joint position sense — critical for preventing recurrence on uneven terrain.'}
      ]
    }
  ],
  elbow: [
    {
      name: 'Lateral Epicondylalgia (Tennis Elbow)',
      ageNote: 'Peak 40–49 years; 1–3% of adults; equal male/female; risk factors: smoking, obesity, forearm rotation >4 hrs/day',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Lateral elbow pain')) score+=5;
        if(s.has('Weakness of grip')) score+=3;
        if(s.has('Deep ache')) score+=1;
        if(a.has('Gripping')||a.has('Lifting (even light objects)')) score+=4;
        if(a.has('Wrist extension activities')||a.has('Forearm rotation >4 hrs/day')) score+=3;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['Cozen Test / Thomsen Test']==='+') score+=5;       // 91% sensitive
        if(tests['Mill\'s Test']==='+') score+=3;
        if(tests['Lateral Epicondyle Palpation']==='+') score+=4;
        if(tests['Grip Strength Assessment (dynamometer)']==='+') score+=3; // 78–83% sensitive
        if(age) {
          if(age >= 40 && age <= 55) score+=2;
        }
        return score;
      },
      edu:'Lateral epicondylalgia (LE) is a tendinopathy of the common extensor origin (primarily ECRB) at the lateral epicondyle. The Cozen test is 91% sensitive; reduced grip strength is 78–83% sensitive and 80–90% specific. Insidious onset, pain with lifting even light objects, and pain with resisted wrist extension are hallmarks. Progressive tendon loading (isometric → isotonic eccentric → functional) is the gold standard — avoid complete rest. A counterforce brace provides short-term symptom relief. Differentiate from radial tunnel syndrome (pain 3–4 cm distal to epicondyle) and PIN syndrome (motor weakness).',
      exercises:[
        {icon:'💪', name:'Isometric Wrist Extension Holds', sets:'5x45 sec, 70% effort', desc:'Pain-modulating isometrics — essential first phase; reduces pain and begins tendon loading.'},
        {icon:'🔄', name:'Eccentric Wrist Extension (Tyler Twist / slow lowering)', sets:'3x15, slow 3–4 sec eccentric', desc:'Gold standard eccentric loading — lower weight slowly from full extension back to flexion.'},
        {icon:'🌀', name:'Forearm Pronation/Supination (light weight)', sets:'3x15 reps', desc:'Rotational tendon loading — progress to heavier load as tolerance improves.'},
        {icon:'🧘', name:'Wrist Flexor Stretch (elbow extended)', sets:'Hold 30 sec x3', desc:'Reduces common extensor origin tension — stretch with elbow straight for maximum effect.'}
      ]
    },
    {
      name: 'Medial Epicondylalgia (Golfer\'s Elbow)',
      ageNote: 'Peak 40–60 years; associated with repetitive wrist flexion/pronation; overhead athletes',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial elbow pain')) score+=5;
        if(s.has('Weakness of grip')) score+=2;
        if(s.has('Deep ache')) score+=1;
        if(a.has('Wrist flexion activities')||a.has('Forearm pronation')) score+=4;
        if(a.has('Gripping')||a.has('Throwing (late cocking / acceleration)')) score+=3;
        if(al.has('Rest')||al.has('Activity modification')) score+=2;
        if(tests['Medial Epicondyle Palpation']==='+') score+=4;
        if(tests['Resisted Wrist Flexion Test']==='+') score+=4;
        if(tests['Resisted Forearm Pronation Test']==='+') score+=3;
        // Must differentiate from UCL and cubital tunnel
        if(tests['Moving Valgus Stress Test']==='-') score+=2;
        if(tests['Tinel\'s Sign (cubital tunnel)']==='-') score+=1;
        if(age) {
          if(age >= 40 && age <= 60) score+=2;
        }
        return score;
      },
      edu:'Medial epicondylalgia involves the common flexor-pronator origin (primarily FCR and pronator teres). Pain is at the medial epicondyle, worsened by wrist flexion, pronation, and gripping. Must differentiate from UCL injury (pain more distal, at sublime tubercle; positive moving valgus stress test) and cubital tunnel syndrome (paresthesias in ring/little fingers; positive Tinel\'s). Progressive flexor-pronator loading is the gold standard treatment, mirroring the LE rehabilitation approach.',
      exercises:[
        {icon:'💪', name:'Isometric Wrist Flexion Holds', sets:'5x45 sec, 70% effort', desc:'Initial pain-modulating isometrics — begin at comfortable wrist angle.'},
        {icon:'🔄', name:'Eccentric Wrist Flexion Loading', sets:'3x15, slow 3–4 sec eccentric', desc:'Slow eccentric lowering from full wrist flexion back to extension — tendon remodeling.'},
        {icon:'🌀', name:'Forearm Pronation/Supination (progressive)', sets:'3x15 reps', desc:'Pronator teres loading — progress to heavier resistance as pain settles.'},
        {icon:'🧘', name:'Wrist Extensor Stretch (elbow extended)', sets:'Hold 30 sec x3', desc:'Reduces common flexor origin tension — stretch antagonist with elbow extended.'}
      ]
    },
    {
      name: 'Cubital Tunnel Syndrome (Ulnar Nerve)',
      ageNote: 'Any age; associated with repetitive elbow flexion, external compression, and occupational activities',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial elbow pain')) score+=2;
        if(s.has('Paresthesias (ring / little fingers)')) score+=5;
        if(s.has('Numbness')) score+=3;
        if(s.has('Intrinsic muscle atrophy')) score+=4;
        if(s.has('Weakness of grip')) score+=2;
        if(a.has('Elbow flexion (prolonged)')||a.has('Elbow flexion during sleep')) score+=4;
        if(a.has('Leaning on elbow')) score+=3;
        if(al.has('Elbow extension')||al.has('Avoiding elbow flexion')) score+=3;
        if(tests['Tinel\'s Sign (cubital tunnel)']==='+') score+=4;
        if(tests['Elbow Flexion Test']==='+') score+=3;
        if(tests['Shoulder IR Elbow Flexion Test']==='+') score+=5; // 87% sensitive, 98% specific
        if(tests['Scratch Collapse Test']==='+') score+=3;
        return score;
      },
      edu:'Cubital tunnel syndrome is the second most common peripheral nerve entrapment after CTS, involving the ulnar nerve at the medial elbow. Paresthesias in the ring and little fingers, worsened by sustained elbow flexion, are hallmark. The shoulder IR elbow flexion test is 87% sensitive and 98% specific — the most diagnostically powerful. Intrinsic muscle atrophy indicates severe or long-standing compression. Ultrasound shows CSA >10 mm² at the medial epicondyle (85% sensitive, 91% specific). Nerve gliding, elbow padding, and nocturnal extension splinting are first-line; surgical decompression for refractory cases.',
      exercises:[
        {icon:'🔄', name:'Ulnar Nerve Gliding Exercises', sets:'2x10 gentle glides', desc:'Mobilises ulnar nerve through the cubital tunnel — use sliding technique; avoid tension-loading.'},
        {icon:'🧘', name:'Nocturnal Elbow Extension Splinting', sets:'Nightly', desc:'Prevents sustained elbow flexion during sleep — the most common aggravating position.'},
        {icon:'💪', name:'Elbow Padding / Cubital Tunnel Protection', sets:'During provocative activities', desc:'Reduces external nerve compression at the medial epicondyle during desk work and driving.'},
        {icon:'🌀', name:'Intrinsic Hand Strengthening (late stage)', sets:'3x15 reps', desc:'Restore intrinsic muscle strength — begin only when acute neural symptoms are controlled.'}
      ]
    },
    {
      name: 'Radial Tunnel Syndrome',
      ageNote: 'Any age; often coexists with lateral epicondylalgia (44% of treatment-resistant LE cases)',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Proximal lateral forearm pain')) score+=5;
        if(s.has('Deep ache')) score+=2;
        // Key differentiator from LE: pain is distal, NO motor weakness
        if(!s.has('Weakness of finger extension')) score+=2;
        if(a.has('Forearm pronation')||a.has('Forearm supination')||a.has('Forearm rotation >4 hrs/day')) score+=3;
        if(a.has('Gripping')||a.has('Wrist extension activities')) score+=2;
        if(al.has('Rest')||al.has('Avoiding gripping')) score+=2;
        if(tests['Radial Tunnel Palpation (3–4 cm distal to LE)']==='+') score+=5;
        if(tests['Resisted Supination Test']==='+') score+=4;
        if(tests['Resisted Middle Finger Extension Test']==='+') score+=4;
        // LE tests negative helps differentiate
        if(tests['Cozen Test / Thomsen Test']==='-') score+=2;
        if(tests['Lateral Epicondyle Palpation']==='-') score+=2;
        return score;
      },
      edu:'Radial tunnel syndrome involves compression of the radial nerve (before motor branch division) in the radial tunnel, 3–4 cm distal to the lateral epicondyle. Pain is in the proximal lateral forearm — more distal than LE — without motor weakness (distinguishes from PIN syndrome). It coexists with LE in 44% of treatment-resistant cases, explaining why LE treatment fails. Electrodiagnostic studies are often normal. Nerve decompression exercises, activity modification, and addressing the underlying repetitive forearm rotation are the primary treatments. PIN nerve block confirming pain relief aids diagnosis.',
      exercises:[
        {icon:'🔄', name:'Radial Nerve Gliding / Neural Mobilisation', sets:'2x10 gentle glides', desc:'Mobilises radial nerve through the radial tunnel — key differentiating treatment from LE.'},
        {icon:'🧘', name:'Supinator Stretch', sets:'Hold 30 sec x3', desc:'Stretches supinator muscle compressing PIN at arcade of Frohse.'},
        {icon:'💪', name:'Forearm Rotation Load Management', sets:'Activity modification', desc:'Reduce repetitive supination/pronation that provokes radial tunnel compression.'},
        {icon:'🌀', name:'Wrist Extensor Strengthening (pain-free range)', sets:'3x15 reps', desc:'Progressive loading once neural symptoms are controlled — similar to LE protocol.'}
      ]
    },
    {
      name: 'Posterior Interosseous Nerve Syndrome (Supinator Syndrome)',
      ageNote: 'Any age; associated with space-occupying lesions (lipoma), synovitis, or repetitive forearm rotation',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Weakness of finger extension')) score+=6;
        // Motor only — no sensory symptoms is key differentiator
        if(!s.has('Numbness')&&!s.has('Tingling')&&!s.has('Paresthesias (ring / little fingers)')) score+=4;
        if(a.has('Forearm rotation >4 hrs/day')||a.has('Gripping')) score+=2;
        if(tests['Finger Drop Assessment']==='+') score+=6;
        if(tests['Resisted Supination Test']==='+') score+=3;
        return score;
      },
      edu:'PIN syndrome (supinator syndrome) causes pure motor weakness — finger drop and thumb extension weakness — without sensory symptoms. Wrist extension is preserved (ECRL is spared as it branches proximal to the arcade of Frohse), but with radial deviation. This pattern distinguishes PIN syndrome from radial tunnel (sensory/pain only) and from lateral epicondylalgia (no motor loss). MRI evaluates for space-occupying lesions (lipoma is most common). Surgical decompression is often required.',
      exercises:[
        {icon:'💪', name:'Finger Extension Strengthening', sets:'3x15 reps with band', desc:'Rehabilitate EDC after decompression — progress from assisted to resisted.'},
        {icon:'🔄', name:'Wrist Extensor Strengthening (ECRL preserved)', sets:'3x15 reps', desc:'Maintain ECRL function and begin re-education of PIN-supplied muscles.'},
        {icon:'🧘', name:'Thumb Extension / Abduction Exercises', sets:'3x15 reps', desc:'EPL / EPB strengthening — key functional deficit in PIN syndrome.'},
        {icon:'🌀', name:'Forearm Rotation Strengthening (post-decompression)', sets:'3x15 reps', desc:'Progressive supinator strengthening after surgical or conservative management.'}
      ]
    },
    {
      name: 'Pronator Teres Syndrome (Median Nerve)',
      ageNote: 'Any age; associated with repetitive pronation/supination and forceful gripping',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Volar forearm aching')) score+=4;
        if(s.has('Paresthesias (thumb / index / middle fingers)')) score+=4;
        if(s.has('Numbness')) score+=2;
        if(s.has('Weakness of grip')) score+=2;
        if(a.has('Forearm pronation')||a.has('Gripping')) score+=3;
        if(a.has('Elbow flexion (prolonged)')) score+=2;
        if(al.has('Rest')||al.has('Avoiding gripping')) score+=2;
        if(tests['Pronator Teres Palpation']==='+') score+=4;
        if(tests['Resisted Forearm Pronation Test']==='+') score+=3;
        if(tests['Resisted Elbow Flexion (lacertus fibrosus)']==='+') score+=3;
        if(tests['Resisted FDS Middle Finger Flexion']==='+') score+=3;
        if(tests['Palmar Cutaneous Branch Sensation']==='+') score+=4; // distinguishes from CTS
        return score;
      },
      edu:'Pronator teres syndrome involves median nerve compression at the proximal forearm (pronator teres, lacertus fibrosus, or FDS arch). Paresthesias are in the thumb/index/middle fingers (same as CTS), but the palmar cutaneous branch IS affected — causing proximal palm numbness not seen in CTS. Symptoms worsen with cyclic forearm stress rather than nocturnal wrist position. Electrodiagnostic studies are often normal. Activity modification, nerve gliding, and progressive pronator loading are first-line.',
      exercises:[
        {icon:'🔄', name:'Median Nerve Gliding Exercises', sets:'2x10 gentle glides', desc:'Mobilises median nerve through the pronator teres and FDS arch.'},
        {icon:'🧘', name:'Pronator Teres Stretch', sets:'Hold 30 sec x3', desc:'Supination stretch decompresses the median nerve at the pronator teres.'},
        {icon:'💪', name:'Progressive Pronation/Supination Loading', sets:'3x15 reps', desc:'Graded forearm rotation loading — reduces muscle tightness compressing median nerve.'},
        {icon:'🌀', name:'Activity & Ergonomic Modification', sets:'Ongoing', desc:'Reduce repetitive pronation tasks — ergonomic assessment essential for occupational cases.'}
      ]
    },
    {
      name: 'Ulnar Collateral Ligament (UCL) Sprain',
      ageNote: 'Overhead throwing athletes (especially baseball pitchers); acute or chronic onset',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Medial elbow pain')) score+=3;
        if(s.has('Decline in throwing performance')) score+=4;
        if(s.has('Clicking / popping')) score+=2;
        if(s.has('Paresthesias (ring / little fingers)')) score+=1; // occasional ulnar involvement
        if(a.has('Throwing (late cocking / acceleration)')) score+=5;
        if(a.has('Overhead activities')) score+=2;
        if(al.has('Rest')||al.has('Avoiding throwing')) score+=2;
        if(tests['Moving Valgus Stress Test']==='+') score+=5; // most reliable
        if(tests['Valgus Stress Test (20–30° flexion)']==='+') score+=4;
        if(tests['Milking Maneuver']==='+') score+=3;
        if(tests['UCL / Sublime Tubercle Palpation']==='+') score+=3;
        // Differentiate from medial epicondylalgia: pain at sublime tubercle, not epicondyle
        if(tests['Medial Epicondyle Palpation']==='-') score+=2;
        return score;
      },
      edu:'UCL injuries are the most common elbow injury in overhead throwing athletes, with a dramatic increase in incidence over recent decades. The moving valgus stress test is the most reliable clinical test. Pain is just distal to the medial epicondyle at the sublime tubercle — more distal than medial epicondylalgia. MR arthrography is the gold standard (81–100% sensitive, 91–100% specific). Conservative rehabilitation (UCL strengthening, scapular control, posterior shoulder stretching) is first-line for partial tears; UCL reconstruction (Tommy John surgery) for complete tears or failed conservative management in competitive throwers.',
      exercises:[
        {icon:'🧘', name:'Posterior Shoulder Capsule Stretching (sleeper stretch)', sets:'Hold 30 sec x3', desc:'GIRD is a primary contributor to UCL injury in throwers — must address.'},
        {icon:'💪', name:'Forearm Flexor-Pronator Strengthening', sets:'3x15 progressive load', desc:'Strengthens dynamic UCL stabilisers — FCR and pronator teres.'},
        {icon:'🔄', name:'Interval Throwing Program (graded return)', sets:'6–9 months return to pitching', desc:'Criterion-based throwing return — begin at 45 ft flat ground, progress to full velocity.'},
        {icon:'🌀', name:'Scapular Stabilization + Rotator Cuff', sets:'3x15 each', desc:'Full kinetic chain rehabilitation — elbow UCL receives forces from proximal chain mechanics.'}
      ]
    },
    {
      name: 'Distal Biceps Tendinopathy',
      ageNote: 'Middle-aged males; associated with repetitive elbow flexion/supination',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Anterior elbow pain')) score+=4;
        if(s.has('Weakness with supination')) score+=3;
        if(s.has('Deep ache')) score+=2;
        if(a.has('Elbow flexion (prolonged)')||a.has('Lifting (even light objects)')) score+=3;
        if(a.has('Forearm supination')) score+=3;
        if(al.has('Rest')||al.has('Avoiding gripping')) score+=2;
        if(tests['Biceps Provocation Test']==='+') score+=6; // 95% sensitive, 97% specific
        if(tests['Resisted Hook Test']==='+') score+=3;      // 78% sensitive
        if(tests['Palpation-Rotation Test']==='+') score+=4; // 100% sensitive for partial tears
        // Differentiate from rupture: hook test negative rules in intact tendon
        if(tests['Hook Test (rupture)']==='-') score+=2;
        if(sex==='male') score+=1;
        if(age) { if(age >= 35 && age <= 55) score+=2; }
        return score;
      },
      edu:'Distal biceps tendinopathy involves the biceps tendon at its insertion on the radial tuberosity. The biceps provocation test is 95% sensitive and 97% specific — the most diagnostically powerful single test. The palpation-rotation test is 100% sensitive for partial tears. MRI in the FABS position (flexion-abduction-supination) is gold standard for confirmation. Progressive biceps loading (isometric → isotonic → sport-specific) is the evidence-based treatment.',
      exercises:[
        {icon:'💪', name:'Isometric Elbow Flexion + Supination Holds', sets:'5x45 sec, 70% effort', desc:'Pain-modulating isometrics — begin at 90° elbow flexion in neutral rotation.'},
        {icon:'🔄', name:'Eccentric Elbow Flexion Lowering (biceps curl)', sets:'3x15, 3–4 sec eccentric', desc:'Gold standard tendon remodeling — slow lowering from flexion to extension.'},
        {icon:'🌀', name:'Forearm Supination Loading (progressive)', sets:'3x15 reps with resistance', desc:'Biceps supinator loading — most functionally important motion for distal biceps.'},
        {icon:'🧘', name:'Biceps Stretch (shoulder extension + pronation)', sets:'Hold 30 sec x3', desc:'Restores biceps flexibility — stretch in shoulder extension with forearm pronated.'}
      ]
    },
    {
      name: 'Distal Biceps Tendon Rupture (Complete)',
      ageNote: 'Males 40–60 years; dominant arm; acute eccentric load mechanism',
      match:(s,a,al,obj,tests,age,sex) => {
        let score=0;
        if(s.has('Audible pop (acute)')) score+=5;
        if(s.has('Anterior elbow pain')) score+=2;
        if(s.has('Ecchymosis (acute)')) score+=3;
        if(s.has('Weakness with supination')) score+=4;
        if(s.has('Weakness of grip')) score+=2;
        if(tests['Hook Test (rupture)']==='+') score+=5;
        if(tests['Biceps Crease Interval (BCI)']==='+') score+=4;
        if(tests['Passive Forearm Pronation Test']==='+') score+=4;
        if(tests['Biceps Squeeze Test']==='+') score+=4;
        // All 3 positive = 100% sensitivity/specificity
        const ruptureTests = [tests['Hook Test (rupture)'], tests['Biceps Crease Interval (BCI)'], tests['Passive Forearm Pronation Test']].filter(t=>t==='+').length;
        if(ruptureTests >= 3) score+=6;
        if(sex==='male') score+=2;
        if(age) { if(age >= 40 && age <= 60) score+=2; }
        return score;
      },
      edu:'Complete distal biceps rupture presents acutely with a "pop," anterior ecchymosis, weakness with supination and flexion, and the classic "Popeye" deformity (muscle belly retracts proximally). The combination of hook test + BCI >6 cm + passive pronation test achieves 100% sensitivity and specificity. Refer urgently for surgical evaluation — repair within 2–3 weeks achieves superior outcomes (strength/endurance) compared to delayed repair. Conservative management only for elderly sedentary patients who accept permanent supination and flexion weakness.',
      exercises:[
        {icon:'🦵', name:'Pre-operative Elbow ROM Maintenance', sets:'Active ROM 3x daily', desc:'Maintain motion before surgical repair — begin immediately after injury.'},
        {icon:'🔄', name:'Post-operative Protocol (weeks 0–6)', sets:'Surgeon-guided ROM in brace', desc:'Gradual ROM — no resisted supination or flexion until tendon healing confirmed.'},
        {icon:'💪', name:'Progressive Biceps Loading (weeks 6–12)', sets:'Isometric → isotonic', desc:'Begin resisted loading under surgical protocol — bilateral comparison throughout.'},
        {icon:'🌀', name:'Return to Full Activity (months 4–6)', sets:'Sport/work-specific loading', desc:'Full supination strength typically recovers by 4–6 months post-repair.'}
      ]
    }
  ]
};

// ======== RENDERING ========
function renderChips(containerId, area, dataObj) {
  const chips = dataObj[area] || dataObj['lumbar'] || [];
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  chips.forEach(c => {
    const btn = document.createElement('button');
    btn.className = 'chip';
    btn.textContent = c;
    btn.onclick = () => { btn.classList.toggle('selected'); };
    el.appendChild(btn);
  });
}

function getSelectedChips(containerId) {
  const chips = document.querySelectorAll(`#${containerId} .chip.selected`);
  return new Set([...chips].map(c => c.textContent));
}

function renderObjectiveFields() {
  const area = state.area || 'lumbar';
  const fields = OBJECTIVE_FIELDS[area];
  const container = document.getElementById('objectiveFields');
  container.innerHTML = '';

  if(fields.mmt.length) {
    const lbl = document.createElement('div');
    lbl.className = 'section-label';
    lbl.textContent = 'Manual Muscle Testing (MMT) — Grade 0–5';
    container.appendChild(lbl);
    const grid = document.createElement('div');
    grid.className = 'objective-grid';
    fields.mmt.forEach(f => {
      const g = document.createElement('div');
      g.className = 'field-group';
      g.innerHTML = `<label>${f}</label><input type="text" data-key="mmt_${f}" placeholder="e.g. 4+/5" />`;
      grid.appendChild(g);
    });
    container.appendChild(grid);
  }

  if(fields.rom.length) {
    const lbl2 = document.createElement('div');
    lbl2.className = 'section-label';
    lbl2.textContent = 'Range of Motion (ROM)';
    container.appendChild(lbl2);
    const grid2 = document.createElement('div');
    grid2.className = 'objective-grid';
    fields.rom.forEach(f => {
      const g = document.createElement('div');
      g.className = 'field-group';
      g.innerHTML = `
        <label style="display:flex;align-items:center;justify-content:space-between;">
          <span>${f.label}</span>
          <span class="norm-badge">Norm: ${f.norm}</span>
        </label>
        <input type="text" data-key="rom_${f.label}" placeholder="Enter value" />`;
      grid2.appendChild(g);
    });
    container.appendChild(grid2);
  }

  // Hamstring length — only relevant for lower extremity and spinal regions
  const slrRegions = ['lumbar', 'thoracic', 'pelvis', 'knee', 'ankle'];
  if (slrRegions.includes(area)) {
    const slrLbl = document.createElement('div');
    slrLbl.className = 'section-label';
    slrLbl.textContent = 'Hamstring Length — Straight Leg Raise (SLR)';
    container.appendChild(slrLbl);

    const slrDesc = document.createElement('p');
    slrDesc.style.cssText = 'font-size:0.82rem;color:var(--muted);margin-bottom:14px;line-height:1.5;';
    slrDesc.textContent = 'Supine, contralateral knee extended. Record angle at which posterior thigh tension limits motion. Norms are compared against age/sex entered on page 2.';
    container.appendChild(slrDesc);

    const slrGrid = document.createElement('div');
    slrGrid.className = 'objective-grid';
    slrGrid.innerHTML = `
      <div class="field-group">
        <label>SLR — Right (°)</label>
        <input type="number" id="slrRight" placeholder="e.g. 65" min="0" max="120" oninput="renderSLRFeedback()" />
      </div>
      <div class="field-group">
        <label>SLR — Left (°)</label>
        <input type="number" id="slrLeft" placeholder="e.g. 70" min="0" max="120" oninput="renderSLRFeedback()" />
      </div>`;
    container.appendChild(slrGrid);

    const slrFb = document.createElement('div');
    slrFb.id = 'slrFeedback';
    slrFb.style.marginTop = '16px';
    container.appendChild(slrFb);
  }
}

function buildSpecialTests() {
  const area = state.area || 'lumbar';
  const tests = SPECIAL_TESTS[area] || [];
  const container = document.getElementById('specialTestsList');
  container.innerHTML = '';
  tests.forEach(t => {
    const div = document.createElement('div');
    div.className = 'test-item';
    div.innerHTML = `
      <div>
        <div class="test-name">${t.name}</div>
        <div class="test-purpose">${t.purpose}</div>
      </div>
      <div class="toggle-group">
        <button class="toggle-btn pos" data-test="${t.name}" data-val="+">+</button>
        <button class="toggle-btn neg" data-test="${t.name}" data-val="-">–</button>
      </div>
    `;
    container.appendChild(div);
  });
  container.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const group = this.closest('.toggle-group');
      group.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
    });
  });
}

function collectSpecialTests() {
  const results = {};
  document.querySelectorAll('.toggle-btn.active').forEach(btn => {
    results[btn.dataset.test] = btn.dataset.val;
  });
  return results;
}

function buildResults() {
  evaluateSLR();
  const area = state.area || 'lumbar';
  const syms = getSelectedChips('symptomChips');
  const agg = getSelectedChips('aggChips');
  const alle = getSelectedChips('alleChips');
  const tests = collectSpecialTests();
  const age = state.age;
  const sex = state.sex;

  const ddxList = DDX_LOGIC[area] || [];
  const scored = ddxList.map(d => ({
    ...d,
    score: d.match(syms, agg, alle, {}, tests, age, sex)
  })).filter(d => d.score > 0).sort((a,b) => b.score - a.score);

  const ddxEl = document.getElementById('ddxResults');
  ddxEl.innerHTML = '';

  // SLR summary card if data present
  if (state.slrRight !== null || state.slrLeft !== null) {
    const norm = getSLRNorm(age || 35, sex || 'other');
    const worstSide = (state.slrRight !== null && state.slrLeft !== null)
      ? (state.slrRight < state.slrLeft ? `Right (${state.slrRight}°)` : `Left (${state.slrLeft}°)`)
      : (state.slrRight !== null ? `Right (${state.slrRight}°)` : `Left (${state.slrLeft}°)`);
    const worstVal = Math.min(state.slrRight ?? 999, state.slrLeft ?? 999);
    const flagColor = state.slrFlag === 'severe' ? 'var(--negative)' : state.slrFlag === 'mild' ? 'var(--warn)' : 'var(--positive)';
    const flagText = state.slrFlag === 'severe' ? 'Significantly restricted — may contribute to posterior chain loading deficits'
      : state.slrFlag === 'mild' ? 'Mildly restricted — consider hamstring flexibility in treatment planning'
      : 'Within normal limits for age / sex';
    ddxEl.innerHTML += `
      <div style="background:var(--surface);border:1px solid var(--border);border-left:2px solid ${flagColor};border-radius:0 4px 4px 0;padding:14px 20px;margin-bottom:12px;">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:0.6rem;font-weight:500;text-transform:uppercase;letter-spacing:0.12em;color:var(--muted);margin-bottom:8px;">Hamstring Flexibility — SLR</div>
        <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:0.95rem;color:var(--text);margin-bottom:4px;">Most Limited: ${worstSide}</div>
        <div style="font-family:'IBM Plex Mono',monospace;font-size:0.72rem;color:var(--muted2);">Expected min for age ${age || '?'} ${sex ? '(' + sex + ')' : ''}: ${norm.min}° &nbsp;·&nbsp; ${flagText}</div>
      </div>`;
  }

  ddxEl.innerHTML += '<div class="section-label" style="margin:20px 0 12px">Differential Diagnoses</div>';

  if(scored.length === 0) {
    ddxEl.innerHTML += '<p style="color:var(--muted);font-size:0.85rem;">Insufficient data to generate differential. Please review entries.</p>';
    return;
  }

  const maxScore = scored[0].score;
  scored.slice(0, 4).forEach((d, i) => {
    const ratio = d.score / maxScore;
    const barWidth = Math.round(ratio * 100);
    let lkClass = 'lk-low', lkText = 'Lower likelihood';
    let rankClass = 'rank-other';
    if(i === 0 && ratio > 0.7) { lkClass = 'lk-high'; lkText = 'Highest likelihood'; rankClass = 'rank-1'; }
    else if(i <= 1 && ratio >= 0.5) { lkClass = 'lk-med'; lkText = 'Moderate likelihood'; rankClass = 'rank-2'; }
    const card = document.createElement('div');
    card.className = `ddx-card ${rankClass}`;
    card.innerHTML = `
      <div class="ddx-card-top">
        <h3>${d.name.replace('⚠️ ', '')}</h3>
        <span class="likelihood ${lkClass}">${lkText}</span>
      </div>
      ${d.name.includes('⚠️') ? `<div style="font-family:'IBM Plex Mono',monospace;font-size:0.68rem;color:var(--negative);margin-bottom:8px;letter-spacing:0.04em;">RED FLAG — Urgent referral indicated</div>` : ''}
      ${d.ageNote ? `<div class="age-note">Typical: ${d.ageNote}</div>` : ''}
      <div class="score-bar-wrap">
        <div class="score-bar-bg"><div class="score-bar-fill" style="width:${barWidth}%"></div></div>
      </div>
    `;
    ddxEl.appendChild(card);
  });

  // Recommendation
  const top = scored[0];
  const recEl = document.getElementById('recSection');
  recEl.innerHTML = `
    <div class="rec-box">
      <div class="rec-box-label">Clinical Impression</div>
      <h3>${top.name.replace('⚠️ ', '')}</h3>
      <p>${top.edu}</p>
      <p style="margin-top:12px;font-family:'IBM Plex Mono',monospace;font-size:0.68rem;color:var(--muted);letter-spacing:0.02em;">All findings must be interpreted by a licensed clinician. This output does not constitute a medical diagnosis.</p>
    </div>`;

  // Education
  const eduEl = document.getElementById('eduSection');
  eduEl.innerHTML = `
    <div class="card">
      <div class="card-header">
        <h2>Patient Education</h2>
        <p class="subtitle">${top.name.replace('⚠️ ', '')}</p>
      </div>
      <div class="edu-item"><strong>Understanding Your Condition</strong>${top.edu}</div>
      <div class="edu-item"><strong>Activity Modification</strong>Identify and temporarily avoid high-pain activities. Use a pain scale — stay below 4/10 with all exercises. Gradual return to activity is the goal, not complete rest.</div>
      <div class="edu-item"><strong>Posture & Body Mechanics</strong>Be mindful of positions that load the injured area. Use proper body mechanics with lifting, sitting, and daily activities. Ergonomic adjustments at work may be warranted.</div>
      <div class="edu-item"><strong>Heat vs. Ice</strong>Ice for acute inflammation (first 48–72 hours). Heat for chronic stiffness and muscle tightness. Always use a cloth barrier between skin and ice or heat source.</div>
    </div>`;

  // Exercises
  const exEl = document.getElementById('exSection');
  exEl.innerHTML = `<div class="card"><div class="card-header"><h2>Starter Exercise Program</h2><p class="subtitle">Evidence-based starting point for ${top.name.replace('⚠️ ', '')} — progress as tolerated, modify based on response.</p></div><div class="exercise-grid" id="exGrid"></div></div>`;
  const exGrid = document.getElementById('exGrid');
  (top.exercises || []).forEach((ex, idx) => {
    const card = document.createElement('div');
    card.className = 'ex-card';
    card.innerHTML = `
      <div class="ex-number">0${idx + 1}</div>
      <strong>${ex.name}</strong>
      <p>${ex.desc}</p>
      <div class="sets">${ex.sets}</div>`;
    exGrid.appendChild(card);
  });
}

function selectSex(btn) {
  document.querySelectorAll('#sexChips .chip').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  state.sex = btn.dataset.sex;
}

// SLR normal ranges by age/sex (degrees) — based on published normative data
// Sources: Gajdosik & Lusin 1983, Youdas et al 1993, Hamberg et al
function getSLRNorm(age, sex) {
  // Returns {min, typical, label}
  const isFemale = sex === 'female';
  if (age < 20)        return { min: isFemale ? 75 : 70, typical: isFemale ? 90 : 85, label: 'Under 20' };
  if (age < 30)        return { min: isFemale ? 75 : 68, typical: isFemale ? 88 : 82, label: '20–29' };
  if (age < 40)        return { min: isFemale ? 72 : 65, typical: isFemale ? 85 : 78, label: '30–39' };
  if (age < 50)        return { min: isFemale ? 68 : 62, typical: isFemale ? 82 : 75, label: '40–49' };
  if (age < 60)        return { min: isFemale ? 65 : 58, typical: isFemale ? 78 : 70, label: '50–59' };
  if (age < 70)        return { min: isFemale ? 62 : 55, typical: isFemale ? 74 : 67, label: '60–69' };
  return               { min: isFemale ? 58 : 50, typical: isFemale ? 70 : 62, label: '70+' };
}

function evaluateSLR() {
  const ageEl = document.getElementById('patientAge');
  const slrREl = document.getElementById('slrRight');
  const slrLEl = document.getElementById('slrLeft');
  const age = ageEl ? parseInt(ageEl.value) : NaN;
  const slrR = slrREl ? parseFloat(slrREl.value) : NaN;
  const slrL = slrLEl ? parseFloat(slrLEl.value) : NaN;

  state.age = isNaN(age) ? state.age : age; // preserve age from page 2 if not re-entered
  state.slrRight = isNaN(slrR) ? null : slrR;
  state.slrLeft = isNaN(slrL) ? null : slrL;

  if (!state.age || (state.slrRight === null && state.slrLeft === null)) {
    state.slrFlag = null;
    return;
  }

  const norm = getSLRNorm(state.age, state.sex || 'other');
  const worst = Math.min(
    state.slrRight !== null ? state.slrRight : 999,
    state.slrLeft !== null ? state.slrLeft : 999
  );

  if (worst < norm.min - 15)  state.slrFlag = 'severe';
  else if (worst < norm.min)  state.slrFlag = 'mild';
  else                        state.slrFlag = 'normal';
}

function renderSLRFeedback() {
  const feedbackEl = document.getElementById('slrFeedback');
  if (!feedbackEl) return;
  const ageEl = document.getElementById('patientAge');
  const slrREl = document.getElementById('slrRight');
  const slrLEl = document.getElementById('slrLeft');
  const age = ageEl ? parseInt(ageEl.value) : NaN;
  const slrR = slrREl ? parseFloat(slrREl.value) : NaN;
  const slrL = slrLEl ? parseFloat(slrLEl.value) : NaN;
  const sex = state.sex || 'other';

  if (isNaN(age) || (isNaN(slrR) && isNaN(slrL))) { feedbackEl.innerHTML = ''; return; }

  const norm = getSLRNorm(age, sex);
  const sexLabel = sex === 'female' ? 'Female' : sex === 'male' ? 'Male' : 'General';

  let rows = '';
  if (!isNaN(slrR)) {
    const status = slrR >= norm.min ? '✅ Within normal limits' : slrR >= norm.min - 15 ? '⚠️ Mildly restricted' : '🔴 Significantly restricted';
    rows += `<tr><td style="padding:6px 10px;font-weight:500;">Right</td><td style="padding:6px 10px;">${slrR}°</td><td style="padding:6px 10px;">${norm.min}–${norm.typical + 15}°</td><td style="padding:6px 10px;">${status}</td></tr>`;
  }
  if (!isNaN(slrL)) {
    const status = slrL >= norm.min ? '✅ Within normal limits' : slrL >= norm.min - 15 ? '⚠️ Mildly restricted' : '🔴 Significantly restricted';
    rows += `<tr><td style="padding:6px 10px;font-weight:500;">Left</td><td style="padding:6px 10px;">${slrL}°</td><td style="padding:6px 10px;">${norm.min}–${norm.typical + 15}°</td><td style="padding:6px 10px;">${status}</td></tr>`;
  }

  feedbackEl.innerHTML = `
    <div style="background:var(--chip-bg);border:1px solid var(--border);border-radius:10px;padding:14px 16px;">
      <div style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--accent);margin-bottom:10px;">
        Normative Reference — Age ${age}, ${sexLabel} (Age group: ${norm.label})
      </div>
      <table style="width:100%;border-collapse:collapse;font-size:0.83rem;">
        <thead><tr style="border-bottom:1px solid var(--border);">
          <th style="text-align:left;padding:4px 10px;color:var(--muted);font-weight:600;">Side</th>
          <th style="text-align:left;padding:4px 10px;color:var(--muted);font-weight:600;">Measured</th>
          <th style="text-align:left;padding:4px 10px;color:var(--muted);font-weight:600;">Expected Range</th>
          <th style="text-align:left;padding:4px 10px;color:var(--muted);font-weight:600;">Interpretation</th>
        </tr></thead>
        <tbody>${rows}</tbody>
      </table>
      <div style="font-size:0.73rem;color:var(--muted);margin-top:8px;">Based on Gajdosik & Lusin (1983) and Youdas et al. (1993). Female norms are typically 5–10° greater than male across age groups.</div>
    </div>`;
}

// ======== NAVIGATION ========
function goTo(n) {
  if(n === 1) { /* allow */ }
  else if(n === 2 && !state.area) { alert('Please select a region first.'); return; }

  // Collect data on leaving pages
  if(n > 3) {
    state.symptoms = getSelectedChips('symptomChips');
    state.symptomText = document.getElementById('symptomText').value;
  }
  if(n > 4) {
    state.agg = getSelectedChips('aggChips');
    state.aggText = document.getElementById('aggText').value;
  }
  if(n > 5) {
    state.alle = getSelectedChips('alleChips');
    state.alleText = document.getElementById('alleText').value;
  }

  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page' + n).classList.add('active');

  document.querySelectorAll('.step-dot').forEach(d => {
    const s = parseInt(d.dataset.step);
    d.classList.remove('active','done');
    if(s < n) d.classList.add('done');
    if(s === n) d.classList.add('active');
  });

  window.scrollTo({top:0, behavior:'smooth'});
}

function resetAll() {
  state.area = null;
  state.age = null;
  state.sex = null;
  state.slrRight = null;
  state.slrLeft = null;
  state.slrFlag = null;
  state.symptoms = new Set();
  state.agg = new Set();
  state.alle = new Set();
  state.objective = {};
  state.specialTests = {};
  const ageEl = document.getElementById('patientAge');
  if (ageEl) ageEl.value = '';
  document.querySelectorAll('#sexChips .chip').forEach(b => b.classList.remove('selected'));
  document.getElementById('ddxResults').innerHTML = '';
  document.getElementById('recSection').innerHTML = '';
  document.getElementById('eduSection').innerHTML = '';
  document.getElementById('exSection').innerHTML = '';
  goTo(1);
}

// ======== INIT ========
document.getElementById('areaGrid').addEventListener('click', function(e) {
  const btn = e.target.closest('.area-btn');
  if(!btn) return;
  document.querySelectorAll('.area-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  state.area = btn.dataset.area;

  // Render downstream chips
  renderChips('symptomChips', state.area, SYMPTOM_CHIPS);
  renderChips('aggChips', state.area, AGG_CHIPS);
  renderChips('alleChips', state.area, ALLE_CHIPS);
  renderObjectiveFields();
});
</script>
</body>
</html>
